<!DOCTYPE html>
<html>
<head>
    <title>SOLUTION — Lights On</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/puzzles.css">
    <link rel="stylesheet" type="text/css" href="../../HTML/css/font.css">
    <link rel="stylesheet" type="text/css" href="timwi-puzzles.css">
    <script src='../highlighter.js'></script>
    <style>
        .solution td, .solution th {
            text-align: center;
            border: none;
        }

        svg {
            width: 100%;
        }

        table.lights-on {
            font-size: 24pt;
            text-align: center;
            margin: 1.5em auto;
        }

            table.lights-on td {
                padding: .1cm;
            }

                table.lights-on td.letter {
                    border: 1px solid black;
                    font-weight: bold;
                }

                    table.lights-on td.letter.lit {
                        background: #ffa;
                    }

                table.lights-on td.label {
                    font-size: 18pt;
                }

        .bulb {
            width: 1cm;
            height: 1cm;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="5" d="M51 97h-2"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M51 97h-2"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 81l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 81l-14 4"/><path fill="%23fff" stroke="%23000" stroke-width="2" d="M50 22c-7 0-24 4-24 23 0 14 12 20 12 32 0 4 2 5 5 5h14c3 0 5-1 5-5 0-12 12-18 12-32 0-19-17-23-24-23z"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 86l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 86l-14 4"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 91l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 91l-14 4"/><path fill="none" stroke="%23000" stroke-width=".5" d="M54 70l8-25c-8 6.4-15-7-24 0l8 25v12h8z"/><path d="M50 1l3 3v14c0 1-1 2-3 2s-3-1-3-2V4z"/><path fill="none" stroke="%23000" stroke-width=".5" d="M46 70h8"/><path d="M15.4 15.4h4.2l9.9 9.9c.7.7.7 2-.7 3.5-1.4 1.4-2.8 1.4-3.5.7l-10-10zm69.2 0v4.2l-9.9 9.9c-.7.7-2 .7-3.5-.7-1.4-1.4-1.4-2.8-.7-3.5l10-10z"/></svg>');
            background-size: 1cm 1cm;
        }
            .bulb.dud {
                background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="none" stroke="%23888" stroke-linecap="round" stroke-width="5" d="M51 97h-2"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M51 97h-2"/><path fill="none" stroke="%23888" stroke-linecap="round" stroke-width="6" d="M57 81l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 81l-14 4"/><path fill="%23fff" stroke="%23888" stroke-width="2" d="M50 22c-7 0-24 4-24 23 0 14 12 20 12 32 0 4 2 5 5 5h14c3 0 5-1 5-5 0-12 12-18 12-32 0-19-17-23-24-23z"/><path fill="none" stroke="%23888" stroke-linecap="round" stroke-width="6" d="M57 86l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 86l-14 4"/><path fill="none" stroke="%23888" stroke-linecap="round" stroke-width="6" d="M57 91l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 91l-14 4"/><path fill="none" stroke="%23888" stroke-width=".5" d="M54 70l8-25c-8 6.4-15-7-24 0l8 25v12h8z"/></svg>');
            }
            .bulb.lit {
                background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="5" d="M51 97h-2"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M51 97h-2"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 81l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 81l-14 4"/><path fill="%23ff0" stroke="%23000" stroke-width="2" d="M50 22c-7 0-24 4-24 23 0 14 12 20 12 32 0 4 2 5 5 5h14c3 0 5-1 5-5 0-12 12-18 12-32 0-19-17-23-24-23z"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 86l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 86l-14 4"/><path fill="none" stroke="%23000" stroke-linecap="round" stroke-width="6" d="M57 91l-14 4"/><path fill="none" stroke="%23fff" stroke-linecap="round" stroke-width="3" d="M57 91l-14 4"/><path fill="none" stroke="%23000" stroke-width=".5" d="M54 70l8-25c-8 6.4-15-7-24 0l8 25v12h8z"/><path d="M50 1l3 3v14c0 1-1 2-3 2s-3-1-3-2V4z"/><path fill="none" stroke="%23000" stroke-width=".5" d="M46 70h8"/><path d="M15.4 15.4h4.2l9.9 9.9c.7.7.7 2-.7 3.5-1.4 1.4-2.8 1.4-3.5.7l-10-10zm69.2 0v4.2l-9.9 9.9c-.7.7-2 .7-3.5-.7-1.4-1.4-1.4-2.8-.7-3.5l10-10z"/></svg>');
            }
            .bulb.change {
                outline: 3px solid #0a2;
            }

        .bulb-top {
            transform: rotate(180deg);
        }

        .bulb-left {
            transform: rotate(90deg);
        }

        .bulb-right {
            transform: rotate(-90deg);
        }

        .lights-on-rules {
            margin: 2em;
        }

            .lights-on-rules li {
                margin: 1em 0;
            }

        p.cur-step {
            border: 1px solid #4f4;
            background: #efe;
            margin: .5cm 1cm;
            min-height: 2cm;
            position: relative;
        }
            #cur-step {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                width: 16cm;
            }
        button {
            min-height: 2cm;
        }
    </style>
</head>
<body>
    <div id='everything' class='solution'>
        <div>
            <h1><img src='Lights On.png' alt='Lights On' style='width: 10cm'></h1>
            <h2>Solution</h2>
            <p style='text-align: center'>Use the left/right arrow buttons to navigate the solution steps.</p>
            <button id='prev' disabled style='float: left'>◀</button><button id='next' style='float:right'>▶</button><p style='text-align: center' class='cur-step'><span id='cur-step'></span></p>
            <table class='lights-on'>
                <tr><td colspan="2" class='label'>column</td><td class='label'>A</td><td class='label'>B</td><td class='label'>C</td><td class='label'>D</td><td class='label'>E</td><td class='label'>F</td><td class='label'>G</td><td class='label'>H</td><td class='label'>I</td><td class='label'>J</td><td class='label'></td></tr>
                <tr><td class='label'>row</td><td></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td><div class='bulb bulb-top'></div></td><td></td></tr>
                <tr><td class='label'>1</td><td><div class='bulb bulb-left'></div></td><td class='letter'>F</td><td class='letter'>D</td><td class='letter'>O</td><td class='letter'>E</td><td class='letter'>M</td><td class='letter'>A</td><td class='letter'>P</td><td class='letter'>E</td><td class='letter'>D</td><td class='letter'>O</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>2</td><td><div class='bulb bulb-left'></div></td><td class='letter'>N</td><td class='letter'>R</td><td class='letter'>E</td><td class='letter'>S</td><td class='letter'>D</td><td class='letter'>R</td><td class='letter'>O</td><td class='letter'>I</td><td class='letter'>V</td><td class='letter'>D</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>3</td><td><div class='bulb bulb-left'></div></td><td class='letter'>U</td><td class='letter'>U</td><td class='letter'>S</td><td class='letter'>S</td><td class='letter'>N</td><td class='letter'>P</td><td class='letter'>S</td><td class='letter'>S</td><td class='letter'>O</td><td class='letter'>D</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>4</td><td><div class='bulb bulb-left'></div></td><td class='letter'>C</td><td class='letter'>E</td><td class='letter'>I</td><td class='letter'>N</td><td class='letter'>O</td><td class='letter'>Y</td><td class='letter'>H</td><td class='letter'>H</td><td class='letter'>N</td><td class='letter'>A</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>5</td><td><div class='bulb bulb-left'></div></td><td class='letter'>L</td><td class='letter'>T</td><td class='letter'>O</td><td class='letter'>H</td><td class='letter'>L</td><td class='letter'>D</td><td class='letter'>I</td><td class='letter'>E</td><td class='letter'>V</td><td class='letter'>R</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>6</td><td><div class='bulb bulb-left'></div></td><td class='letter'>I</td><td class='letter'>E</td><td class='letter'>O</td><td class='letter'>M</td><td class='letter'>T</td><td class='letter'>E</td><td class='letter'>C</td><td class='letter'>E</td><td class='letter'>A</td><td class='letter'>E</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>7</td><td><div class='bulb bulb-left'></div></td><td class='letter'>R</td><td class='letter'>C</td><td class='letter'>K</td><td class='letter'>C</td><td class='letter'>I</td><td class='letter'>T</td><td class='letter'>I</td><td class='letter'>A</td><td class='letter'>O</td><td class='letter'>R</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td class='label'>8</td><td><div class='bulb bulb-left'></div></td><td class='letter'>N</td><td class='letter'>E</td><td class='letter'>Z</td><td class='letter'>S</td><td class='letter'>E</td><td class='letter'>A</td><td class='letter'>E</td><td class='letter'>N</td><td class='letter'>L</td><td class='letter'>R</td><td><div class='bulb bulb-right'></div></td></tr>
                <tr><td colspan='2'></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td><div class='bulb bulb-bottom'></div></td><td></td></tr>
            </table>
            <p class='solution' id='solution-word'>REVOLVER</p>
            <script>
                var steps = [
                    //          ABCDEFGHIJ1122334455667788ABCDEFGHIJ
                    { 'bulbs': '....x.......xx..xxxx..........x.....', 'explain': 'Start by marking the bulbs in rows 2, 4, 5 and column E as duds (Clue 4).' },
                    { 'bulbs': 'x...x.....x.xx..xxxx....xxx...x....x', 'explain': 'The bulbs adjacent to the corners (except the north-east) are off (Clue 3).' },
                    { 'bulbs': 'x...x.....x.xx!.xxxx....xxx...x....x', 'explain': 'At this point, bulb 3 on the left must be on. If it weren’t, the two lit bulbs on the west side would have to be 6 and 7, but they’re adjacent, so that’s not allowed (Clue 2).' },
                    { 'bulbs': 'x.x.x.....x.xx!xxxxx....xxx...xx...x', 'explain': 'Because this bulb now shines directly at three other bulbs, we can turn those off (Clue 1).' },
                    { 'bulbs': 'x.x.x.....x!xx!xxxxx.!.xxxx...xx...x', 'explain': 'Now, only one possibility remains on the east side, as its lit bulbs can’t have 5 bulbs between them (Clue 2).' },
                    { 'bulbs': 'x.x.x....xx!xx!xxxxxx!.xxxx.x.xx.x.x', 'explain': 'Again, the new bulbs shine at other bulbs that must now be off (Clue 1). From now on, we will apply this rule directly.' },
                    { 'bulbs': 'x.x.x.x..xx!xx!xxxxxx!!xxxxxx.xx.x.x', 'explain': 'That leaves only one bulb for the west side.' },
                    { 'bulbs': 'x.x.x.x..xx!xx!xxxxxx!!xxxxxx.xx.xxx', 'explain': 'South bulb I cannot be on. If it were, the south side would be the one with 1 bulb between the lits, so north would have to have 2 bulbs between the lits, but that would no longer be possible with north I off.' },
                    { 'bulbs': 'x.xxx.x..xx!xx!xxxxxx!!xxxxxx!xx!xxx', 'explain': 'That finishes off the south side.' },
                    { 'bulbs': 'xxxxx!x!xxx!xx!xxxxxx!!xxxxxx!xx!xxx', 'explain': 'That leaves only one possibility for north.' },
                    { 'bulbs': 'xxxxx!x!xxx!xx!xxxxxx!!xxxxxx!xx!xxx', 'explain': 'The solution word is obtained by reading the remaining unlit letters.' },
                ];
                var curStep = 0;
                var bulbs = Array.from(document.getElementsByClassName('bulb'));
                var tds = Array.from(document.getElementsByClassName('letter'));
                function update()
                {
                    document.getElementById('cur-step').innerText = steps[curStep].explain;
                    for (let i = 0; i < 36; i++) {
                        var ch = steps[curStep].bulbs.substr(i, 1);
                        console.log(`${i} = ${ch}`);
                        bulbs[i].classList.remove('dud');
                        bulbs[i].classList.remove('lit');
                        bulbs[i].classList.remove('change');
                        if (ch === 'x')
                            bulbs[i].classList.add('dud');
                        else if (ch === '!')
                            bulbs[i].classList.add('lit');
                        if ((curStep === 0 && ch !== '.') || (curStep > 0 && ch !== steps[curStep-1].bulbs.substr(i, 1)))
                            bulbs[i].classList.add('change');
                    }
                    document.getElementById('prev').disabled = curStep === 0;
                    document.getElementById('next').disabled = curStep === steps.length-1;
                    for (let k = 0; k < 80; k++)
                    {
                        let x = (k % 10);
                        let y = (k / 10)|0;
                        tds[k].classList.remove('lit');
                        for (var topBulb of [x-y-1, x, x+y+1])
                            if (topBulb >= 0 && topBulb < 10 && steps[curStep].bulbs.substr(topBulb, 1) === '!')
                                tds[k].classList.add('lit');
                        for (var btmBulb of [x+y-8, x, x-y+8])
                            if (btmBulb >= 0 && btmBulb < 10 && steps[curStep].bulbs.substr(btmBulb+26, 1) === '!')
                                tds[k].classList.add('lit');
                        for (var leftBulb of [y-x-1, y, y+x+1])
                            if (leftBulb >= 0 && leftBulb < 8 && steps[curStep].bulbs.substr(leftBulb*2+10, 1) === '!')
                                tds[k].classList.add('lit');
                        for (var rightBulb of [y+x-10, y, y-x+10])
                            if (rightBulb >= 0 && rightBulb < 8 && steps[curStep].bulbs.substr(rightBulb*2+11, 1) === '!')
                                tds[k].classList.add('lit');
                    }
                    document.getElementById('solution-word').style.display = curStep === steps.length-1 ? '' : 'none';
                }
                update();
                document.getElementById('prev').onclick = function() { if (curStep > 0             ) { curStep--; update(); } };
                document.getElementById('next').onclick = function() { if (curStep < steps.length-1) { curStep++; update(); } };
            </script>
        </div>
    </div>
</body>
</html>