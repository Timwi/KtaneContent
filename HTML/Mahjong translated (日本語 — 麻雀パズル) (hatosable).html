<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>麻雀パズル — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src='js/ruleseed.js'></script>
    <style>
        .tile {
            display: inline-block;
            position: relative;
        }
        .tile > img {
            width: 1.1cm;
        }
        div.row {
            text-align: center;
            margin: .2cm 0;
        }
        p.caption {
            text-align: center;
            font-weight: bold;
            text-decoration: underline;
            margin: .5cm 0 .2cm;
        }
        ul {
            margin: 1cm 0 .5cm;
        }
        ul.first {
            margin-top: .5cm;
        }
        li {
            margin: .15cm 0;
        }
        span.indicate {
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translate(-50%, 2px);
        }
    </style>
    <script>
        var _tiles = "Bamboo 2,Plum,Green Dragon,Spring,Bamboo 3,Winter,Bamboo,Bamboo 4,Bamboo 5,Bamboo 6,Bamboo 7,Bamboo 8,Summer,Bamboo 9,Bamboo 1,Char 1,Char 2,Orchid,Fall,Char 3,West,Char 4,Char 5,Char 6,Char 7,Char 8,Char 9,Wheel 1,Wheel 2,Wheel 3,Chrysanthemum,Wheel 4,Wheel 5,Wheel 6,Wheel 7,Wheel 8,Wheel 9,East,South,Red Dragon,White Dragon,North".split(',');

        function abbrev(name)
        {
            if (m = /^(\w)\w+ (\w|\d)\w*$/.exec(name))
                return m[1]+m[2];
            return name.substr(0, 2);
        }

        function setDefaultRules(rnd) { setRules(rnd); }
        function setRules(rnd)
        {
            var skip = rnd.next(0, 100);
            for (var i = 0; i < skip; i++)
                rnd.nextDouble();

            var tiles = _tiles.slice(0);
            rnd.shuffleFisherYates(tiles);

            var elems = document.getElementsByClassName('tile');
            for (var i = 0; i < 42; i++)
            {
                elems[i].firstChild.setAttribute('src', `img/Mahjong/${tiles[i]}.png`);
                elems[i].firstChild.setAttribute('alt', abbrev(tiles[i]));
                elems[i].setAttribute('title', `${tiles[i]}`);
            }
        }
    </script>
</head>
<body>
<div class="section">
    <div class="page page-bg-04">
        <div class="page-header">
            <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">麻雀パズル</span>
        </div>
        <div class="page-content">
            <img src="img/Component/Mahjong.svg" class="diagram">
                <h2>モジュール詳細：麻雀パズル</h2>
            <p class="flavour-text">桃、菖蒲、菊、竹だよ。覚えておいてね。</p>

            <ul class="first">
                <li>シリアルナンバーの最初の文字を取得する。それが英字の場合、アルファベット上の位置の数字に9を足した数を使用する。これが0-13の範囲ではない場合、そうでなくなるまで14を減算し続ける。</li>
                <li>その位置にある(0から数える)、以下のマッチリストの上段の麻雀牌を見つける。</li>
                <li>同じ処理をシリアルナンバーの二番目の文字に対しても行い、マッチリストの下段から対応する麻雀牌を見つける。</li>
                <li>その二つの牌を入れ替える。</li>
                <li>三番目と四番目も同じように行い、五番目と六番目も同じように行う。</li>
            </ul>

            <p class="caption">マッチリスト</p>
            <div class="row">
                <span class="tile highlightable" title="Char 1"><img src="img/Mahjong/Char 1.png"><span class='indicate'>0</span></span>
                <span class="tile highlightable" title="Bamboo 5"><img src="img/Mahjong/Bamboo 5.png"></span>
                <span class="tile highlightable" title="Wheel 5"><img src="img/Mahjong/Wheel 5.png"></span>
                <span class="tile highlightable" title="Bamboo 8"><img src="img/Mahjong/Bamboo 8.png"></span>
                <span class="tile highlightable" title="Bamboo 2"><img src="img/Mahjong/Bamboo 2.png"></span>
                <span class="tile highlightable" title="Char 9"><img src="img/Mahjong/Char 9.png"><span class='indicate'>5</span></span>
                <span class="tile highlightable" title="Red Dragon"><img src="img/Mahjong/Red Dragon.png"></span>
                <span class="tile highlightable" title="Bamboo 6"><img src="img/Mahjong/Bamboo 6.png"></span>
                <span class="tile highlightable" title="Bamboo 4"><img src="img/Mahjong/Bamboo 4.png"></span>
                <span class="tile highlightable" title="Wheel 4"><img src="img/Mahjong/Wheel 4.png"></span>
                <span class="tile highlightable" title="Char 6"><img src="img/Mahjong/Char 6.png"><span class='indicate'>10</span></span>
                <span class="tile highlightable" title="Char 2"><img src="img/Mahjong/Char 2.png"></span>
                <span class="tile highlightable" title="Wheel 2"><img src="img/Mahjong/Wheel 2.png"></span>
                <span class="tile highlightable" title="Char 3"><img src="img/Mahjong/Char 3.png"></span>
            </div>
            <div class="row">
                <span class="tile highlightable" title="Wheel 9"><img src="img/Mahjong/Wheel 9.png"></span>
                <span class="tile highlightable" title="Wheel 1"><img src="img/Mahjong/Wheel 1.png"></span>
                <span class="tile highlightable" title="Char 8"><img src="img/Mahjong/Char 8.png"></span>
                <span class="tile highlightable" title="Wheel 7"><img src="img/Mahjong/Wheel 7.png"></span>
                <span class="tile highlightable" title="Bamboo 9"><img src="img/Mahjong/Bamboo 9.png"></span>
                <span class="tile highlightable" title="Bamboo 7"><img src="img/Mahjong/Bamboo 7.png"></span>
                <span class="tile highlightable" title="Char 7"><img src="img/Mahjong/Char 7.png"></span>
                <span class="tile highlightable" title="White Dragon"><img src="img/Mahjong/White Dragon.png"></span>
                <span class="tile highlightable" title="Char 4"><img src="img/Mahjong/Char 4.png"></span>
                <span class="tile highlightable" title="Bamboo 3"><img src="img/Mahjong/Bamboo 3.png"></span>
                <span class="tile highlightable" title="Wheel 8"><img src="img/Mahjong/Wheel 8.png"></span>
                <span class="tile highlightable" title="Wheel 3"><img src="img/Mahjong/Wheel 3.png"></span>
                <span class="tile highlightable" title="Wheel 6"><img src="img/Mahjong/Wheel 6.png"></span>
                <span class="tile highlightable" title="Char 5"><img src="img/Mahjong/Char 5.png"></span>
            </div>

            <ul>
                <li>モジュールの左下隅にある余った牌を特定し、以下のカウントリストにおける位置(0から数える)を特定する。</li>
                <li>マッチリストの下段をその数だけ右に移動させる。</li>
            </ul>

            <p class="caption">カウントリスト</p>
            <div class="row">
                <span class="tile highlightable" title="Bamboo 1"><img src="img/Mahjong/Bamboo 1.png"><span class='indicate'>0</span></span>
                <span class="tile highlightable" title="Plum"><img src="img/Mahjong/Plum.png"></span>
                <span class="tile highlightable" title="Orchid"><img src="img/Mahjong/Orchid.png"></span>
                <span class="tile highlightable" title="Chrysanthemum"><img src="img/Mahjong/Chrysanthemum.png"></span>
                <span class="tile highlightable" title="Bamboo"><img src="img/Mahjong/Bamboo.png"></span>
                <span class="tile highlightable" title="Spring"><img src="img/Mahjong/Spring.png"><span class='indicate'>5</span></span>
                <span class="tile highlightable" title="Summer"><img src="img/Mahjong/Summer.png"></span>
                <span class="tile highlightable" title="Fall"><img src="img/Mahjong/Fall.png"></span>
                <span class="tile highlightable" title="Winter"><img src="img/Mahjong/Winter.png"></span>
                <span class="tile highlightable" title="North"><img src="img/Mahjong/North.png"></span>
                <span class="tile highlightable" title="East"><img src="img/Mahjong/East.png"><span class='indicate'>10</span></span>
                <span class="tile highlightable" title="South"><img src="img/Mahjong/South.png"></span>
                <span class="tile highlightable" title="West"><img src="img/Mahjong/West.png"></span>
                <span class="tile highlightable" title="Green Dragon"><img src="img/Mahjong/Green Dragon.png"></span>
            </div>

            <ul>
                <li>モジュール上において、ある牌の左右に隣接する牌がなく、その上にも(部分的である場合も含め)牌が重なっていない場合、その牌は「<em>有効</em>」である。</li>
                <li>マッチリスト上で絵柄が縦に並んでいる、モジュール上の<em>有効</em>な牌のペアを選択する。</li>
                <li>正しいペアは消える。不正解のペアはミスが記録される。</li>
                <li>すべての牌が除外されると、モジュールは解除される。</li>
            </ul>
        </div>
        <div class="page-footer relative-footer">ページ 1/1</div>
    </div>
</div>
</body>
</html>