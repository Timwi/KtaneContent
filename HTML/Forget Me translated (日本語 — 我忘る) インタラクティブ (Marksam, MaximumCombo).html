<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>我忘る — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        table {
            margin: 1em auto;
            font-size: 200%;
        }
        ul {
            padding-bottom: 10px;
        }

        .button {
            width: 100px;
            height: 50px;
            font-size: 15px;
            font-weight: bold;
        }

        .tileGrid {
            padding-top: 50px;
            display: table;
            border-spacing: 5px;
            margin: auto;
        }
            .tileGrid div {
                display: table-row;
            }
                .tileGrid div div {
                    width: 125px;
                    height: 125px;
                    border: 3pt solid;
                    display: table-cell;
                    text-align: center;
                    vertical-align: middle;
                    font-size: 40px;
                    font-weight: bold;
                }
                .tileGrid div div:hover:not(.disabled) {
                    background-color: gray;
                }
                .tileGrid div div.disabled {
                    border: none;
                }
                .tileGrid div div.selected {
                    background-color: darkgray;
                }
        
        .origin-font {
            font-family: "Special Elite";
        }

    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01 strip">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">我忘る</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Forget Me.svg" class="diagram">
                <h2>モジュール詳細：我忘る</h2>
                <p class="flavour-text">これはかまって欲しいみたいだけど、そんなことは気にするな!</p>

                    <ul>
                        <li>モジュールにはキーパッドのボタンが付いており、その内の一つのキーパッドの LED が点灯している。右の画面と下の画面には数字が表示される。1-9 のボタンを押すとそのボタンに割り当てられた数字のペアが画面に表示される。</li>
                        <li>「0」のボタンを押すと入力状態に移行する。これ以降に数字のボタンを押すと、その数字をモジュールに入力しようとする。</li>
                    </ul>
                    <ul>
                        <li>このモジュールは 3×3 のスライドパズルをシミュレートしている。パズルの初期状態を特定するには、それぞれの数字のペアを取り、<strong>右</strong>のディスプレーに表示された数字を基に<strong>昇順</strong>に並び替える。順番に<strong>下</strong>のディスプレーに表示された数字を取って 9 桁のシーケンスを作成する。</li>
                        <li>これらの数字の読み順がスライドパズルの初期配置を表している。数字の 0 は空白のスペースを意味する。</li>
                    </ul>
                    <ul>
                        <li>このスライドパズルの解答を特定するには、次のページの表を使用する。シリアルナンバーの<strong>3番目</strong>の文字の<strong>列</strong>とシリアルナンバーの<strong>6番目</strong>の文字の<strong>段</strong>が交差するセルから開始する。表の一番左上のセルは (0,0) である。空のシーケンスにこのセルの数字を追加する。</li>
                        <li>その後、今までに訪れていない、上下左右に隣接したセルに<strong>読み順</strong>で訪れる。そのセル内の数字がシーケンスに現れていない場合、その数字をシーケンスに加える。この動作を新しく隣接するセルに対して行い、シーケンスに 0–8 の数字がそれぞれ少なくとも一つ含まれるまで続ける。このシーケンスの読み順がパズルの解答となる。</li>
                    </ul>
                    <ul>
                        <li>コードを送信するとき、それぞれの数字はスライドパズル上のその数字を空白に動かす。数字が空白のスペースに隣接している時にそれぞれの位置を交換する。隣接していない場合、入力した瞬間にモジュールは即刻ミスを記録する。「9」のボタンを押すと常にミスが記録される。こんなバカなことをしてはならない。絶対に。</li>
                        <li>数字を入力し、スライドパズルを解答と同じ状態にした後、「0」のボタンをもう一度押すことでモジュールは解除される。</li>
                    </ul>
                    <ul>
                        <li>ミスが記録された時、「0」のボタンの LED が点灯することがある。この時、ボタンを押すとモジュールを初期状態にリセットすることができる。</li>
                    </ul>
             </div>
            <div class="page-footer relative-footer">ページ 1/2</div>
        </div>
        <div class="page page-bg-02 strip">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">我忘る</span>
            </div>
            <div class="page-content">
                    <h2>表</h2>
                <table class="origin-font">
                        <tr> <td>1</td> <td>7</td> <td>3</td> <td>2</td> <td>6</td> <td>5</td> <td>0</td> <td>4</td> <td>1</td> <td>8</td> </tr>
                        <tr> <td>0</td> <td>8</td> <td>1</td> <td>5</td> <td>2</td> <td>6</td> <td>2</td> <td>3</td> <td>4</td> <td>7</td> </tr>
                        <tr> <td>2</td> <td>1</td> <td>6</td> <td>3</td> <td>8</td> <td>4</td> <td>5</td> <td>7</td> <td>0</td> <td>4</td> </tr>
                        <tr> <td>7</td> <td>3</td> <td>4</td> <td>2</td> <td>4</td> <td>1</td> <td>8</td> <td>6</td> <td>8</td> <td>0</td> </tr>
                        <tr> <td>8</td> <td>5</td> <td>7</td> <td>4</td> <td>5</td> <td>0</td> <td>1</td> <td>3</td> <td>2</td> <td>6</td> </tr>
                        <tr> <td>4</td> <td>2</td> <td>5</td> <td>6</td> <td>1</td> <td>8</td> <td>5</td> <td>0</td> <td>7</td> <td>3</td> </tr>
                        <tr> <td>6</td> <td>0</td> <td>8</td> <td>7</td> <td>3</td> <td>2</td> <td>4</td> <td>1</td> <td>6</td> <td>5</td> </tr>
                        <tr> <td>3</td> <td>4</td> <td>0</td> <td>1</td> <td>3</td> <td>7</td> <td>0</td> <td>8</td> <td>5</td> <td>2</td> </tr>
                        <tr> <td>4</td> <td>5</td> <td>6</td> <td>0</td> <td>7</td> <td>8</td> <td>6</td> <td>2</td> <td>3</td> <td>1</td> </tr>
                        <tr> <td>5</td> <td>6</td> <td>2</td> <td>8</td> <td>0</td> <td>3</td> <td>7</td> <td>5</td> <td>1</td> <td>4</td> </tr>
                  </table>
             </div>
            <div class="page-footer relative-footer">ページ 2/2</div>
        </div>
        <div class="page page-bg-03 strip">
                <div class="page-header">
                    <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">我忘る</span>
                </div>
                <div class="page-content">
                    <h2>スライドパズルのやつ</h2>
                    <div class="tileGrid table origin-font">
                        <div>
                            <div onclick="handleClick(0)" class="tile"></div>
                            <div onclick="handleClick(1)" class="tile"></div>
                            <div onclick="handleClick(2)" class="tile"></div>
                        </div>
                        <div>
                            <div onclick="handleClick(3)" class="tile"></div>
                            <div onclick="handleClick(4)" class="tile"></div>
                            <div onclick="handleClick(5)" class="tile"></div>
                        </div>
                        <div>
                            <div onclick="handleClick(6)" class="tile"></div>
                            <div onclick="handleClick(7)" class="tile"></div>
                            <div onclick="handleClick(8)" class="tile"></div>
                        </div>
                    </div>
                    <button class="button" onclick="handleClick(9)">スライドモード <span style="color: #F00000">オフ</span></button>
                    <ul>
                        <li>入力状態とスライドパズルを切り替えるには「スライドモード」のボタンを使用する。</li>
                        <li>タイルを選択されている状態で、キーボードを使用すると数字を入力できる。</li>
                    </ul>
                    <script>
                        document.addEventListener('keydown', keyPress);
                        const girdNeighbors = [[1, 3], [0, 2, 4], [1, 5], [0, 4, 6], [1, 3, 5, 7], [2, 4, 8], [3, 7], [4, 6, 8], [5, 7]];

                        let currentGrid = [
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null},
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null},
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: false, label: null}
                        ];
                        let slideMode = false;

                        let tiles = document.getElementsByClassName("tile");
                        let button = document.getElementsByClassName("button")[0];
                        tiles[8].className += " disabled";

                        function handleClick(index) {
                            switch(index){
                                case 9:
                                    slideMode = !slideMode;
                                    for (let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected){
                                            currentGrid[i].selected = false;
                                            tiles[i].className = "tile";
                                        }
                                    }
                                    currentGrid.forEach(x => x.selected = false);
                                    button.innerHTML = `スライドモード ` + (slideMode ? `<span style="color: #00A000">オン</span>` : `<span style="color: #F00000">オフ</span>`);
                                    break;
                                default:
                                    if(slideMode) {
                                        if(!currentGrid[index].enabled)
                                            return;
                                        let neighbors = girdNeighbors[index];
                                        let moveTo = null;
                                        for(let i = 0; i < neighbors.length; i++) {
                                            if(!currentGrid[neighbors[i]].enabled) {
                                                moveTo = neighbors[i];
                                                break;
                                            }
                                        }
                                        if(moveTo != null) {
                                            currentGrid[index].enabled = false;
                                            currentGrid[moveTo].label = currentGrid[index].label;
                                            currentGrid[index].label = null;
                                            currentGrid[moveTo].enabled = true;
                                            tiles[index].className = "tile disabled";
                                            tiles[index].innerHTML = "";
                                            tiles[moveTo].innerHTML = currentGrid[moveTo].label;
                                            tiles[moveTo].className = "tile"
                                        }
                                    }
                                    else {
                                        if(!currentGrid[index].enabled) break;
                                        if(currentGrid[index].selected) {
                                            currentGrid[index].selected = false;
                                            tiles[index].className = "tile";
                                            break;
                                        }
                                        for (let i = 0; i < currentGrid.length; i++) {
                                            if(currentGrid[i].selected) {
                                                currentGrid[i].selected = false;
                                                tiles[i].className = "tile";
                                            }
                                        }
                                        currentGrid[index].selected = true;
                                        tiles[index].className = "tile selected";
                                    }
                                    break;
                            }
                        }

                        function keyPress(e){
                            if(!slideMode && currentGrid.some(x => x.selected)) {
                                if(e.code == "Backspace") {
                                    for(let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected) {
                                            currentGrid[i].label = null;
                                            tiles[i].innerHTML = "";
                                        }
                                    }
                                    return;
                                }
                                let input = e.code.toLowerCase().replace(/(numpad|digit)/g, "");
                                if("12345678".includes(input)){
                                    for(let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected) {
                                            currentGrid[i].label = input;
                                            tiles[i].innerHTML = input;
                                        }
                                    }
                                }
                            }
                        }
                    </script>
                 </div>
                <div class="page-footer relative-footer">ページ 2/2</div>
        </div>
    </div>
</body>
</html>