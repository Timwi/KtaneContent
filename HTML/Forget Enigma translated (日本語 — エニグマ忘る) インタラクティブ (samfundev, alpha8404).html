<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>エニグマ忘る — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        .dark table, table {
            border: none;
            margin: 1em auto;
        }

        .strip-change-one td,
        .strip-change-one th {
            padding: .3em .5em .2em;
        }

        /* Interactive */
        #interactive {
            font-size: 12.5px;
            font-family: 'Special Elite';
        }

        #interactive td.borderless:first-child {
            padding: .3em;
        }

        button {
            font-family: Special Elite;
            background-color: white;
            color: black;
            padding: 1px 3px;
            border-radius: 5px;
            border: black 2px solid;
            transition: 0.3s;
        }

        button:hover {
            background-color: black;
            color: white;
        }
        .reflector { font-size: 14px; }
        .spacer { height: 20px; }
        .label {
            font-size: 40px;
            line-height: 1;
            text-align: center;
            padding: 0.2em 0.6em 0
        }
        .dark img:not(.diagram) { filter: invert(87%) hue-rotate(180deg); }
    </style>
    <script src="js/jquery.3.7.0.min.js"></script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">エニグマ忘る</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Forget Enigma.svg" class="diagram">
                <h2>モジュール詳細：エニグマ忘る</h2>
                <p class="flavour-text">「私の心はエニグマのようだ」 - 爆弾より</p>
                <p>このモジュールには、ローター/リフレクターの構成が表示されたディスプレー、ローター、一文字が光るキーボードで構成されている。</p>
                <p><a href="../More/Ignore Table.html#mod=forgetEnigma">無視されないモジュール</a>が解除されるたびに、ステージ番号が1つ上がり、ローターが変更され、新しい文字が点灯する。</p>
                <p>このモジュールを解除するには、以下の仕組みを理解して英字を解読する必要がある。</p>
                <h3>ステップ1:ローター/リフレクターの構成</h3>
                <p>上部のディスプレーには、使用されているローターの種類、使用されている順番、及び使用されているリフレクターが表示される。正しいローターチャートと正しいリフレクターを使用して「エニグマ解読機」を作成する。</p>
                <p>ディスプレーの構成は「リフレクター」「下部ローター」「上部ローター」である。上部ローターの上にはキーボードとしてAからZのアルファベット全体がある。</p>
                <p>エニグマ解読機を作成するには、下部の表を使用する。</p>
                <p>ディスプレーの左にある英字は、各ローターをどうずらすかを表示している(左の英字=下部ローター/右の英字=上部ローター)。各ローターの表の左下の英字が表示された英字になるようにローターをずらす必要がある。</p>

                <table id="interactive" class="borderless"></table>
            </div>
            <div class="page-footer relative-footer">ページ 1/3</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">エニグマ忘る</span>
            </div>
            <div class="page-content">
                <h2>エニグマ回路図</h2>
                <table>
                    <tr class="reflector">
                        <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th><th>M</th>
                        <th>N</th><th>O</th><th>P</th><th>Q</th><th>R</th><th>S</th><th>T</th><th>U</th><th>V</th><th>W</th><th>X</th><th>Y</th><th>Z</th>
                    </tr>
                    <tr><td class="spacer corner" colspan="26"></td></tr>
                    <tr><td class="label" colspan="26">上のローター/右のローター</td></tr>
                    <tr><td class="spacer corner" colspan="26"></td></tr>
                    <tr><td class="label" colspan="26">下のローター/左のローター</td></tr>
                    <tr><td class="spacer corner" colspan="26"></td></tr>
                    <tr><td class="label" colspan="26">リフレクター</td></tr>
                </table>
                <h3>ステップ2:エニグマ解読機の使用</h3>
                <ol>
                    <li>キーボードの点灯している英字を一番上のキーボード列から見つける。</li>
                    <li>その英字の真下にある上部ローター上の段の英字を新しい英字とする。</li>
                    <li>新しい英字を上部ローターの下の段で見つける。</li>
                    <li>その英字の真下にある下部ローター上の段の英字を新しい英字とする。</li>
                    <li>新しい英字を下部ローターの下の段で見つける。</li>
                    <li>その英字の真下にあるリフレクターの上の段の英字を新しい英字とする。</li>
                    <li>その英字の真下にあるリフレクターの下の段の英字を新しい英字とし、リフレクターの上の段からその英字を見つける。</li>
                    <li>その英字の真上にある下部ローターの下の段の英字を新しい英字とする。</li>
                    <li>新しい英字を下部ローターの上の段で見つける。</li>
                    <li>その英字の真上にある上部ローターの下の段の英字を新しい英字とする。</li>
                    <li>新しい英字を上部ローターの上の段で見つける。</li>
                    <li>その英字の真上にあるキーボード列の英字が解読された英字である。</li>
                </ol>
            </div>
            <div class="page-footer relative-footer">ページ 2/3</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">エニグマ忘る</span>
            </div>
            <div class="page-content">
                <p style='text-align: center'><img src="img/Forget Enigma/DecryptSteps.png" style="width: 16cm"></p>
                <h3>ステップ3:ローター変更</h3>
                <p>モジュールが解除されるたびにローターの英字が変更されるが、ランダムではない。以下に、ローターの英字の変更方法が記載されている。</p>
                <p>各ローターの下の段の英字の一部に「*」がついている。これらがローターの英字の変更に影響してくる:</p>
                <ul>
                    <li>アスタリスクが上部ローターの左端にある場合、次のステージでは上部/下部ローターの両方が変更される。</li>
                    <li>それ以外の場合、次のステージでは上部ローターのみが変更される。</li>
                    <li>ローターの変更は1つ左にずらす必要がある(A→B,G→H,Z→A)。</li>
                </ul>
            </div>
            <div class="page-footer relative-footer">ページ 3/3</div>
        </div>
    </div>
    <script>
        const cyclers = {
            "ローターI": [
                ["E", "K", "M", "F", "L", "G", "D", "Q", "V", "Z", "N", "T", "O", "W", "Y", "H", "X", "U", "S", "P", "A", "I", "B", "R", "C", "J"],
                ["A", "B", "C", "D*", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q*", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
            ],
            "ローターII": [
                ["A", "J", "D", "K", "S", "I", "R", "U", "X", "B", "L", "H", "W", "T", "M", "C", "Q", "G", "Z", "N", "P", "Y", "F", "V", "O", "E"],
                ["A", "B", "C", "D", "E*", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R*", "S", "T", "U", "V", "W", "X", "Y", "Z"],
            ],
            "ローターIII": [
                ["B", "D", "F", "H", "J", "L", "C", "P", "R", "T", "X", "V", "Z", "N", "Y", "E", "I", "W", "G", "A", "K", "M", "U", "S", "Q", "O"],
                ["A", "B", "C", "D", "E", "F", "G", "H", "I*", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V*", "W", "X", "Y", "Z"],

            ],
            "ローターIV": [
                ["E", "S", "O", "V", "P", "Z", "J", "A", "Y", "Q", "U", "I", "R", "H", "X", "L", "N", "F", "T", "G", "K", "D", "C", "M", "W", "B"],
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J*", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W*", "X", "Y", "Z"],

            ],
            "ローターV": [
                ["V", "Z", "B", "R", "G", "I", "T", "Y", "U", "P", "S", "D", "N", "H", "L", "X", "A", "W", "M", "J", "Q", "O", "F", "E", "C", "K"],
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M*", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z*"],

            ],
            "ローターVI": [
                ["J", "P", "G", "V", "O", "U", "M", "F", "Y", "Q", "B", "E", "N", "H", "Z", "R", "D", "K", "A", "S", "X", "L", "I", "C", "T", "W"],
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L*", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y*", "Z"],

            ],
            "ローターVII": [
                ["N", "Z", "J", "H", "G", "R", "C", "X", "M", "Y", "S", "W", "B", "O", "U", "F", "A", "I", "V", "L", "P", "E", "K", "Q", "D", "T"],
                ["A", "B", "C", "D", "E", "F", "G", "H*", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U*", "V", "W", "X", "Y", "Z"],

            ],
            "ローターVIII": [
                ["F", "K", "Q", "H", "T", "L", "X", "O", "C", "B", "J", "S", "P", "D", "Z", "R", "A", "M", "E", "W", "N", "I", "U", "Y", "G", "V"],
                ["A", "B", "C*", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P*", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],

            ],
            "リフレクターA": [
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                ["L", "U", "S", "N", "P", "Q", "O", "M", "J", "I", "Y", "A", "H", "D", "G", "E", "F", "X", "C", "V", "B", "T", "Z", "R", "K", "W"],

            ],
            "リフレクターB": [
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                ["X", "Q", "U", "M", "F", "E", "P", "O", "W", "L", "T", "J", "D", "Z", "H", "G", "B", "V", "Y", "K", "C", "R", "I", "A", "S", "N"],

            ],
            "リフレクターC": [
                ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                ["E", "S", "K", "O", "A", "Q", "M", "J", "Y", "H", "C", "P", "G", "T", "D", "L", "F", "U", "B", "N", "R", "X", "Z", "V", "I", "W"],
            ],
        };

        function mod26(n) {
            return ((n % 26) + 26) % 26;
        }

        const interactive = $("#interactive");

        // Make the keyboard
        const keyboard = $("<tr>").appendTo(interactive);

        $("<td>").addClass("borderless").appendTo(keyboard);
        // The top row of any reflector is just A–Z.
        for (let i = 0; i < 26; i++) {
            $("<td>").text(cyclers["リフレクターA"][0][i]).appendTo(keyboard);
        }

        // Make the cyclers
        function makeCycler(names, controls = true) {
            let position = 0;
            let name = names[0];

            const update = () => {
                for (let i = 0; i < 26; i++) {
                    topRow.children().eq(i + 1).text(cyclers[name][0][mod26(i + position)]);
                    bottomRow.children().eq(i).text(cyclers[name][1][mod26(i + position)]);
                }
            };

            const selector = $("<select>");
            for (const name of names) {
                $("<option>").attr("value", name).text(name).appendTo(selector);
            }

            selector.change(() => { name = selector.val(); update(); });

            const selectorRow = $("<tr>").appendTo(interactive);
            $("<td>").addClass("borderless").appendTo(selectorRow);
            $("<td colspan='26' class='corner'>").append(selector).appendTo(selectorRow);

            const topRow = $("<tr>").appendTo(interactive);
            if (controls) {
                const shiftLeft = $("<button>").text("←").click(() => { position++; update(); });
                $("<td rowspan=2>").addClass("borderless").append(shiftLeft).appendTo(topRow);
            } else {
                $("<td rowspan=2>").addClass("borderless").appendTo(topRow);
            }

            const bottomRow = $("<tr>").appendTo(interactive);

            for (let i = 0; i < 26; i++) {
                $("<td>").appendTo(topRow);
                $("<td>").appendTo(bottomRow);
            }

            if (controls) {
                const shiftRight = $("<button>").text("→").click(() => { position--; update(); });
                $("<td rowspan=2>").addClass("borderless").append(shiftRight).appendTo(topRow);
            }

            update();
        }

        // Make the rotors
        const rotorNames = Object.keys(cyclers).filter(name => name.includes("ローター"));
        for (let i = 0; i < 2; i++) {
            makeCycler(rotorNames);
        }

        // Make the reflector
        makeCycler(Object.keys(cyclers).filter(name => name.includes("リフレクター")), false);
    </script>
</body>
</html>