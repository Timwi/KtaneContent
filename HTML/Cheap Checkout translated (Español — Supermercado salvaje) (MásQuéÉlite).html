<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Supermercado salvaje — Módulo de Keep Talking and Nobody Explodes</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/ruleseed.js"></script>
    <style>
        .sale {
            margin-bottom: 5px;
        }

        .squished {
            margin-top: 0px;
            margin-bottom: 0px;
        }
    </style>
    <script>
        let Prices = [
            // Original 34 items
            "Candy Canes,3.51,Dulce",
            "Socks,6.97,Otros",
            "Lotion,7.97,Higiene",
            "Cheese,4.49,Lácteos",
            "Mints,6.39,Dulce",
            "Grape Jelly,2.98,Dulce",
            "Honey,8.25,Dulce",
            "Sugar,2.08,Dulce",
            "Soda,2.05,Dulce",
            "Tissues,3.94,Higiene",
            "White Bread,2.43,Pasta",
            "Canola Oil,2.28,Aceite",
            "Mustard,2.36,Otros",
            "Deodorant,3.97,Higiene",
            "White Milk,3.62,Lácteos",
            "Pasta Sauce,2.30,Verduras",
            "Lollipops,2.61,Dulce",
            "Cookies,2.00,Dulce",
            "Paper Towels,9.46,Higiene",
            "Tea,2.35,Agua",
            "Coffee Beans,7.85,Otros",
            "Mayonnaise,3.99,Aceite",
            "Chocolate Milk,5.68,Lácteos",
            "Frutas Punch,2.08,Dulce",
            "Potato Chips,3.25,Aceite",
            "Shampoo,4.98,Higiene",
            "Toothpaste,2.50,Higiene",
            "Peanut Butter,5.00,Proteínas",
            "Gum,1.12,Dulce",
            "Agua Bottles,9.37,Agua",
            "Spaghetti,2.92,Pasta",
            "Chocolate Bar,2.10,Dulce",
            "Ketchup,3.59,Otros",
            "Cereal,4.19,Pasta",

            // New rule seed items
            "Eggs,2.67,Proteínas",
            "Baked Beans,1.14,Proteínas",
            "Peanuts,5.98,Proteínas",
            "Yogurt,2.72,Lácteos",
            "Greek Yogurt,3.47,Lácteos",
            "Butter,5.86,Lácteos",
            "Toothbrush,2.24,Higiene",
            "Medicine,3.73,Higiene",
            "Soup,1.99,Otros",
            "Soap,3.97,Higiene",
            "Pretzels,2.98,Pasta",
            "Popcorn,2.50,Pasta",
            "Oatmeal,7.98,Pasta",
            "Rice,2.02,Pasta",
            "Flour,3.49,Pasta",
            "Licorice,1.98,Dulce",
            "Pie,3.98,Dulce",
            "Cake,9.98,Dulce",
            "Gummy Bears,7.98,Dulce",
            "Relish,2.74,Verduras",
            "Napkins,1.09,Higiene",
            "Band-Aids,1.11,Higiene",
            "Playing Cards,2.13,Otros",
            "Beef Jerky,1.23,Otros",
            "Ice Cream,4.99,Lácteos",
            "Salad Mix,2.47,Verduras",
            "Bagel,4.20,Pasta",
            "Verduras Oil,2.89,Aceite",
            "Batteries,4.49,Otros",
            "Taco Shells,5.01,Pasta",
            "Bleach,6.90,Otros",
            "Baking Soda,0.33,Otros",
            "Paper Bags,1.07,Otros",
            "Printer Paper,4.49,Otros",
            "Diapers,6.96,Higiene",
            "Shower Gel,1.63,Higiene",
            "Makeup Remover,1.02,Higiene",
            "Blank DVDs,9.00,Otros",
            "Nail Polish,3.13,Higiene",
            "Fusilli,2.92,Pasta",
            "Tagliatelle,2.92,Pasta",
            "Spirelli,2.92,Pasta",
            "Penne,2.92,Pasta",
            "Car Engine Oil,3.36,Aceite",
            "Parsley,0.69,Condimentos",
            "Sage,1.75,Condimentos",
            "Rosemary,3.19,Condimentos",
            "Thyme,2.89,Condimentos",
            "White Pepper,2.49,Condimentos",
            "Coriander,0.99,Condimentos",
            "Oregano,1.59,Condimentos",
            "Cumin,3.45,Condimentos",
            "Masala,4.99,Condimentos",
            "Saffron,12.79,Condimentos",
            "Cinnamon,2.40,Condimentos",
            "Cayenne Pepper,11.27,Condimentos",
            "Ginger Root,1.00,Condimentos",
            "Salt,3.98,Condimentos",
            "Sesame,3.19,Condimentos",
            "Vanilla Extract,11.82,Condimentos",
            "Red Wine,20.90,Agua",
            "White Wine,18.60,Agua",
            "12-pack Beer,10.49,Agua",
            "6-pack Beer,5.79,Agua",
            "Vinegar,2.50,Otros",
        ];

        let PricesLB = [
            // Original 12 weight based items
            "Turkey,2.98,Proteínas",
            "Chicken,1.99,Proteínas",
            "Steak,4.97,Proteínas",
            "Pork,4.14,Proteínas",
            "Lettuce,1.10,Verduras",
            "Potatoes,0.68,Verduras",
            "Tomatoes,1.80,Frutas",
            "Broccoli,1.39,Verduras",
            "Oranges,0.80,Frutas",
            "Lemons,1.74,Frutas",
            "Bananas,0.87,Frutas",
            "Grapefruit,1.08,Frutas",

            // New rule seed weight based items
            "Onions,1.82,Verduras",
            "Bacon,5.52,Proteínas",
            "Apples,1.32,Frutas",
            "Grapes,2.98,Frutas",
            "Fish,9.99,Proteínas",
            "Aguamelons,0.32,Frutas",
            "Carrots,0.77,Verduras",
            "Cherries,3.21,Frutas",
            "Plums,1.99,Frutas",
            "Pumpkins,1.38,Frutas",
            "Avocados,2.23,Frutas",
            "Ham,2.88,Proteínas",
            "Sausages,3.88,Proteínas",
            "Corn,1.14,Verduras",
            "Pears,1.74,Frutas",
            "Leek,3.17,Verduras",
            "Bologna,1.69,Proteínas",
            "Minced Beef,2.36,Proteínas",
            "Garlic,0.97,Verduras",
            "Tofu,3.11,Proteínas",
            "Salmon,21.55,Proteínas",
        ];

        let SundayValue = 215;
        let MondayPercent = 85;
        let TuesdayExcludedDigit = -1;
        let WednesdayLargeOrSmall = true;
        let WednesdayViceVersa = true;
        let ThursdayOddItems = true;
        let ThursdayPercent = 50;
        let FridayPercent = 125;
        let SaturdayPercent = 65;

        function toDollars(intDollars) {
            const stringDollars = intDollars.toString();
            if (intDollars < 100) return "0." + intDollars;
            else return stringDollars.substring(0, stringDollars.length - 2) + "." + stringDollars.substring(stringDollars.length - 2);
        }

        function toRelativePercent(absolutePercent) {
            if (absolutePercent > 100) return `un ${absolutePercent - 100}% más`;
            else if (absolutePercent == 50) return "la mitad";
            else return `un ${100 - absolutePercent}% menos`;
        }

        function setDefaultRules(rng) {
            setRules(rng);
        }

        function setRules(rng) {
            var prices, pricesLB;
            if (rng.seed == 1)
            {
                prices = Prices.slice(0, 34);
                pricesLB = PricesLB.slice(0, 12);
            }
            else
            {
                prices = rng.shuffleFisherYates(Prices.slice(0)).slice(0, 34);
                pricesLB = rng.shuffleFisherYates(PricesLB.slice(0)).slice(0, 12);

                for (var [index, item] of prices.entries()) {
                    var split = item.split(",");
                    var intDollars = parseInt(split[1].replace(".", ""));
                    intDollars += rng.next(-10, 11);
                    split[1] = toDollars(intDollars);
                    prices[index] = split.join(",");
                }

                for (var [index, item] of pricesLB.entries()) {
                    var split = item.split(",");
                    var intDollars = parseInt(split[1].replace(".", ""));
                    intDollars += rng.next(-10, 11);
                    split[1] = toDollars(intDollars);
                    pricesLB[index] = split.join(",");
                }

                SundayValue = rng.next(50, 301);
                MondayPercent = rng.next(10, 100);
                TuesdayExcludedDigit = rng.next(-1, 3);
                WednesdayLargeOrSmall = rng.next(0, 2) == 1;
                WednesdayViceVersa = rng.next(0, 2) == 1;
                ThursdayOddItems = rng.next(0, 2) == 1;
                ThursdayPercent = rng.next(25, 76);
                FridayPercent = rng.next(50, 201);
                SaturdayPercent = rng.next(50, 201);
            }

            const seededStrings = [
                toDollars(SundayValue),
                toRelativePercent(MondayPercent),
                TuesdayExcludedDigit == -1 ? "" : ` excluyendo el dígito en las ${["unidades", "decenas", "centenas"][TuesdayExcludedDigit]}`,
                WednesdayLargeOrSmall ? "el mayor" : "el menor",
                WednesdayLargeOrSmall ? "el menor" : "el mayor",
                WednesdayViceVersa ? ", y viceversa" : "",
                ThursdayOddItems ? "impar" : "par",
                toRelativePercent(ThursdayPercent),
                toRelativePercent(FridayPercent),
                toRelativePercent(SaturdayPercent)
            ];

            const seededSpans = document.querySelectorAll("span.rule-seeded");
            for (const [index, seededSpan] of seededSpans.entries()) {
                seededSpan.textContent = seededStrings[index];
            }

            const rows = Array.from(document.querySelectorAll("tr")).slice(1);
            for (const [index, itemString] of prices.concat(pricesLB).sort().entries()) {
                const children = rows[index % rows.length].children;
                const item = itemString.split(",");
                const columnOffset = Math.floor(index / rows.length) * 4;

                children[columnOffset].textContent = item[0];
                children[columnOffset + 1].textContent = `$${item[1]}${pricesLB.includes(itemString) ? " por lb" : "" }`;
                children[columnOffset + 2].textContent = item[2];
            }
        }
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Mod de Keep Talking and Nobody Explodes</span>
                <span class="page-header-section-title">Supermercado salvaje</span>
            </div>
            <div class="page-content">
                <img class="diagram" src="img/Component/Cheap%20Checkout.svg">
                <h2>En caso del supermercado salvaje</h2>
                <p class="flavour-text">¿Quién diantres compraría algo a estas horas?</p>
                <ul class="squished">
                    <li>Hay una lista de la compra con productos comprados que se puede ir viendo con las flechas</li>
                    <li>Arriba de ello, está el dinero que el cliente ha pagado.</li>
                    <li>Suma el precio de todos los productos, aplicando antes el descuento correspondiente a cada producto dependiendo del día de la semana</li>
                    <li>Los productos cuyo precio dependan de las libras compradas, se le deben ajustar su precio por eso antes de aplicar el descuento.</li>
                    <li>Si el cliente ha pagado el dinero suficiente, simplemente pon el cambio que debería recibir usando los botones con números y luego pulsa submit.</li>
                    <li>En caso contrario, pulsa el botón submit sin poner nada para avisar al cliente. Espera a que se muestre el nuevo montón de dinero que el cliente va a pagar y ya ahí pon el cambio.</li>
                    <li>Después de pulsar el botón submit, las cuentas se habrán arreglado.</li>
                </ul>
                <h3 class="squished">Glosario</h3>
                <ul class="squished">
                    <li>El precio del producto se refiere al precio antes de que haya pasado por el descuento.</li>
                    <li>Los productos con precios fijos son los cuales su precio no depende del peso comprado.</li>
                    <li>La raíz digital se calcula sumando todos los dígitos de un número, y repitiendo ese mismo proceso hasta que acabas con un único dígito.</li>
                    <li>El redondeo comercial se hace cuando el último decimal es 5 o mayor; se redondea hacia arriba si tal es el caso, y en caso contrario hacia abajo.</li>
                </ul>

                <h3 class="squished">Descuentos:</h3>
                <div style="font-style: italic; font-size: 13px;">El día de la semana es el día que marca el ordenador del desactivador cuando el módulo se activa.</div>

                <em>Domingo especial</em>
                <div class="sale">Todos los productos con precio fijo que tengan una S valen $<span class="rule-seeded">2.15</span> menos.</div>

                <em>Lunes maleable</em>
                <div class="sale">El primer, tercer y sexto producto de la lista de la compra valen <span class="rule-seeded"> un 15% menos</span>.</div>

                <em>Martes incordioso</em>
                <div class="sale">Calcula la raíz digital del precio del producto sin el punto decimal<span class="rule-seeded"></span>. Añade esa cantidad de dólares al precio final del producto. ESto solamente aplica a los productos con precio fijo</div>

                <em>Miércoles loco</em>
                <div class="sale">Cambia <span class="rule-seeded">el mayor</span> dígito en el precio con <span class="rule-seeded">el menor</span> dígito en el precio<span class="rule-seeded">, y viceversa</span>. Si hay varios del mayor/menos número, aplica la norma a todos esos.</div>

                <em>Jueves emocionante</em>
                <div class="sale">Todos los productos que estén en una posición<span class="rule-seeded">impar</span> en la lista de la compra valen <span class="rule-seeded">la mitad</span>.</div>

                <em>Viernes frutástico</em>
                <div class="sale">Todas las frutas valen un <span class="rule-seeded">25% más</span> por libra.</div>

                <em>Sábado dulce</em>
                <div class="sale">Todos los dulces valen un <span class="rule-seeded">35% menos</span>.</div>
            </div>
            <div class="page-footer relative-footer">Página 1 de 3</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Mod de Keep Talking and Nobody Explodes</span>
                <span class="page-header-section-title">Supermercado salvaje</span>
            </div>
            <div class="page-content">
                <h3>Precio de los productos:</h3>
                <div style="font-style: italic; font-size: 14px;">Todos los precios deberían estar estrictamente en dólares, por ejemplo, $0.68 en vez de 68¢. Todos los precios se redondean al segundo decimal. Debes redondear comercialmente después de calcular el precio del producto al igual que después de aplicar el descuento también.</div>
                <table class="borderless">
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Categoría</th>
                        <th class="borderless"></th>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Categoría</th>
                    </tr>
                    <tr><td>Bananas</td><td>$0.87 per lb</td><td>Frutas     </td><td class="borderless"></td><td>Mints</td><td>$6.39</td><td>Dulce              </td></tr>
                    <tr><td>Broccoli</td><td>$1.39 per lb</td><td>Verduras</td><td class="borderless"></td><td>Mustard</td><td>$2.36</td><td>Otros            </td></tr>
                    <tr><td>Candy Canes</td><td>$3.51</td><td>Dulce        </td><td class="borderless"></td><td>Oranges</td><td>$0.80 per lb</td><td>Frutas     </td></tr>
                    <tr><td>Canola Oil</td><td>$2.28</td><td>Aceite           </td><td class="borderless"></td><td>Paper Towels</td><td>$9.46</td><td>Higiene</td></tr>
                    <tr><td>Cereal</td><td>$4.19</td><td>Pasta             </td><td class="borderless"></td><td>Pasta Sauce</td><td>$2.30</td><td>Verduras    </td></tr>
                    <tr><td>Cheese</td><td>$4.49</td><td>Lácteos             </td><td class="borderless"></td><td>Peanut Butter</td><td>$5.00</td><td>Proteínas    </td></tr>
                    <tr><td>Chicken</td><td>$1.99 per lb</td><td>Proteínas   </td><td class="borderless"></td><td>Pork</td><td>$4.14 per lb</td><td>Proteínas      </td></tr>
                    <tr><td>Chocolate Bar</td><td>$2.10</td><td>Dulce      </td><td class="borderless"></td><td>Potato Chips</td><td>$3.25</td><td>Oil         </td></tr>
                    <tr><td>Chocolate Milk</td><td>$5.68</td><td>Lácteos     </td><td class="borderless"></td><td>Potatoes</td><td>$0.68 per lb</td><td>Verduras</td></tr>
                    <tr><td>Coffee Beans</td><td>$7.85</td><td>Otros       </td><td class="borderless"></td><td>Shampoo</td><td>$4.98</td><td>Higiene     </td></tr>
                    <tr><td>Cookies</td><td>$2.00</td><td>Dulce            </td><td class="borderless"></td><td>Socks</td><td>$6.97</td><td>Otros              </td></tr>
                    <tr><td>Deodorant</td><td>$3.97</td><td>Higiene   </td><td class="borderless"></td><td>Soda</td><td>$2.05</td><td>Dulce               </td></tr>
                    <tr><td>Frutas Punch</td><td>$2.08</td><td>Dulce        </td><td class="borderless"></td><td>Spaghetti</td><td>$2.92</td><td>Pasta          </td></tr>
                    <tr><td>Grape Jelly</td><td>$2.98</td><td>Dulce        </td><td class="borderless"></td><td>Steak</td><td>$4.97 per lb</td><td>Proteínas     </td></tr>
                    <tr><td>Grapefruit</td><td>$1.08 per lb</td><td>Frutas  </td><td class="borderless"></td><td>Sugar</td><td>$2.08</td><td>Dulce              </td></tr>
                    <tr><td>Gum</td><td>$1.12</td><td>Dulce                </td><td class="borderless"></td><td>Tea</td><td>$2.35</td><td>Agua                </td></tr>
                    <tr><td>Honey</td><td>$8.25</td><td>Dulce              </td><td class="borderless"></td><td>Tissues</td><td>$3.94</td><td>Higiene     </td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">Página 2 de 3</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Mod de Keep Talking and Nobody Explodes</span>
                <span class="page-header-section-title">Supermercado salvaje</span>
            </div>
            <div class="page-content">
                <table class="borderless">
                    <tr><td>Ketchup</td><td>$3.59</td><td>Otros           </td><td class="borderless"></td><td>Tomatoes</td><td>$1.80 per lb</td><td>Frutas  </td></tr>
                    <tr><td>Lemons</td><td>$1.74 per lb</td><td>Frutas     </td><td class="borderless"></td><td>Toothpaste</td><td>$2.50</td><td>Higiene</td></tr>
                    <tr><td>Lettuce</td><td>$1.10 per lb</td><td>Verduras</td><td class="borderless"></td><td>Turkey</td><td>$2.98 per lb</td><td>Proteínas  </td></tr>
                    <tr><td>Lollipops</td><td>$2.61</td><td>Dulce         </td><td class="borderless"></td><td>Agua Bottles</td><td>$9.37</td><td>Agua    </td></tr>
                    <tr><td>Lotion</td><td>$7.97</td><td>Higiene     </td><td class="borderless"></td><td>White Bread</td><td>$2.43</td><td>Pasta      </td></tr>
                    <tr><td>Mayonnaise</td><td>$3.99</td><td>Aceite          </td><td class="borderless"></td><td>White Milk</td><td>$3.62</td><td>Lácteos       </td></tr>
                </table>
            </div>
            <div class="page-footer relative-footer">Página 3 de 3</div>
        </div>
    </div>
</body>
</html>
