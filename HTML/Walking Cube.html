<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Walking Cube — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/jquery.3.1.1.min.js"></script>
    <script src="js/ruleseed.js"></script>
    <style>
        .wc-table {
            margin: 0 auto;
        }

        .wc-table td {
            width: 75px;
            height: 75px;
            text-align: center;
            padding: 0
        }

        .wc-color-table td {
            font-size: 30px;
            position: relative;
        }

        .wc-color-table td > div {
            position: static;
            display: inline-block;
            vertical-align: bottom;
            width: 1.6cm;
            height: 1.6cm;
            border: none;
        }

        .wc-color-table th {
            border: 0;
        }

        .wc-color-table {
            border: 0;
        }

        .net-img {
            margin-top: 50px;
            width: 80%;
        }

        .bg-red {
            background-color: hsl(0, 75%, 75%);
        }

        .bg-green {
            background-color: hsl(120, 75%, 75%);
        }

        .bg-blue {
            background-color: hsl(220, 75%, 75%);
        }

        .bg-cyan {
            background-color: hsl(180, 75%, 75%);
        }

        .bg-magenta {
            background-color: hsl(300, 75%, 75%);
        }

        .bg-yellow {
            background-color: hsl(60, 75%, 75%);
        }

        .bg-white {
            background-color: #ffffff;
        }

        .bg-orange {
            background-color: hsl(31, 75%, 75%);
        }

        .bg-gray {
            background-color: hsl(0, 0%, 75%);
        }

        .face {
            position: absolute;
            left: 0;
            top: 0;
            width: 1.8cm;
            height: 1.8cm;
            background-image: url("img/Pattern Cube/Faces.svg");
            background-size: 16cm 19.2cm;
            background-repeat: no-repeat;
            border: .1cm solid black;
            border-radius: .1cm;
            box-sizing: border-box;
        }

        .rules-list li {
            margin-bottom: 20px;
        }

        .face.symbol-0 {
            background-position: -0cm -0cm;
        }

        .face.symbol-1 {
            background-position: -1.6cm -0cm;
        }

        .face.symbol-2 {
            background-position: -3.2cm -0cm;
        }

        .face.symbol-3 {
            background-position: -4.8cm -0cm;
        }

        .face.symbol-4 {
            background-position: -6.4cm -0cm;
        }

        .face.symbol-5 {
            background-position: -8cm -0cm;
        }

        .face.symbol-6 {
            background-position: -9.6cm -0cm;
        }

        .face.symbol-7 {
            background-position: -11.2cm -0cm;
        }

        .face.symbol-8 {
            background-position: -12.8cm -0cm;
        }

        .face.symbol-9 {
            background-position: -14.4cm -0cm;
        }

        .face.symbol-10 {
            background-position: -0cm -1.6cm;
        }

        .face.symbol-11 {
            background-position: -1.6cm -1.6cm;
        }

        .face.symbol-12 {
            background-position: -3.2cm -1.6cm;
        }

        .face.symbol-13 {
            background-position: -4.8cm -1.6cm;
        }

        .face.symbol-14 {
            background-position: -6.4cm -1.6cm;
        }

        .face.symbol-15 {
            background-position: -8cm -1.6cm;
        }

        .face.symbol-16 {
            background-position: -9.6cm -1.6cm;
        }

        .face.symbol-17 {
            background-position: -11.2cm -1.6cm;
        }

        .face.symbol-18 {
            background-position: -12.8cm -1.6cm;
        }

        .face.symbol-19 {
            background-position: -14.4cm -1.6cm;
        }

        .face.symbol-20 {
            background-position: -0cm -3.2cm;
        }

        .face.symbol-21 {
            background-position: -1.6cm -3.2cm;
        }

        .face.symbol-22 {
            background-position: -3.2cm -3.2cm;
        }

        .face.symbol-23 {
            background-position: -4.8cm -3.2cm;
        }

        .face.symbol-24 {
            background-position: -6.4cm -3.2cm;
        }

        .face.symbol-25 {
            background-position: -8cm -3.2cm;
        }

        .face.symbol-26 {
            background-position: -9.6cm -3.2cm;
        }

        .face.symbol-27 {
            background-position: -11.2cm -3.2cm;
        }

        .face.symbol-28 {
            background-position: -12.8cm -3.2cm;
        }

        .face.symbol-29 {
            background-position: -14.4cm -3.2cm;
        }

        .face.symbol-30 {
            background-position: -0cm -4.8cm;
        }

        .face.symbol-31 {
            background-position: -1.6cm -4.8cm;
        }

        .face.symbol-32 {
            background-position: -3.2cm -4.8cm;
        }

        .face.symbol-33 {
            background-position: -4.8cm -4.8cm;
        }

        .face.symbol-34 {
            background-position: -6.4cm -4.8cm;
        }

        .face.symbol-35 {
            background-position: -8cm -4.8cm;
        }

        .face.symbol-36 {
            background-position: -9.6cm -4.8cm;
        }

        .face.symbol-37 {
            background-position: -11.2cm -4.8cm;
        }

        .face.symbol-38 {
            background-position: -12.8cm -4.8cm;
        }

        .face.symbol-39 {
            background-position: -14.4cm -4.8cm;
        }

        .face.symbol-40 {
            background-position: -0cm -6.4cm;
        }

        .face.symbol-41 {
            background-position: -1.6cm -6.4cm;
        }

        .face.symbol-42 {
            background-position: -3.2cm -6.4cm;
        }

        .face.symbol-43 {
            background-position: -4.8cm -6.4cm;
        }

        .face.symbol-44 {
            background-position: -6.4cm -6.4cm;
        }

        .face.symbol-45 {
            background-position: -8cm -6.4cm;
        }

        .face.symbol-46 {
            background-position: -9.6cm -6.4cm;
        }

        .face.symbol-47 {
            background-position: -11.2cm -6.4cm;
        }

        .face.symbol-48 {
            background-position: -12.8cm -6.4cm;
        }

        .face.symbol-49 {
            background-position: -14.4cm -6.4cm;
        }

        .face.symbol-50 {
            background-position: -0cm -8cm;
        }

        .face.symbol-51 {
            background-position: -1.6cm -8cm;
        }

        .face.symbol-52 {
            background-position: -3.2cm -8cm;
        }

        .face.symbol-53 {
            background-position: -4.8cm -8cm;
        }

        .face.symbol-54 {
            background-position: -6.4cm -8cm;
        }

        .face.symbol-55 {
            background-position: -8cm -8cm;
        }

        .face.symbol-56 {
            background-position: -9.6cm -8cm;
        }

        .face.symbol-57 {
            background-position: -11.2cm -8cm;
        }

        .face.symbol-58 {
            background-position: -12.8cm -8cm;
        }

        .face.symbol-59 {
            background-position: -14.4cm -8cm;
        }

        .face.symbol-60 {
            background-position: -0cm -9.6cm;
        }

        .face.symbol-61 {
            background-position: -1.6cm -9.6cm;
        }

        .face.symbol-62 {
            background-position: -3.2cm -9.6cm;
        }

        .face.symbol-63 {
            background-position: -4.8cm -9.6cm;
        }

        .face.symbol-64 {
            background-position: -6.4cm -9.6cm;
        }

        .face.symbol-65 {
            background-position: -8cm -9.6cm;
        }

        .face.symbol-66 {
            background-position: -9.6cm -9.6cm;
        }

        .face.symbol-67 {
            background-position: -11.2cm -9.6cm;
        }

        .face.symbol-68 {
            background-position: -12.8cm -9.6cm;
        }

        .face.symbol-69 {
            background-position: -14.4cm -9.6cm;
        }

        .face.symbol-70 {
            background-position: -0cm -11.2cm;
        }

        .face.symbol-71 {
            background-position: -1.6cm -11.2cm;
        }

        .face.symbol-72 {
            background-position: -3.2cm -11.2cm;
        }

        .face.symbol-73 {
            background-position: -4.8cm -11.2cm;
        }

        .face.symbol-74 {
            background-position: -6.4cm -11.2cm;
        }

        .face.symbol-75 {
            background-position: -8cm -11.2cm;
        }

        .face.symbol-76 {
            background-position: -9.6cm -11.2cm;
        }

        .face.symbol-77 {
            background-position: -11.2cm -11.2cm;
        }

        .face.symbol-78 {
            background-position: -12.8cm -11.2cm;
        }

        .face.symbol-79 {
            background-position: -14.4cm -11.2cm;
        }

        .face.symbol-80 {
            background-position: -0cm -12.8cm;
        }

        .face.symbol-81 {
            background-position: -1.6cm -12.8cm;
        }

        .face.symbol-82 {
            background-position: -3.2cm -12.8cm;
        }

        .face.symbol-83 {
            background-position: -4.8cm -12.8cm;
        }

        .face.symbol-84 {
            background-position: -6.4cm -12.8cm;
        }

        .face.symbol-85 {
            background-position: -8cm -12.8cm;
        }

        .face.symbol-86 {
            background-position: -9.6cm -12.8cm;
        }

        .face.symbol-87 {
            background-position: -11.2cm -12.8cm;
        }

        .face.symbol-88 {
            background-position: -12.8cm -12.8cm;
        }

        .face.symbol-89 {
            background-position: -14.4cm -12.8cm;
        }

        .face.symbol-90 {
            background-position: -0cm -14.4cm;
        }

        .face.symbol-91 {
            background-position: -1.6cm -14.4cm;
        }

        .face.symbol-92 {
            background-position: -3.2cm -14.4cm;
        }

        .face.symbol-93 {
            background-position: -4.8cm -14.4cm;
        }

        .face.symbol-94 {
            background-position: -6.4cm -14.4cm;
        }

        .face.symbol-95 {
            background-position: -8cm -14.4cm;
        }

        .face.symbol-96 {
            background-position: -9.6cm -14.4cm;
        }

        .face.symbol-97 {
            background-position: -11.2cm -14.4cm;
        }

        .face.symbol-98 {
            background-position: -12.8cm -14.4cm;
        }

        .face.symbol-99 {
            background-position: -14.4cm -14.4cm;
        }

        .face.symbol-100 {
            background-position: -0cm -16cm;
        }

        .face.symbol-101 {
            background-position: -1.6cm -16cm;
        }

        .face.symbol-102 {
            background-position: -3.2cm -16cm;
        }

        .face.symbol-103 {
            background-position: -4.8cm -16cm;
        }

        .face.symbol-104 {
            background-position: -6.4cm -16cm;
        }

        .face.symbol-105 {
            background-position: -8cm -16cm;
        }

        .face.symbol-106 {
            background-position: -9.6cm -16cm;
        }

        .face.symbol-107 {
            background-position: -11.2cm -16cm;
        }

        .face.symbol-108 {
            background-position: -12.8cm -16cm;
        }

        .face.symbol-109 {
            background-position: -14.4cm -16cm;
        }

        .face.symbol-110 {
            background-position: -0cm -17.6cm;
        }

        .face.symbol-111 {
            background-position: -1.6cm -17.6cm;
        }

        .face.symbol-112 {
            background-position: -3.2cm -17.6cm;
        }

        .face.symbol-113 {
            background-position: -4.8cm -17.6cm;
        }

        .face.symbol-114 {
            background-position: -6.4cm -17.6cm;
        }

        .face.symbol-115 {
            background-position: -8cm -17.6cm;
        }

        .face.symbol-116 {
            background-position: -9.6cm -17.6cm;
        }

        .face.symbol-117 {
            background-position: -11.2cm -17.6cm;
        }

        .face.symbol-118 {
            background-position: -12.8cm -17.6cm;
        }

        .face.symbol-119 {
            background-position: -14.4cm -17.6cm;
        }
    </style>
    <script>
        const colorNames = ["RED", "GREEN", "BLUE", "CYAN", "MAGENTA", "YELLOW", "WHITE", "ORANGE"];

        const defaultColors = [[0, 0, 4, 6, 2], [2, 0, 3, 4, 0], [5, 5, 6, 7, 5], [1, 2, 4, 1, 6], [2, 2, 1, 4, 2]]
        const defaultSymbols = [[70, 80, 75, 117, 93], [10, 11, 12, 111, 14], [0, 112, 2, 105, 20], [62, 16, 103, 18, 19], [4, 21, 22, 23, 24]]
        const numSymbols = 120;

        function setDefaultRules() {
            showRules(defaultColors, defaultSymbols);
        }

        function setRules(rnd) {
            if (rnd.seed === 1) {
                setDefaultRules();
                return;
            }

            // Colors
            const colors = []
            for (let i = 0; i < colorNames.length; ++i) {
                colors.push(i);
            }
            rnd.shuffleFisherYates(colors);
            let newColors = [];
            for (let row of defaultColors) {
                const newRow = [];
                for (let val of row) {
                    if (val === -1) {
                        newRow.push(-1);
                    } else {
                        newRow.push(colors[val]);
                    }
                }
                newColors.push(newRow);
            }
            if (rnd.nextDouble() > 0.5) {
                newColors = mirrorHorizontal(newColors);
            }
            if (rnd.nextDouble() > 0.5) {
                newColors = mirrorVertical(newColors);
            }
            newColors = rotate(newColors, rnd.next(0, 4));

            // Symbols
            const symbols = [];
            for (let i = 0; i < numSymbols; i++) {
                symbols.push(i);
            }
            rnd.shuffleFisherYates(symbols);
            console.log(symbols)

            const symbolGrid = [];
            for (let i = 0; i < 5; i++) {
                const row = [];
                for (let j = 0; j < 5; j++) {
                    row.push(symbols[defaultSymbols[i][j]]);
                }
                symbolGrid.push(row);
            }

            // Show rules
            showRules(newColors, symbolGrid);
        }

        function showRules(colors, symbols) {
            $('.wc-color-table td').each(function (i) {
                let color = colorNames[colors[Math.floor(i / 5)][i % 5]];
                $(this).removeClass("bg-gray " + colorNames.map(c => 'bg-' + c.toLowerCase()).join(" "));
                if (color) {
                    $(this).addClass('bg-' + color.toLowerCase());
                } else {
                    $(this).addClass("bg-gray");
                }
                // $(this).text("" + symbols[Math.floor(i / 5)][i % 5]);
            });
            $('.wc-color-table td div').each(function (i) {
                $(this).attr('class', $(this).attr('class').replace(/symbol-\d+/, "symbol-" + symbols[Math.floor(i / 5)][i % 5]));
            });
        }

        function reverse(arr) {
            const res = [];
            for (let i = arr.length - 1; i >= 0; --i) {
                res.push(arr[i]);
            }
            return res;
        }

        function mirrorVertical(arr) {
            const res = [];
            for (let row of arr) {
                res.push(reverse(row));
            }
            return res;
        }

        function mirrorHorizontal(arr) {
            return reverse(arr);
        }

        function rotate(arr, count) {
            count %= 4;
            let res = arr;
            while (true) {
                if (count < 0 || res.length < 1) {
                    console.error("uh oh");
                    return;
                }
                if (count === 0) {
                    return res;
                }

                const resultArr = [];
                for (let i = 0; i < res[0].length; ++i) {
                    const row = [];
                    for (let j = 0; j < res.length; ++j) {
                        row.push(res[res.length - j - 1][i]);
                    }
                    resultArr.push(row);
                }

                res = resultArr;
                --count;
            }
        }
    </script>
</head>
<body>
<div class="section">
    <div class="page page-bg-01">
        <div class="page-header">
            <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
            <span class="page-header-section-title">Walking Cube</span>
        </div>
        <div class="page-content">
            <img src="img/Component/Walking Cube.svg" class="diagram">
            <h2>On the Subject of Walking Cubes</h2>
            <p class="flavour-text">I mean, it’s more of a “roll” if you think about it...</p>

            <ul class="rules-list">
                <li>
                    Present on the module is a cube which is “walking” around the module. The cube has several colored
                    faces. Take note of these faces and their relative orientations.
                </li>
                <li>
                    First, align one of the cube nets below over Table 1 in such a way that the colors covered by the
                    net, when folded back into a cube, would match the colors on the cube on the module. Note that the
                    nets may flipped or rotated in the table.
                </li>
                <li>
                    Once you determine the correct net to use, take note of the symbols (and their orientations) on each
                    face of the net. Aligning this net with the cube on the module will indicate which symbols are on
                    which faces of the cube. <em>Note: when re-folding the net, the symbols should be oriented
                    OUTWARD.</em>
                </li>
                <li>
                    As the cube moves around the 4×4 grid, use the symbol selectors to fill the grid squares that the
                    cube touches such that the placed symbols match (including orientation) the symbol on the cube face
                    which touched the grid square. In other words, answer the question of “if the cube left symbol
                    impressions on the grid below as it moved around, what would the grid look like?”
                </li>
                <li>
                    Tap a symbol in the selection bar to select it. Tap the symbol again to rotate it. A green frame
                    indicates which symbol is selected.
                </li>
                <li>
                    To change pages for the symbol selectors, press the page indicator button. For easy reference, Table
                    1 lists the page that each symbol is in.
                </li>
                <li>
                    Tap a square in the grid to place the selected symbol. Do not tap a square in the net when no symbol
                    is selected.
                </li>
                <li>
                    To disarm the module, all grid squares corresponding to spaces which the walking cube touches must
                    be
                    filled in with the proper symbol in the correct orientation
                </li>
                <li>
                    Attempting to place a symbol in an incorrect grid square or an incorrect orientation will incur a
                    strike.
                </li>
            </ul>
        </div>
        <div class="page-footer relative-footer">Page 1 of 2</div>
    </div>
    <div class="page page-bg-02">
        <div class="page-header">
            <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
            <span class="page-header-section-title">Walking Cube</span>
        </div>
        <div class="page-content">
            <h3>Table 1</h3>
            <table class="wc-table wc-color-table">
                <tr>
                    <th>Page 1</th>
                    <th>Page 2</th>
                    <th>Page 3</th>
                    <th>Page 4</th>
                    <th>Page 5</th>
                </tr>
                <tr>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                    <td>
                        <div class="face symbol-0"></div>
                    </td>
                </tr>
            </table>

            <svg class="centered-img net-img" viewBox="0 0 511 261">
                <g id="layer1" transform="translate(5.5 5.5)" fill="#bbb" stroke="#000" stroke-width="1"
                   stroke-miterlimit="4" stroke-opacity="1">
                    <rect class="highlightable" width="50" height="50" x="50" y="0"/>
                    <rect class="highlightable" width="50" height="50" x="150" y="0"/>
                    <rect class="highlightable" width="50" height="50" x="450" y="0"/>
                    <rect class="highlightable" width="50" height="50" x="50" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="150" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="200" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="250" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="400" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="450" y="50"/>
                    <rect class="highlightable" width="50" height="50" x="0" y="100"/>
                    <rect class="highlightable" width="50" height="50" x="50" y="100"/>
                    <rect class="highlightable" width="50" height="50" x="200" y="100"/>
                    <rect class="highlightable" width="50" height="50" x="350" y="100"/>
                    <rect class="highlightable" width="50" height="50" x="400" y="100"/>
                    <rect class="highlightable" width="50" height="50" x="0" y="150"/>
                    <rect class="highlightable" width="50" height="50" x="200" y="150"/>
                    <rect class="highlightable" width="50" height="50" x="400" y="150"/>
                    <rect class="highlightable" width="50" height="50" x="0" y="200"/>
                </g>
            </svg>
        </div>
        <div class="page-footer relative-footer">Page 2 of 2</div>
    </div>
</div>
</body>
</html>