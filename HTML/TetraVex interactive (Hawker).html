<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>TetraVex — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/jquery.3.7.0.min.js"></script>
    <script src="js/Utilities/svg-utils.js"></script>

    <style>
        text.tetravex {
            fill: white;
            font-size: 3px;
            text-anchor: middle;
        }
        text.highlight{
            fill:yellow;
        }
        path.tetravex {
            stroke: black;
            stroke-width: .2;
        }

        path.tetravex-0 { fill: #1d1b1a; }
        path.tetravex-1 { fill: #a80907; }
        path.tetravex-2 { fill: #c86100; }
        path.tetravex-3 { fill: #978f00; }
        path.tetravex-4 { fill: #039503; }
        path.tetravex-5 { fill: #00857b; }
        path.tetravex-6 { fill: #030690; }
        path.tetravex-7 { fill: #b700a2; }

        button.write-swap::before {
            content: 'Mode: Swap';
        }
        button.write-swap:not(.swap)::before {
            content: 'Mode: Write';
        }
    </style>
    <script>
        $(function() {
            const mode = 'write';
            const ids = [3, 0, 4, 9, 5, 1, 6, 10, 7, 2, 8, 11, 15, 12, 16, 21, 17, 13, 18, 22, 19, 14, 20, 23, 27, 24, 28, 33, 29, 25, 30, 34, 31, 26, 32, 35]
            let highligtedTextId = 0;
            const svg = $('#svg');
            console.log(svg)
            const length = 10
            for(let row = 0; row < 3; row++) {
                for(let col = 0; col < 3; col++) {
                    const ix = row * 3 + col
                    idChuck = ids.slice(ix * 4, ix * 4 + 4);
                    $(addSquare({x: col * 10, y: row * 10}, [0, 0, 0, 0], idChuck)).appendTo($(svg));
                }
            }

            //highlight first triangle
            $('#0').addClass('highlight');

            // toggle write/swap
            $("<button>").addClass("write-swap").appendTo(tools).click(function() {
            $(this).toggleClass("swap");
            $("body").toggleClass("swap", $(this).hasClass("swap"));
        });
            function addSquare(translate, labels, ids) {
                const g = MakeSvgElem("g", {style: `transform: translate(${translate.x}px, ${translate.y}px)`});
                $(g).click(blockClick);
                for(let i = 0; i < 4; i++) {
                    g.append(addTriangle(labels[i], 90 * i, ids[i]));
                }
                return g;
            }
            function addTriangle(label, rotation, id) {
                const coordinates = [{x: 5, y: 9}, {x: 8, y: 6}, {x: 11, y: 9}, {x: 8, y: 12}];
                const currentCoordinates = coordinates[Math.floor(rotation / 90)];
                const g = MakeSvgElem("g");
                g.append(MakeSvgElem("path", { d: "M3 3 l 5 5 l -5 5 z", class: `tetravex tetravex-${label}`, style: `transform-origin: 8px 8px; transform:rotate(${rotation}deg)` }));
                const text = MakeSvgElem("text", {id: id, class: "tetravex", x: currentCoordinates.x, y: currentCoordinates.y});
                $(text).click(textClick)
                text.innerHTML = label;
                g.append(text)
                return g;
            }

            function textClick(e) {
                e.stopPropagation();
                if(mode != 'write' || $(e.target).attr('id') == highligtedTextId)
                    return;
                $(`#${highligtedTextId}`).removeClass('highlight');
                $(e.target).addClass("highlight");
                highligtedTextId = $(e.target).attr('id');
                console.log(e.target)
            }

            function blockClick(e) {
                if(mode != 'swap')
                    return;

                console.log('a')
            }

        });
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">TetraVex</span>
            </div>
            <div class="page-content">
                <img src="img/Component/TetraVex.svg" class="diagram">
                <h2>On the Subject of TetraVex</h2>
                <p class="flavour-text">I knew putting “Microsoft Entertainment Pack” on my résumé would be beneficial someday!</p>

                <ul>
                    <li>This module contains nine TetraVex pieces arranged in a 3×3 grid. Each piece is separated into four triangular sections with a number marking them.</li>
                    <li>Select a piece to pick it up off of the board.</li>
                    <li>While a piece is held, select another piece to swap that piece with the one currently being held. Select the empty space to set the held piece down there.</li>
                    <li>Rearrange the pieces such that the edges of all orthogonally adjacent pieces match each other. Edges not facing another piece (i.e. facing the edge of the board) may be ignored.</li>
                    <li>When the pieces are arranged correctly, press the Check button to disarm the module.</li>
                    <li>Pressing the Check button when any two pieces share an edge that does not match, or while a piece is still in hand, will cause a strike.</li>
                </ul>

                Some puzzles may have more than one solution. In such a case, any such solution may be submitted.
            </div>
            <div class="page-footer relative-footer">Page 1 of 1</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">TetraVex</span>
            </div>
            <div class="page-content">
                    <svg  id="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 35">
                    </svg>
                    <div id="tools"></div>
                    
            </div>
            <div class="page-footer relative-footer">Page 1 of 2</div>
        </div>
    </div>
</body>
