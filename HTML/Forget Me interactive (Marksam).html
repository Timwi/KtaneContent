<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Forget Me — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        table {
            margin: 1em auto;
            font-size: 200%;
        }
        .hardmodule-wrap {
            width: 0;
            height: 0;
        }
        .hardmodule {
            width: 2em;
            height: 66em;
            opacity: 0.3;
            background-color: #FF0000;
            -webkit-print-color-adjust: exact;
        }
        ul {
            padding-bottom: 10px;
        }

        .button {
            width: 100px;
            height: 50px;
            font-size: 15px;
            font-weight: bold;
        }

        .tileGrid {
            padding-top: 50px;
            display: table;
            border-spacing: 5px;
            margin: auto;
        }
            .tileGrid div {
                display: table-row;
            }
                .tileGrid div div {
                    width: 125px;
                    height: 125px;
                    border: 3pt solid;
                    display: table-cell;
                    text-align: center;
                    vertical-align: middle;
                    font-size: 40px;
                    font-weight: bold;
                }
                .tileGrid div div:hover:not(.disabled) {
                    background-color: gray;
                }
                .tileGrid div div.disabled {
                    border: none;
                }
                .tileGrid div div.selected {
                    background-color: darkgray;
                }
    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class='hardmodule-wrap'><div class='hardmodule'></div></div>
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Forget Me</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Forget Me.svg" class="diagram">
                <h2>On the Subject of Forget Me</h2>
                <p class="flavour-text">This one likes attention, but who cares what it thinks!</p>

                    <ul>
                        <li>There will be a keypad of buttons, one of which has its LED lit. A number will be displayed on the right screen and bottom screen. Pressing each number from 1–9 will cycle the module between 9 pairs of numbers.</li>
                        <li>Pressing the ‘0’ button will prompt input. Pressing the numbered buttons after that will attempt to enter digits into the module.</li>
                    </ul>
                    <ul>
                        <li>The module simulates a 3×3 sliding puzzle. To obtain the initial state of this puzzle, take each number pair and order them in <strong>ascending</strong> order of the number on the <strong>right</strong> display. Use the digits on the <strong>bottom</strong> display in order to get a sequence of 9 digits.</li>
                        <li>These digits represent the entries of the sliding puzzle in reading order. The number 0 represents the empty space.</li>
                    </ul>
                    <ul>
                        <li>To obtain the solution to the sliding puzzle, use the table on the following page. Start in the <strong>column</strong> of the <strong>3rd</strong> serial number character and the <strong>row</strong> of the <strong>6th</strong>. The top-left cell of the table is (0,0). Add the number at this coordinate to an empty sequence.</li>
                        <li>Then, take each orthogonally adjacent unvisited cell in <strong>reading order</strong>. If the digit does not appear in the sequence, add it to the sequence. Repeat this with new adjacent cells until the sequence contains exactly one of each digit from 0–8. This represents the solution state in reading order.</li>
                    </ul>
                    <ul>
                        <li>When submitting a code, each digit will move a number in the sliding puzzle. If the number is adjacent to the empty space, it will swap locations with the empty space. If it is not, the module will strike instantly upon entering the digit. Pressing the ‘9’ button will always strike. Do not do this. Ever.</li>
                        <li>When a series of digits has been entered which transforms the sliding puzzle into its solution, pressing the ‘0’ button once more will solve the module.</li>
                    </ul>
                    <ul>
                        <li>Certain strikes will cause the LED on the '0' button to become lit. Press the button at this time to reset the module to its initial state.</li>
                    </ul>
             </div>
            <div class="page-footer relative-footer">Page 1 of 2</div>
        </div>
        <div class="page page-bg-02">
        <div class='hardmodule-wrap'><div class='hardmodule'></div></div>
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Forget Me</span>
            </div>
            <div class="page-content">
                    <h2>The Table</h2>
                <table>
                        <tr> <td>1</td> <td>7</td> <td>3</td> <td>2</td> <td>6</td> <td>5</td> <td>0</td> <td>4</td> <td>1</td> <td>8</td> </tr>
                        <tr> <td>0</td> <td>8</td> <td>1</td> <td>5</td> <td>2</td> <td>6</td> <td>2</td> <td>3</td> <td>4</td> <td>7</td> </tr>
                        <tr> <td>2</td> <td>1</td> <td>6</td> <td>3</td> <td>8</td> <td>4</td> <td>5</td> <td>7</td> <td>0</td> <td>4</td> </tr>
                        <tr> <td>7</td> <td>3</td> <td>4</td> <td>2</td> <td>4</td> <td>1</td> <td>8</td> <td>6</td> <td>8</td> <td>0</td> </tr>
                        <tr> <td>8</td> <td>5</td> <td>7</td> <td>4</td> <td>5</td> <td>0</td> <td>1</td> <td>3</td> <td>2</td> <td>6</td> </tr>
                        <tr> <td>4</td> <td>2</td> <td>5</td> <td>6</td> <td>1</td> <td>8</td> <td>5</td> <td>0</td> <td>7</td> <td>3</td> </tr>
                        <tr> <td>6</td> <td>0</td> <td>8</td> <td>7</td> <td>3</td> <td>2</td> <td>4</td> <td>1</td> <td>6</td> <td>5</td> </tr>
                        <tr> <td>3</td> <td>4</td> <td>0</td> <td>1</td> <td>3</td> <td>7</td> <td>0</td> <td>8</td> <td>5</td> <td>2</td> </tr>
                        <tr> <td>4</td> <td>5</td> <td>6</td> <td>0</td> <td>7</td> <td>8</td> <td>6</td> <td>2</td> <td>3</td> <td>1</td> </tr>
                        <tr> <td>5</td> <td>6</td> <td>2</td> <td>8</td> <td>0</td> <td>3</td> <td>7</td> <td>5</td> <td>1</td> <td>4</td> </tr>
                  </table>
             </div>
            <div class="page-footer relative-footer">Page 2 of 2</div>
        </div>
        <div class="page page-bg-03">
            <div class='hardmodule-wrap'><div class='hardmodule'></div></div>
                <div class="page-header">
                    <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                    <span class="page-header-section-title">Forget Me</span>
                </div>
                <div class="page-content">
                    <h2>The sliding puzzle, duh</h2>
                    <div class="tileGrid table">
                        <div>
                            <div onclick="handleClick(0)" class="tile"></div>
                            <div onclick="handleClick(1)" class="tile"></div>
                            <div onclick="handleClick(2)" class="tile"></div>
                        </div>
                        <div>
                            <div onclick="handleClick(3)" class="tile"></div>
                            <div onclick="handleClick(4)" class="tile"></div>
                            <div onclick="handleClick(5)" class="tile"></div>
                        </div>
                        <div>
                            <div onclick="handleClick(6)" class="tile"></div>
                            <div onclick="handleClick(7)" class="tile"></div>
                            <div onclick="handleClick(8)" class="tile"></div>
                        </div>
                    </div>
                    <button class="button" onclick="handleClick(9)">Slide mode <span style="color: #F00000">OFF</span></button>
                    <ul>
                        <li>Toggle between sliding the tiles and inputting numbers using the "Slide mode" button.</li>
                        <li>While a tile is selected, input a number using your keyboard.</li>
                    </ul>
                    <script>
                        document.addEventListener('keydown', keyPress);
                        const girdNeighbors = [[1, 3], [0, 2, 4], [1, 5], [0, 4, 6], [1, 3, 5, 7], [2, 4, 8], [3, 7], [4, 6, 8], [5, 7]];

                        let currentGrid = [
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null},
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null},
                            {selected: false, enabled: true, label: null}, {selected: false, enabled: true, label: null}, {selected: false, enabled: false, label: null}
                        ];
                        let slideMode = false;

                        let tiles = document.getElementsByClassName("tile");
                        let button = document.getElementsByClassName("button")[0];
                        tiles[8].className += " disabled";

                        function handleClick(index) {
                            switch(index){
                                case 9:
                                    slideMode = !slideMode;
                                    for (let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected){
                                            currentGrid[i].selected = false;
                                            tiles[i].className = "tile";
                                        }
                                    }
                                    currentGrid.forEach(x => x.selected = false);
                                    button.innerHTML = `Slide mode ` + (slideMode ? `<span style="color: #00A000">ON</span>` : `<span style="color: #F00000">OFF</span>`);
                                    break;
                                default:
                                    if(slideMode) {
                                        if(!currentGrid[index].enabled)
                                            return;
                                        let neighbors = girdNeighbors[index];
                                        let moveTo = null;
                                        for(let i = 0; i < neighbors.length; i++) {
                                            if(!currentGrid[neighbors[i]].enabled) {
                                                moveTo = neighbors[i];
                                                break;
                                            }
                                        }
                                        if(moveTo != null) {
                                            currentGrid[index].enabled = false;
                                            currentGrid[moveTo].label = currentGrid[index].label;
                                            currentGrid[index].label = null;
                                            currentGrid[moveTo].enabled = true;
                                            tiles[index].className = "tile disabled";
                                            tiles[index].innerHTML = "";
                                            tiles[moveTo].innerHTML = currentGrid[moveTo].label;
                                            tiles[moveTo].className = "tile"
                                        }
                                    }
                                    else {
                                        if(!currentGrid[index].enabled) break;
                                        if(currentGrid[index].selected) {
                                            currentGrid[index].selected = false;
                                            tiles[index].className = "tile";
                                            break;
                                        }
                                        for (let i = 0; i < currentGrid.length; i++) {
                                            if(currentGrid[i].selected) {
                                                currentGrid[i].selected = false;
                                                tiles[i].className = "tile";
                                            }
                                        }
                                        currentGrid[index].selected = true;
                                        tiles[index].className = "tile selected";
                                    }
                                    break;
                            }
                        }

                        function keyPress(e){
                            if(!slideMode && currentGrid.some(x => x.selected)) {
                                if(e.code == "Backspace") {
                                    for(let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected) {
                                            currentGrid[i].label = null;
                                            tiles[i].innerHTML = "";
                                        }
                                    }
                                    return;
                                }
                                let input = e.code.toLowerCase().replace(/(numpad|digit)/g, "");
                                if("12345678".includes(input)){
                                    for(let i = 0; i < currentGrid.length; i++) {
                                        if(currentGrid[i].selected) {
                                            currentGrid[i].label = input;
                                            tiles[i].innerHTML = input;
                                        }
                                    }
                                }
                            }
                        }
                    </script>
                 </div>
                <div class="page-footer relative-footer">Page 2 of 2</div>
        </div>
    </div>
</body>
</html>