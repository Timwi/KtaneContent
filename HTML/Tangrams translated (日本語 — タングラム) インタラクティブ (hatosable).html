<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>タングラム — Keep Talking and Nobody Explodes Mod</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
     <script src="js/jquery.3.1.1.min.js"></script>
    <style>
     .page-bg-blueprint {
         background-image: url(img/Tangrams/BlueprintBackground.svg);
     }
 </style>
 <script>
SVGElement.prototype.getTransformToElement = SVGElement.prototype.getTransformToElement || function(elem)
        {
            return elem.getScreenCTM().inverse().multiply(this.getScreenCTM());
        };

        var mainSVG = null;
        var selectedElement = null;
        var globalPoint = null;
        var currentMatrix = null;

        $(document).ready(function()
        {
            mainSVG = document.getElementById("mainSVG");

            $(".piece").click(function(event)
            {
                if (event.shiftKey)
                {
                    selectedElement = this;

                    if ($(selectedElement).attr("transform") == null)
                    {
                        $(selectedElement).attr("transform", "matrix(1 0 0 1 0 0))");
                    }

                    var width = parseFloat($(selectedElement).attr("width"));
                    var height = parseFloat($(selectedElement).attr("height"));

                    currentMatrix = $(selectedElement).attr("transform").slice(7, -1).split(' ');
                    for (var i = 0; i < currentMatrix.length; i++)
                    {
                        currentMatrix[i] = parseFloat(currentMatrix[i]);
                    }

                    //To 90deg
                    if (currentMatrix[0] == 1)
                    {
                        currentMatrix[0] = 0;
                        currentMatrix[1] = 1;
                        currentMatrix[2] = -1;
                        currentMatrix[3] = 0;
                        currentMatrix[4] += (width + height) / 2;
                        currentMatrix[5] += (height - width) / 2;
                    }
                    //To 270deg
                    else if (currentMatrix[0] == -1)
                    {
                        currentMatrix[0] = 0;
                        currentMatrix[1] = -1;
                        currentMatrix[2] = 1;
                        currentMatrix[3] = 0;
                        currentMatrix[4] += (-width - height) / 2;
                        currentMatrix[5] += (width - height) / 2;
                    }
                    //To 0deg
                    else if (currentMatrix[2] == 1)
                    {
                        currentMatrix[0] = 1;
                        currentMatrix[1] = 0;
                        currentMatrix[2] = 0;
                        currentMatrix[3] = 1;
                        currentMatrix[4] += (height - width) / 2;
                        currentMatrix[5] += (-width - height) / 2;
                    }
                    //To 180deg
                    else
                    {
                        currentMatrix[0] = -1;
                        currentMatrix[1] = 0;
                        currentMatrix[2] = 0;
                        currentMatrix[3] = -1;
                        currentMatrix[4] += (width - height) / 2;
                        currentMatrix[5] += (width + height) / 2;
                    }

                    newTransform = "matrix(" + currentMatrix.join(' ') + ")";
                    $(selectedElement).attr("transform", newTransform);
                }
            });

            $(".piece").mousedown(function(event)
            {
                selectedElement = this;

                globalPoint = mainSVG.createSVGPoint();
                globalPoint.x = event.clientX;
                globalPoint.y = event.clientY;

                var ctm = mainSVG.getScreenCTM();
                ctm = ctm.inverse();
                globalPoint = globalPoint.matrixTransform(ctm);

                if ($(selectedElement).attr("transform") == null)
                {
                    $(selectedElement).attr("transform", "matrix(1 0 0 1 0 0))");
                }

                currentMatrix = $(selectedElement).attr("transform").slice(7, -1).split(' ');
                for (var i = 0; i < currentMatrix.length; i++)
                {
                    currentMatrix[i] = parseFloat(currentMatrix[i]);
                }

                $(mainSVG).on("mousemove", function(event)
                {
                    var newGlobalPoint = mainSVG.createSVGPoint();
                    newGlobalPoint.x = event.clientX;
                    newGlobalPoint.y = event.clientY;

                    var ctm = mainSVG.getScreenCTM();
                    ctm = ctm.inverse();
                    newGlobalPoint = newGlobalPoint.matrixTransform(ctm);

                    dx = newGlobalPoint.x - globalPoint.x;
                    dy = newGlobalPoint.y - globalPoint.y;

                    dx = Math.round(dx / 20) * 20;
                    dy = Math.round(dy / 20) * 20;

                    globalPoint.x += dx;
                    globalPoint.y += dy;

                    currentMatrix[4] += dx;
                    currentMatrix[5] += dy;
                    newTransform = "matrix(" + currentMatrix.join(' ') + ")";
                    $(selectedElement).attr("transform", newTransform);
                });

                $(mainSVG).on("mouseup", function()
                {
                    $(mainSVG).off("mousemove").off("mouseup");
                    selectedElement = null;
                });
            });
        });

        var oldTemplateID = null;

        $(document).ready(function()
        {
            var templateSelect = $("#template-select");

            templateSelect.change(function()
            {
                var templateID = $(this).val();

                if (oldTemplateID != null)
                {
                    $(oldTemplateID).hide();
                }

                $(templateID).show();
                oldTemplateID = templateID;
            });

            $(".template").each(function()
            {
                templateSelect.append($("<option>",
                    {
                        value: "#" + $(this).attr("id"),
                        text: $(this).attr("id")
                    }));
            });

            var firstTemplate = $(".template").first();

            firstTemplate.show();
            oldTemplateID = "#" + firstTemplate.attr("id");

            $(".piece").each(function()
            {
                $(this).data("default-transform", $(this).attr("transform"));
            });

            $("#reset").click(function()
            {
                $(".piece").each(function()
                {
                    $(this).attr("transform", $(this).data("default-transform"));
                });
            });
        });
  </script>
  <style>
           .piece {
            z-index: 10000;
            position: absolute;
            cursor: move;
        }
        div{
         z-index: -1;
        }
  </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">タングラム</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Tangrams.svg" class="diagram" />
                <h2>モジュール詳細：タングラム</h2>
                <p class="flavour-text">
                    「新しいタイプの集積回路製品、集積タングラム回路(ITC = Integrated Tangram Circuit)<sup>特許出願中</sup>。」
                </p>
                <p>
                 このタイプのモジュールは、正方形の集積回路チップを持ち、縁の周囲に露出した接点がある。内部には、同封の「TAN-S」と 「TAN-D」の設計図ページにあるようなテンプレートで、同封の「TAN-M Poly Modular Chipset」の設計図を使用して構築されている。
                </p>
                <h3>モジュールの解除方法</h3>
                <p>
                    モジュールを解除するには、集積回路に3回過負荷を与えて(オーバーロード)爆発させ、焼き切ることに成功する。このためには、正極の接点から負極の接点へ電流が途切れることなく流れるような接点のペアを特定する。
                </p>
                <p>
                    常に最初は正極を選択し、その後負極を選択し、集積回路がオーバーロードするのを待つ。正しく回路がオーバーロードしたら、小さな爆発音が聞こえる。
                </p>
                <p>
                    有効な接点のペアごとに異なる正極を使用する必要がある(負の接点は再利用可能)。以前に使用した有効な正極のペアを選択すると、ミスが記録される。プラスからマイナスへ電流が途切れずに流させないような接点のペアを選択すると、ミスが記録される。回路が急激なオーバーロード状態の時に任意の接点を選択すると、ミスが記録される。
                </p>
                <p>
                    どの接点が有効かを判断するためには、搭載された集積チップの内部回路図を再構築する必要がある。
                </p>
                <h3>回路の構築</h3>
                <p>
                    搭載されている集積チップは短い文字コード(<em>「TAN-S」</em>または<em>「TAN-D」</em>テンプレートのどちらか)があり、それに続いて数字の羅列がある。チップコード内の桁数は、回路のテンプレートを埋めるのに必要なピース数を示している。
                </p>
                <p>
                 回路図のうち、特定したピース数で関連するテンプレート構造タイプに当てはめられる、つまりテンプレート内の空欄のセルが無くなるものがちょうど<em>一つ</em>だけある。
                </p>
            </div>
            <div class="page-footer relative-footer">ページ 1/2</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">タングラム</span>
            </div>
            <div class="page-content">
                <p>
                    それぞれの番号が付けられたセルに対して、チップコードの対応する数字を使用して、そのセルを埋めるために使用すべきピースの番号を求める。例えば、TAN-D 376581の場合、セル#1にはMT-03（中サイズ三角形、コードの1桁目は3）、セル#2にはST-07（小サイズ三角形、コードの2桁目は7）、などというようになり、TAN-D-6471（TAN-D、6ピース)を使用することになる。
                </p>
                <p> 複数の向きが考えられるピースについては、ピースの白い点をテンプレートに合わせると、作品の向きが正しくなる。テンプレートに当てはめるためにピースを裏返しにさせる必要はない。
                </p>
                <p>
                    回路を構成できたら、構成した回路図を読み接点のペアを読む。
                </p>
                <h3>回路図を読む</h3>
                <p>
                    各ピースには接点があり、隣接するピースと接続することで、ピースからピースへと正しく回路が流れるようになる。一部の接点は回路に接続されておらず、電流の「行き止まり」として扱う。
                </p>
                <p>
                    交差する線は、交点に接続のドットがある場合のみ接続されている。ドットが無い場合、線は互いに「またがって」いる。
                </p>
                <p>
                    電流には方向があり、プラスからマイナスへしか流れない。回路の中の三角形で示されたダイオードは、電流を一方向（ダイオードの向いている方向から垂直線の方向）にしか流せず、ダイオードを通って反対方向には流せない。
            </div>
            <div class="page-footer relative-footer">ページ 2/2</div>
        </div>
        <div class="page page-bg-blueprint">
            <img src="img/Tangrams/BlueprintSquareTemplates.svg" />
        </div>
        <div class="page page-bg-blueprint">
            <img src="img/Tangrams/BlueprintDiamondTemplates.svg" />
        </div>
        <div class="page page-bg-blueprint">
    <svg id="mainSVG" width="100%" viewBox="0 100 800 -640" preserveAspectRatio="xMaxYMin meet" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
     <g id="BT-01" class="piece bt" width="160" height="320" transform="matrix(0 1 -1 0 340 20)">
      <path d="m0 0 160 160-160 160z" fill="#0f3700" stroke="#001c00" stroke-linejoin="round" stroke-width="1.5" />
      <g fill="none" stroke="#25a100" stroke-linejoin="bevel" stroke-width="1.5">
          <path d="m0 40 20 20v40l100 100" />
          <path d="m0 120 20-20" />
          <path d="m40 40v40l40 40h40" />
          <path d="m0 200 80-80" />
          <path d="m0 280h40" />
      </g>
      <g transform="translate(0,-6)">
          <path d="m16 80h8" fill="none" stroke="#25a100" stroke-linejoin="bevel" stroke-width="1.5" />
          <path d="m20 80-4-8h8z" fill="#25a100" />
      </g>
      <g transform="rotate(-90,82,58)">
          <path d="m16 80h8" fill="none" stroke="#25a100" stroke-linejoin="bevel" stroke-width="1.5" />
          <path d="m20 80-4-8h8z" fill="#25a100" />
      </g>
      <g fill="#25a100">
          <circle cx="40" cy="40" r="5.5" style="paint-order:normal" />
          <circle cx="120" cy="120" r="5.5" style="paint-order:normal" />
          <circle cx="120" cy="200" r="5.5" style="paint-order:normal" />
          <circle cx="40" cy="280" r="5.5" style="paint-order:normal" />
          <circle cy="280" r="5.5" style="paint-order:normal" />
          <circle cy="200" r="5.5" style="paint-order:normal" />
          <circle cy="120" r="5.5" style="paint-order:normal" />
          <circle cy="40" r="5.5" style="paint-order:normal" />
          <circle cx="80" cy="120" r="5.5" style="paint-order:normal" />
          <circle cx="20" cy="100" r="5.5" style="paint-order:normal" />
      </g>
      <circle cx="5" cy="13" r="3" fill="#fff" style="paint-order:normal" />
      <text transform="rotate(-45)" x="-129.79242" y="223.35454" fill="#fff500" font-family="'OCR A Extended'" font-size="10.667px" letter-spacing="0px" word-spacing="0px" style="line-height:1" xml:space="preserve"><tspan x="-129.79242" y="223.35454" font-size="10.667px">BT-01</tspan></text>
  </g>
     </svg> 
     </div> 
    </div>
</body>
</html>