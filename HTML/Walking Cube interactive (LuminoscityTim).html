<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Walking Cube — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/jquery.3.1.1.min.js"></script>
    <script src="js/ruleseed.js"></script>
    <script src="js/Utilities/math-utils.js"></script>
    <script src="js/Utilities/ui-utils.js"></script>
    <style>
        .hstack {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
        .vstack {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .wrap {
            flex-wrap: wrap;
        }

        .dark .wc-color-table, .wc-color-table {
            min-width: 350px;
            border: 0;
        }
        .dark .wc-table, .wc-table {
            min-width: 300px;
            border: 0;
            transition: transform 0.5s;
            transform: scaleX(-1);
        }

        .wc-color-table td {
            border: 0;
            font-size: 30px;
            position: relative;
            width: 73.5px;
            height: 73.5px;
            text-align: center;
            padding: 0;
        }
        .wc-table td {
            border: 0;
            position: relative;
            width: 60px;
            height: 60px;
            text-align: center;
            padding: 0;
        }
        .wc-table.borders td {
            border: 1px solid #888;
        }

        .obstruction {
            width: 100%;
            height: 100%;
            position: absolute;
            margin: auto;
            top: 0; bottom: 0;
            left: 0; right: 0;
        }
        .invisible {
            visibility: hidden;
        }
        .hidden {
            display: none;
        }

        div.netsquare {
            position: absolute;
            margin: auto;
            top: 0; bottom: 0;
            left: 0; right: 0;
            display: inline-block;
            vertical-align: bottom;
            width: 1.17cm;
            height: 1.17cm;
            border: none;
            transform: scaleX(-1);
        }
        .wc-table td .facediv > div {
            position: static;
            display: inline-block;
            vertical-align: bottom;
            width: 1.3cm;
            height: 1.3cm;
            border: none;
        }
        .wc-color-table td .facediv > div {
            position: static;
            display: inline-block;
            vertical-align: bottom;
            width: 1.6cm;
            height: 1.6cm;
            border: none;
        }

        .wc-table th, .wc-color-table th {
            font-size: 15px;
            border: 0;
        }
        .wc-table th {
            transform: scaleX(-1);
            transition: transform 0.5s;
        }
        .wc-table td.bordered {
            border: 1px solid black;
        }

        .wc-table .facediv, .wc-color-table .facediv {
            box-sizing: border-box;
            border: 0px solid red;
        }
        .wc-table .facediv {
            width: 60px;
            height: 60px;
        }
        .wc-color-table .facediv {
            width: 73.5px;
            height: 73.5px;
        }

        .wc-color-table .facediv.chosen {
            border-width: 6.5px;
            border-style: dashed;
            border-color: #200;
            border-radius: 0;
        }

        svg.net-img2, svg.net-img3 {
            transition: transform 0.5s;
        }
        svg.net-img2 {
            margin-top: 50px;
            height: 265px;
        }
        svg.net-img3 {
            transform-origin: 50% 50%;
            margin-top: 43px;
            width: 163px;
            height: 227px;
        }
        .colorbutton { color: black; }
        .cube-color-cell.red, .square.red, td.red .facediv, .colorbutton.red, .bg-red { background-color: hsl(0, 75%, 75%); }
        .cube-color-cell.green, .square.green, td.green .facediv, .colorbutton.green, .bg-green { background-color: hsl(120, 75%, 75%); }
        .cube-color-cell.blue, .square.blue, td.blue .facediv, .colorbutton.blue, .bg-blue { background-color: hsl(220, 75%, 75%); }
        .cube-color-cell.cyan, .square.cyan, td.cyan .facediv, .colorbutton.cyan, .bg-cyan { background-color: hsl(180, 75%, 75%); }
        .cube-color-cell.magenta, .square.magenta, td.magenta .facediv, .colorbutton.magenta, .bg-magenta { background-color: hsl(300, 75%, 75%); }
        .cube-color-cell.yellow, .square.yellow, td.yellow .facediv, .colorbutton.yellow, .bg-yellow { background-color: hsl(60, 75%, 75%); }
        .cube-color-cell.white, .square.white, td.white .facediv, .colorbutton.white, .bg-white { background-color: #ffffff; }
        .cube-color-cell.orange, .square.orange, td.orange .facediv, .colorbutton.orange, .bg-orange { background-color: hsl(31, 75%, 75%); }
        .square.black, td.black { background-color: black; }
        .colorbutton.black { background: black; color: white; }
        .bg-gray { background-color: hsl(0, 0%, 75%); }

        td.red > .facediv, td.green > .facediv, td.blue > .facediv, td.cyan > .facediv, td.magenta > .facediv,
        td.yellow > .facediv, td.white > .facediv, td.orange > .facediv, .wc-color-table td > .facediv {
            border: 1px solid black;
        }

        .obstruction.red { background-color: hsla(0, 75%, 75%, 81%); }
        .obstruction.green { background-color: hsla(120, 75%, 75%, 81%); }
        .obstruction.blue { background-color: hsla(220, 75%, 75%, 81%); }
        .obstruction.cyan { background-color: hsla(180, 75%, 75%, 81%); }
        .obstruction.magenta { background-color: hsla(300, 75%, 75%, 81%); }
        .obstruction.yellow { background-color: hsla(60, 75%, 75%, 81%); }
        .obstruction.white { background-color: hsla(0, 100%, 100%, 81%); }
        .obstruction.orange { background-color: hsla(31, 75%, 75%, 81%); }

        .netshape.red { fill: hsl(0, 75%, 75%); }
        .netshape.green { fill: hsl(120, 75%, 75%); }
        .netshape.blue { fill: hsl(220, 75%, 75%); }
        .netshape.cyan { fill: hsl(180, 75%, 75%); }
        .netshape.magenta { fill: hsl(300, 75%, 75%); }
        .netshape.yellow { fill: hsl(60, 75%, 75%); }
        .netshape.white { fill: #ffffff; }
        .netshape.orange { fill: hsl(31, 75%, 75%); }

        .face, .stamp {
            border-radius: .1cm;
        }
        .face {
            position: absolute;
            width: 1.8cm;
            height: 1.8cm;
            background-size: 16cm 19.2cm;
            margin: auto;
            right: 0;
            bottom: 0;
        }
        .stamp {
            background-size: 12.8cm 15.36cm;
        }
        .netsquare {
            background-size: 11.528cm 13.824cm;
        }

        .face, .stamp, .netsquare {
            left: 0;
            top: 0;
            background-image: url("img/Pattern Cube/Faces.svg");
            background-repeat: no-repeat;
            box-sizing: border-box;
        }

        .rules-list li {
            margin-bottom: 20px;
        }

        .face.symbol-0, .netsquare.symbol-0, .stamp.symbol-0 { background-position: -0cm -0cm; }
        .face.symbol-1, .netsquare.symbol-1, .stamp.symbol-1 { background-position: -1.6cm -0cm; }
        .face.symbol-2, .netsquare.symbol-2, .stamp.symbol-2 { background-position: -3.2cm -0cm; }
        .face.symbol-3, .netsquare.symbol-3, .stamp.symbol-3 { background-position: -4.8cm -0cm; }
        .face.symbol-4, .netsquare.symbol-4, .stamp.symbol-4 { background-position: -6.4cm -0cm; }
        .face.symbol-5, .netsquare.symbol-5, .stamp.symbol-5 { background-position: -8cm -0cm; }
        .face.symbol-6, .netsquare.symbol-6, .stamp.symbol-6 { background-position: -9.6cm -0cm; }
        .face.symbol-7, .netsquare.symbol-7, .stamp.symbol-7 { background-position: -11.2cm -0cm; }
        .face.symbol-8, .netsquare.symbol-8, .stamp.symbol-8 { background-position: -12.8cm -0cm; }
        .face.symbol-9, .netsquare.symbol-9, .stamp.symbol-9 { background-position: -14.4cm -0cm; }
        .face.symbol-10, .netsquare.symbol-10, .stamp.symbol-10 { background-position: -0cm -1.6cm; }
        .face.symbol-11, .netsquare.symbol-11, .stamp.symbol-11 { background-position: -1.6cm -1.6cm; }
        .face.symbol-12, .netsquare.symbol-12, .stamp.symbol-12 { background-position: -3.2cm -1.6cm; }
        .face.symbol-13, .netsquare.symbol-13, .stamp.symbol-13 { background-position: -4.8cm -1.6cm; }
        .face.symbol-14, .netsquare.symbol-14, .stamp.symbol-14 { background-position: -6.4cm -1.6cm; }
        .face.symbol-15, .netsquare.symbol-15, .stamp.symbol-15 { background-position: -8cm -1.6cm; }
        .face.symbol-16, .netsquare.symbol-16, .stamp.symbol-16 { background-position: -9.6cm -1.6cm; }
        .face.symbol-17, .netsquare.symbol-17, .stamp.symbol-17 { background-position: -11.2cm -1.6cm; }
        .face.symbol-18, .netsquare.symbol-18, .stamp.symbol-18 { background-position: -12.8cm -1.6cm; }
        .face.symbol-19, .netsquare.symbol-19, .stamp.symbol-19 { background-position: -14.4cm -1.6cm; }
        .face.symbol-20, .netsquare.symbol-20, .stamp.symbol-20 { background-position: -0cm -3.2cm; }
        .face.symbol-21, .netsquare.symbol-21, .stamp.symbol-21 { background-position: -1.6cm -3.2cm; }
        .face.symbol-22, .netsquare.symbol-22, .stamp.symbol-22 { background-position: -3.2cm -3.2cm; }
        .face.symbol-23, .netsquare.symbol-23, .stamp.symbol-23 { background-position: -4.8cm -3.2cm; }
        .face.symbol-24, .netsquare.symbol-24, .stamp.symbol-24 { background-position: -6.4cm -3.2cm; }
        .face.symbol-25, .netsquare.symbol-25, .stamp.symbol-25 { background-position: -8cm -3.2cm; }
        .face.symbol-26, .netsquare.symbol-26, .stamp.symbol-26 { background-position: -9.6cm -3.2cm; }
        .face.symbol-27, .netsquare.symbol-27, .stamp.symbol-27 { background-position: -11.2cm -3.2cm; }
        .face.symbol-28, .netsquare.symbol-28, .stamp.symbol-28 { background-position: -12.8cm -3.2cm; }
        .face.symbol-29, .netsquare.symbol-29, .stamp.symbol-29 { background-position: -14.4cm -3.2cm; }
        .face.symbol-30, .netsquare.symbol-30, .stamp.symbol-30 { background-position: -0cm -4.8cm; }
        .face.symbol-31, .netsquare.symbol-31, .stamp.symbol-31 { background-position: -1.6cm -4.8cm; }
        .face.symbol-32, .netsquare.symbol-32, .stamp.symbol-32 { background-position: -3.2cm -4.8cm; }
        .face.symbol-33, .netsquare.symbol-33, .stamp.symbol-33 { background-position: -4.8cm -4.8cm; }
        .face.symbol-34, .netsquare.symbol-34, .stamp.symbol-34 { background-position: -6.4cm -4.8cm; }
        .face.symbol-35, .netsquare.symbol-35, .stamp.symbol-35 { background-position: -8cm -4.8cm; }
        .face.symbol-36, .netsquare.symbol-36, .stamp.symbol-36 { background-position: -9.6cm -4.8cm; }
        .face.symbol-37, .netsquare.symbol-37, .stamp.symbol-37 { background-position: -11.2cm -4.8cm; }
        .face.symbol-38, .netsquare.symbol-38, .stamp.symbol-38 { background-position: -12.8cm -4.8cm; }
        .face.symbol-39, .netsquare.symbol-39, .stamp.symbol-39 { background-position: -14.4cm -4.8cm; }
        .face.symbol-40, .netsquare.symbol-40, .stamp.symbol-40 { background-position: -0cm -6.4cm; }
        .face.symbol-41, .netsquare.symbol-41, .stamp.symbol-41 { background-position: -1.6cm -6.4cm; }
        .face.symbol-42, .netsquare.symbol-42, .stamp.symbol-42 { background-position: -3.2cm -6.4cm; }
        .face.symbol-43, .netsquare.symbol-43, .stamp.symbol-43 { background-position: -4.8cm -6.4cm; }
        .face.symbol-44, .netsquare.symbol-44, .stamp.symbol-44 { background-position: -6.4cm -6.4cm; }
        .face.symbol-45, .netsquare.symbol-45, .stamp.symbol-45 { background-position: -8cm -6.4cm; }
        .face.symbol-46, .netsquare.symbol-46, .stamp.symbol-46 { background-position: -9.6cm -6.4cm; }
        .face.symbol-47, .netsquare.symbol-47, .stamp.symbol-47 { background-position: -11.2cm -6.4cm; }
        .face.symbol-48, .netsquare.symbol-48, .stamp.symbol-48 { background-position: -12.8cm -6.4cm; }
        .face.symbol-49, .netsquare.symbol-49, .stamp.symbol-49 { background-position: -14.4cm -6.4cm; }
        .face.symbol-50, .netsquare.symbol-50, .stamp.symbol-50 { background-position: -0cm -8cm; }
        .face.symbol-51, .netsquare.symbol-51, .stamp.symbol-51 { background-position: -1.6cm -8cm; }
        .face.symbol-52, .netsquare.symbol-52, .stamp.symbol-52 { background-position: -3.2cm -8cm; }
        .face.symbol-53, .netsquare.symbol-53, .stamp.symbol-53 { background-position: -4.8cm -8cm; }
        .face.symbol-54, .netsquare.symbol-54, .stamp.symbol-54 { background-position: -6.4cm -8cm; }
        .face.symbol-55, .netsquare.symbol-55, .stamp.symbol-55 { background-position: -8cm -8cm; }
        .face.symbol-56, .netsquare.symbol-56, .stamp.symbol-56 { background-position: -9.6cm -8cm; }
        .face.symbol-57, .netsquare.symbol-57, .stamp.symbol-57 { background-position: -11.2cm -8cm; }
        .face.symbol-58, .netsquare.symbol-58, .stamp.symbol-58 { background-position: -12.8cm -8cm; }
        .face.symbol-59, .netsquare.symbol-59, .stamp.symbol-59 { background-position: -14.4cm -8cm; }
        .face.symbol-60, .netsquare.symbol-60, .stamp.symbol-60 { background-position: -0cm -9.6cm; }
        .face.symbol-61, .netsquare.symbol-61, .stamp.symbol-61 { background-position: -1.6cm -9.6cm; }
        .face.symbol-62, .netsquare.symbol-62, .stamp.symbol-62 { background-position: -3.2cm -9.6cm; }
        .face.symbol-63, .netsquare.symbol-63, .stamp.symbol-63 { background-position: -4.8cm -9.6cm; }
        .face.symbol-64, .netsquare.symbol-64, .stamp.symbol-64 { background-position: -6.4cm -9.6cm; }
        .face.symbol-65, .netsquare.symbol-65, .stamp.symbol-65 { background-position: -8cm -9.6cm; }
        .face.symbol-66, .netsquare.symbol-66, .stamp.symbol-66 { background-position: -9.6cm -9.6cm; }
        .face.symbol-67, .netsquare.symbol-67, .stamp.symbol-67 { background-position: -11.2cm -9.6cm; }
        .face.symbol-68, .netsquare.symbol-68, .stamp.symbol-68 { background-position: -12.8cm -9.6cm; }
        .face.symbol-69, .netsquare.symbol-69, .stamp.symbol-69 { background-position: -14.4cm -9.6cm; }
        .face.symbol-70, .netsquare.symbol-70, .stamp.symbol-70 { background-position: -0cm -11.2cm; }
        .face.symbol-71, .netsquare.symbol-71, .stamp.symbol-71 { background-position: -1.6cm -11.2cm; }
        .face.symbol-72, .netsquare.symbol-72, .stamp.symbol-72 { background-position: -3.2cm -11.2cm; }
        .face.symbol-73, .netsquare.symbol-73, .stamp.symbol-73 { background-position: -4.8cm -11.2cm; }
        .face.symbol-74, .netsquare.symbol-74, .stamp.symbol-74 { background-position: -6.4cm -11.2cm; }
        .face.symbol-75, .netsquare.symbol-75, .stamp.symbol-75 { background-position: -8cm -11.2cm; }
        .face.symbol-76, .netsquare.symbol-76, .stamp.symbol-76 { background-position: -9.6cm -11.2cm; }
        .face.symbol-77, .netsquare.symbol-77, .stamp.symbol-77 { background-position: -11.2cm -11.2cm; }
        .face.symbol-78, .netsquare.symbol-78, .stamp.symbol-78 { background-position: -12.8cm -11.2cm; }
        .face.symbol-79, .netsquare.symbol-79, .stamp.symbol-79 { background-position: -14.4cm -11.2cm; }
        .face.symbol-80, .netsquare.symbol-80, .stamp.symbol-80 { background-position: -0cm -12.8cm; }
        .face.symbol-81, .netsquare.symbol-81, .stamp.symbol-81 { background-position: -1.6cm -12.8cm; }
        .face.symbol-82, .netsquare.symbol-82, .stamp.symbol-82 { background-position: -3.2cm -12.8cm; }
        .face.symbol-83, .netsquare.symbol-83, .stamp.symbol-83 { background-position: -4.8cm -12.8cm; }
        .face.symbol-84, .netsquare.symbol-84, .stamp.symbol-84 { background-position: -6.4cm -12.8cm; }
        .face.symbol-85, .netsquare.symbol-85, .stamp.symbol-85 { background-position: -8cm -12.8cm; }
        .face.symbol-86, .netsquare.symbol-86, .stamp.symbol-86 { background-position: -9.6cm -12.8cm; }
        .face.symbol-87, .netsquare.symbol-87, .stamp.symbol-87 { background-position: -11.2cm -12.8cm; }
        .face.symbol-88, .netsquare.symbol-88, .stamp.symbol-88 { background-position: -12.8cm -12.8cm; }
        .face.symbol-89, .netsquare.symbol-89, .stamp.symbol-89 { background-position: -14.4cm -12.8cm; }
        .face.symbol-90, .netsquare.symbol-90, .stamp.symbol-90 { background-position: -0cm -14.4cm; }
        .face.symbol-91, .netsquare.symbol-91, .stamp.symbol-91 { background-position: -1.6cm -14.4cm; }
        .face.symbol-92, .netsquare.symbol-92, .stamp.symbol-92 { background-position: -3.2cm -14.4cm; }
        .face.symbol-93, .netsquare.symbol-93, .stamp.symbol-93 { background-position: -4.8cm -14.4cm; }
        .face.symbol-94, .netsquare.symbol-94, .stamp.symbol-94 { background-position: -6.4cm -14.4cm; }
        .face.symbol-95, .netsquare.symbol-95, .stamp.symbol-95 { background-position: -8cm -14.4cm; }
        .face.symbol-96, .netsquare.symbol-96, .stamp.symbol-96 { background-position: -9.6cm -14.4cm; }
        .face.symbol-97, .netsquare.symbol-97, .stamp.symbol-97 { background-position: -11.2cm -14.4cm; }
        .face.symbol-98, .netsquare.symbol-98, .stamp.symbol-98 { background-position: -12.8cm -14.4cm; }
        .face.symbol-99, .netsquare.symbol-99, .stamp.symbol-99 { background-position: -14.4cm -14.4cm; }
        .face.symbol-100, .netsquare.symbol-100, .stamp.symbol-100 { background-position: -0cm -16cm; }
        .face.symbol-101, .netsquare.symbol-101, .stamp.symbol-101 { background-position: -1.6cm -16cm; }
        .face.symbol-102, .netsquare.symbol-102, .stamp.symbol-102 { background-position: -3.2cm -16cm; }
        .face.symbol-103, .netsquare.symbol-103, .stamp.symbol-103 { background-position: -4.8cm -16cm; }
        .face.symbol-104, .netsquare.symbol-104, .stamp.symbol-104 { background-position: -6.4cm -16cm; }
        .face.symbol-105, .netsquare.symbol-105, .stamp.symbol-105 { background-position: -8cm -16cm; }
        .face.symbol-106, .netsquare.symbol-106, .stamp.symbol-106 { background-position: -9.6cm -16cm; }
        .face.symbol-107, .netsquare.symbol-107, .stamp.symbol-107 { background-position: -11.2cm -16cm; }
        .face.symbol-108, .netsquare.symbol-108, .stamp.symbol-108 { background-position: -12.8cm -16cm; }
        .face.symbol-109, .netsquare.symbol-109, .stamp.symbol-109 { background-position: -14.4cm -16cm; }
        .face.symbol-110, .netsquare.symbol-110, .stamp.symbol-110 { background-position: -0cm -17.6cm; }
        .face.symbol-111, .netsquare.symbol-111, .stamp.symbol-111 { background-position: -1.6cm -17.6cm; }
        .face.symbol-112, .netsquare.symbol-112, .stamp.symbol-112 { background-position: -3.2cm -17.6cm; }
        .face.symbol-113, .netsquare.symbol-113, .stamp.symbol-113 { background-position: -4.8cm -17.6cm; }
        .face.symbol-114, .netsquare.symbol-114, .stamp.symbol-114 { background-position: -6.4cm -17.6cm; }
        .face.symbol-115, .netsquare.symbol-115, .stamp.symbol-115 { background-position: -8cm -17.6cm; }
        .face.symbol-116, .netsquare.symbol-116, .stamp.symbol-116 { background-position: -9.6cm -17.6cm; }
        .face.symbol-117, .netsquare.symbol-117, .stamp.symbol-117 { background-position: -11.2cm -17.6cm; }
        .face.symbol-118, .netsquare.symbol-118, .stamp.symbol-118 { background-position: -12.8cm -17.6cm; }
        .face.symbol-119, .netsquare.symbol-119, .stamp.symbol-119 { background-position: -14.4cm -17.6cm; }
        .netsquare.symbol-150, .stamp.symbol-150 { background-position: 18cm 18cm; }

        table.tab-cube-colors {
            width: 260px;
            height: 260px;
            border: none;
        }
        table.tab-cube-colors td {
            border: 1px solid gray;
        }

        .leftpad {
            margin-left: 30px;
        }
        .leftpad2 {
            margin-left: 42px;
        }
        .gridstack.leftpad, .gridstack .leftpad {
            margin-left: 50px;
        }
        button {
            margin: 4px;
            border: black 2px solid;
            border-radius: 3px;
            transition: 1s;
            display: block;
            font-family: "Special Elite";
            padding-top: 3px;
        }
        button.reset-board, button.reset-all, button.reset-saves, button.save {
            padding-left: 2px;
            padding-bottom: 0px;
            padding-right: 2px;
        }
        .colorbutton {
            margin: 4px;
            border: 1px solid black;
            border-radius: 3px;
            font-size: 20px;
            width: 35px;
            height: 35px;
            box-sizing: border-box;
            padding-top: 5px;
        }
        .colorbutton.selected {
            border: 4px dashed red;
        }
        .wc-table .facediv.selected {
            border: 6px dashed red;
        }

        .symbol-row {
            height: 66px;
            margin: auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
        .symbol-row.letters {
            margin-left: 36px;
        }

        .grouptext {
            position: relative;
            text-align: right;
            width: 580px;
        }

        .net-rot-box {
            height: 30px;
            font-size: 18px;
            justify-content: left;
        }

        .net-rotation {
            width: 46px;
            text-align: right;
        }

        .square {
            width: 66px;
            height: 66px;
            float: left;
            font-size: 40px;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            text-align: center;
            position: relative;
            border: #808080 1px solid;
            box-sizing: border-box;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .square.numbers, .letters .square {
            border-width: 0;
            width: 50px;
            height: 50px;
        }
        .letters .square {
            margin-left: 14px;
        }
        .netnumHolder {
            position: relative;
            width: 100%;
            height: 100%;
            transform-origin: 50% 50%;
        }
        .netnum {
            color: black;
            position: absolute;
            top: 0px;
            left: 1px;
            font-size: 13.5px;
            font-weight: bold;
        }
        .square.animate, .animate .netnumHolder {
            transition: transform 0.5s !important;
        }

        .stamp {
            cursor: pointer;
        }
        .netmark {
            border: 4px solid black;
        }

        .square.net {
            border-left: 4px solid black !important;
            border-right: 4px solid black !important;
            border-top: 4px solid black !important;
            border-bottom: 4px solid black !important;
        }

        .net .netsquare {
            margin-bottom: 4px;
        }

        .netmark, .rotatetool {
            margin: 2px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-content: center;
            flex-direction: column;
        }

        .rotatetool {
            font-size: 16px;
            border: 3px solid black;
            border-radius: 32px;
        }

        .dark .netmark, .dark .rotatetool {
            border-color: #DDD;
        }

        .stamp.selected {
            border: 3px dashed red;
        }
        .netmark.selected {
            border: 4px dashed red;
        }

        .copy-cube {
            height: 0;
        }
        .tcube {
            position: relative;
            top: 110px;
        }
        .bcube {
            position: relative;
            top: 230px;
        }
        .symbolboard {
            transform-origin: 50% 50%;
            transition: transform 0.5s;
        }
        .gridholder {
            width: 360px;
            margin-left: 0;
            margin-top: 10px;
        }

        .lWalkpath {
            margin-top: 0;
            margin-bottom: 0;
        }

        .net-rot-box button {
            height: 30px;
            width: 40px;
            background-size: 30px 64px;
            background-position: 2px -20px;
            background-repeat: no-repeat;
            position: relative;
            bottom: 2px;
            display: flex;
            justify-content: center;
            align-content: center;
            flex-direction: column;
        }

        button:hover {
            color: white;
            background-color: black;
        }
        button.flash {
            color: white;
            background-color: blue;
        }

        h4 {
            margin-top: 3mm;
            padding-left: 6mm;
        }

        .buttons {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .page {
            background-repeat: repeat-y;
            background-position: top;
        }

        button.rotatenet {
            background-repeat: no-repeat;
        }

        button.rotatenet.bg-ccw, button.rotatenet.bg-cw {
            height: 19px;
            width: 34px;
        }
        .bg-ccw {
            background-image: url('img/Common/ccw-arrow.svg');
        }
        .bg-cw {
            background-image: url('img/Common/cw-arrow.svg');
        }
        button.rotatenet.bg-ccw {
            background-size: 27px 60px;
            background-position: 2px -22.5px;
        }
        button.rotatenet.bg-cw {
            background-size: 27px 57px;
            background-position: 2px -21px;
        }
        button.flipnet {
            height: 19px;
            width: 34px;
            font-family: 'Logic-round';
            font-size: 23px;
            font-weight: bold;
            padding: 0;
            line-height: 9px;
        }
        button.flipnet::after { content: '↔'; }
        button.bg-ccw:hover {
            background-image: url('img/Common/ccw-arrowW.svg');
        }
        button.bg-cw:hover {
            background-image: url('img/Common/cw-arrowW.svg');
        }
        .gridstack button, button.reset2 {
            border: black 3px solid;
            font-size: 18px;
        }
        button.show-tp {
            font-size: 10pt;
            width: 18mm;
            text-align: center;
            margin-right: 10mm;
        }
        button.show-tp:not(.shown)::after {
            content: 'TP Help Hidden';
        }
        button.show-tp.shown::after {
            content: 'TP Help Shown';
        }

    </style>
    <script>
        const colorNames = ["RED", "GREEN", "BLUE", "CYAN", "MAGENTA", "YELLOW", "WHITE", "ORANGE"];

        const defaultColors = [[0, 0, 4, 6, 2], [2, 0, 3, 4, 0], [5, 5, 6, 7, 5], [1, 2, 4, 1, 6], [2, 2, 1, 4, 2]]
        const defaultSymbols = [[70, 80, 75, 117, 93], [10, 11, 12, 111, 14], [0, 112, 2, 105, 20], [62, 16, 103, 18, 19], [4, 21, 22, 23, 24]]
        const numSymbols = 120;
        const smallOff = [0.8, 0.8, 1, 0];
        const smallOff2 = [0.9, 0.9, 0, -1];
        const nosym = "18cm 18cm";

        function setDefaultRules() {
            showRules(defaultColors, defaultSymbols);
        }

        function setRules(rnd) {
            if (rnd.seed === 1) {
                setDefaultRules();
                return;
            }

            // Colors
            const colors = []
            for (let i = 0; i < colorNames.length; ++i) {
                colors.push(i);
            }
            rnd.shuffleFisherYates(colors);
            let newColors = [];
            for (let row of defaultColors) {
                const newRow = [];
                for (let val of row) {
                    if (val === -1) {
                        newRow.push(-1);
                    } else {
                        newRow.push(colors[val]);
                    }
                }
                newColors.push(newRow);
            }
            if (rnd.nextDouble() > 0.5) {
                newColors = mirrorHorizontal(newColors);
            }
            if (rnd.nextDouble() > 0.5) {
                newColors = mirrorVertical(newColors);
            }
            newColors = rotate(newColors, rnd.next(0, 4));

            // Symbols
            const symbols = [];
            for (let i = 0; i < numSymbols; i++) {
                symbols.push(i);
            }
            rnd.shuffleFisherYates(symbols);
            console.log(symbols)

            const symbolGrid = [];
            for (let i = 0; i < 5; i++) {
                const row = [];
                for (let j = 0; j < 5; j++) {
                    row.push(symbols[defaultSymbols[i][j]]);
                }
                symbolGrid.push(row);
            }

            // Show rules
            showRules(newColors, symbolGrid);
        }

        function removeAllChildNodes(parent) {
            while (parent.firstChild) {
                parent.removeChild(parent.firstChild);
            }
        }

        function showRules(colors, symbols) {
            let table1 = $(".wc-color-table");
            if (table1.find("tr").length > 0) {
                location.reload();
            }
            let table2 = $(".wc-table");

            for (let r = 0; r < 6; r++) {
                let row1 = $("<tr>").appendTo(table1);
                let row2 = $("<tr>").appendTo(table2);
                if (r == 0) {
                    for (let c = 1; c <= 5; c++) {
                        $("<th>").text(`Page\n${c}`).addClass("pagenum").appendTo(row1);
                        let th = $("<th>").text(`Page\n`).addClass("pagenum").appendTo(row2);
                        $("<span>").addClass("page-num").text(c).appendTo(th);
                        $("<span>").addClass("page-let hidden").text(String.fromCharCode(64 + c)).appendTo(th);
                    }
                }
                else {
                    for (let c = 0; c < 5; c++) {
                        let td2 = $("<td>").click(function() {
                            let facediv = $(this).find(".facediv");
                            if (facediv) {
                                $(".selected").removeClass("selected");
                                selectedCol = selected = selectedBgPos = null;

                                facediv.addClass("selected");
                                let stamp = facediv.find(".stamp");
                                let st = hasWhichSymbolClass(stamp);
                                if (st >= 0) { selected = stamps[st]; }
                                selectedBgPos = stamp.css("background-position");
                                let col = hasWhichColor($(this));
                                if (col >= 0) { selectedCol = faceColors[col]; }
                            }
                        }).appendTo(row2);
                        let td1 = $("<td>").click(function(event) {
                            if (NoSpecialKeys(event)) {
                                $(this).find(".facediv").toggleClass("chosen");
                                if ($(this).find(".facediv").hasClass("chosen")) {
                                    $(this).find(".obstruction").addClass("invisible");
                                    let copy = $(this).html();
                                    let col = hasWhichBgClass($(this));
                                    removeColorClass(td2);
                                    td2.html(copy).addClass(faceColors[col]); // + " bordered"
                                    td2.find(".facediv").removeClass("chosen");
                                    td2.find(".obstruction").remove();
                                    let f = td2.find(".face");
                                    f.removeClass("face").addClass("stamp");
                                    offBGPosition(f, smallOff[0], smallOff[1], smallOff[2], smallOff[3]);
                                }
                                else {
                                    $(this).find(".obstruction").removeClass("invisible");
                                    removeColorClass(td2);
                                    td2.html(""); //.removeClass("bordered")
                                    selectedCol = selected = selectedBgPos = null;
                                    updateSelection(null);
                                }
                            }
                        }).appendTo(row1);
                        let facediv = $("<div>").addClass("facediv vstack").appendTo(td1);
                        $("<div>").addClass("face symbol-0").appendTo(facediv);
                        $("<div>").addClass("obstruction").appendTo(td1);
                    }
                    $("<th>").addClass("tp-row invisible").text(r).appendTo(row2);
                }
            }
            $(".wc-color-table td").each(function (i) {
                let color = colorNames[colors[Math.floor(i / 5)][i % 5]];
                $(this).removeClass("bg-gray " + colorNames.map(c => 'bg-' + c.toLowerCase()).join(" "));
                if (color) {
                    $(this).addClass('bg-' + color.toLowerCase());
                    $(this).find(".obstruction").addClass(color.toLowerCase());
                } else {
                    $(this).addClass("bg-gray");
                }
                // $(this).text("" + symbols[Math.floor(i / 5)][i % 5]);
            });
            $(".wc-color-table td .facediv div").each(function (i) {
                $(this).attr('class', $(this).attr('class').replace(/symbol-\d+/, "symbol-" + symbols[Math.floor(i / 5)][i % 5]));
                stamps.push("symbol-" + symbols[Math.floor(i / 5)][i % 5]);
            });
            completeSetup();
        }

        function reverse(arr) {
            const res = [];
            for (let i = arr.length - 1; i >= 0; --i) {
                res.push(arr[i]);
            }
            return res;
        }

        function mirrorVertical(arr) {
            const res = [];
            for (let row of arr) {
                res.push(reverse(row));
            }
            return res;
        }

        function mirrorHorizontal(arr) {
            return reverse(arr);
        }

        function rotate(arr, count) {
            count %= 4;
            let res = arr;
            while (true) {
                if (count < 0 || res.length < 1) {
                    console.error("uh oh");
                    return;
                }
                if (count === 0) {
                    return res;
                }

                const resultArr = [];
                for (let i = 0; i < res[0].length; ++i) {
                    const row = [];
                    for (let j = 0; j < res.length; ++j) {
                        row.push(res[res.length - j - 1][i]);
                    }
                    resultArr.push(row);
                }

                res = resultArr;
                --count;
            }
        }

        let faceColors = ["black", "white", "red", "green", "blue", "magenta", "orange", "yellow", "cyan"];
        let bgClass = ["bg-black", "bg-white", "bg-red", "bg-green", "bg-blue", "bg-magenta", "bg-orange", "bg-yellow", "bg-cyan"];
        let colorLetter = ["K", "W", "R", "G", "B", "M", "O", "Y", "C"];
        var stamps = [];
        function hasWhichColor(elem) {
            for (var i = 0; i < faceColors.length; i++) {
                if (elem.hasClass(faceColors[i])) { return i; }
            }
            return -1;
        }
        function hasWhichBgClass(elem) {
            for (var i = 0; i < bgClass.length; i++) {
                if (elem.hasClass(bgClass[i])) { return i; }
            }
            return -1;
        }
        function hasWhichSymbolClass(elem) {
            for (let i = 0; i < stamps.length; i++) {
                if (elem.hasClass(stamps[i])) { return i; }
            }
            return -1;
        }

        function nextColor(elem) {
            let c = hasWhichColor(elem);
            removeColorClass(elem);
            elem.addClass(faceColors[(c + 1) % faceColors.length]);
        }

        function removeColorClass(elem) {
            faceColors.forEach(function(val) {
                elem.removeClass(val);
            });
        }

        function hierHasClass(elem, classname) {
            if (elem.className && elem.className.split(' ').indexOf(classname)>=0) {return true;}
            return elem.parentNode && hierHasClass(elem.parentNode, classname);
        }

        function offBGPosition(elem, x, y, dx, dy) {
            let prop = elem.css("background-position").replace(/px/g, "").split(' ');
            let pos = [parseFloat(prop[0]),parseFloat(prop[1])];
            pos[0] = pos[0] * x + dx;
            pos[1] = pos[1] * y + dy;
            elem.css("background-position", `${pos[0]}px ${pos[1]}px`);
        }

        function updateSelection(elem) {
            $(".selected").removeClass("selected");
            if (elem && elem.length > 0) {
                elem.addClass("selected");
            }
        }

        function nextPathN() {
            pathN.sort(function(a, b) {
                return a - b;
            });
            let first = 1;
            for (let i = 1; i <= pathN.length; i++) {
                first = pathN[i-1];
                if (first !== i) {
                    first = i;
                    break;
                }
                first = i + 1;
            }
            pathN.push(first);
            return first;
        }

        let netRotation = [0,0,0];
        let netflipX = [1,1,1];
        let netflipY = [1,1,1];
        var selected = null;
        var selectedCol = null;
        var selectedBgPos = null;
        var pathN = [];

        function completeSetup() {
            let cubeColorTable = $(".tab-cube-colors");
            removeAllChildNodes(cubeColorTable[0]);
            let cbstacks = $(".vstack.colors .colorrow");
            removeAllChildNodes(cbstacks[0]);
            removeAllChildNodes(cbstacks[1]);

            for (let r = 0; r < 5; r++) {
                let row = $("<tr>").appendTo(cubeColorTable);
                for (let r = 0; r < 5; r++) {
                    $("<td>").click(function() {
                        if (faceColors.includes(selected)) {
                            let cell = $(this);
                            var whichColor = hasWhichColor(cell);
                            if (whichColor >= 0) {
                                cell.removeClass(faceColors[whichColor]);
                                if (faceColors[whichColor] != selected) {
                                    cell.addClass(selected);
                                } else {
                                    cell.addClass("black");
                                }
                            } else {
                                cell.removeClass("black");
                                cell.addClass(selected);
                            }
                        }
                    }).addClass("cube-color-cell black").appendTo(row);
                }
            }

            for (let c = 0; c < colorLetter.length; c++) {
                let cButtons = (c < 5 ? $(".vstack.colors .hstack.r1") : $(".vstack.colors .hstack.r2"));
                $("<div>").text(colorLetter[c]).click(function() {
                    selected = faceColors[c];
                    updateSelection($(this));
                }).addClass("colorbutton hstack " + faceColors[c]).appendTo(cButtons);
            }

            function rotateFlipNetShape(net, r, nfX, nfY) {
                $(`.net${net} svg.centered-img`).css("transform", `rotate(${90*r}deg) scale(${nfX}, ${nfY})`);
            }

            function flipNetShape(net) {
                let r = netRotation[net-1];
                if (r % 2 == 0) { netflipX[net-1] *= -1; }
                else { netflipY[net-1] *= -1; }
                rotateFlipNetShape(net, r, netflipX[net-1], netflipY[net-1]);
            }

            $("svg.centered-img").each((i) => {
                $("svg.centered-img").eq(i).dblclick(function(event) {
                    if (NoSpecialKeys(event)) {
                        flipNetShape(i + 1);
                    }
                }).click(function(event) {
                    if (event.shiftKey) {
                        netRotation[i] += 1;
                    } else if (event.ctrlKey || event.metaKey) {
                        netRotation[i] -= 1;
                    }
                    rotateFlipNetShape(i + 1, netRotation[i], netflipX[i], netflipY[i]);
                });
            });

            $("button.rotatenet").click(function() {
                let b = $(this);
                let net = 3;
                if (hierHasClass(b[0], "net1")) { net = 1 }
                else if (hierHasClass(b[0], "net2")) { net = 2 }
                netRotation[net-1] += (b.hasClass("bg-cw") ? 1 : -1);
                rotateFlipNetShape(net, netRotation[net-1], netflipX[net-1], netflipY[net-1]);
            });

            $("button.flipnet").click(function() {
                let b = $(this);
                let net = 3;
                if (hierHasClass(b[0], "net1")) { net = 1 }
                else if (hierHasClass(b[0], "net2")) { net = 2 }
                flipNetShape(net);
            });

            $(".netshape").click(function(event) {
                if (faceColors.includes(selected) && NoSpecialKeys(event)) {
                    let cell = $(this);
                    var whichColor = hasWhichColor(cell);
                    if (whichColor >= 0) {
                        cell.removeClass(faceColors[whichColor]);
                        if (faceColors[whichColor] != selected) {
                            cell.addClass(selected);
                        } else {
                            cell.addClass("black");
                        }
                    } else {
                        cell.removeClass("black");
                        cell.addClass(selected);
                    }
                }
            });

            var symbolboard = $(".symbolboard");
            var row = $(".net-rot-box");
            let tools = $(".tools");
            removeAllChildNodes(symbolboard[0]);
            removeAllChildNodes(row[0]);
            removeAllChildNodes(tools[0]);

            var start;
            let saveStates = [];
            let currentState = 0;

            $(document).click(function() {
                start = null;
            }).keydown(function(event) {
                if (event.key == "Escape") {
                    selectNet();
                }
            });

            var squares = 4;
            var rows = 4;
            var rotations = {};
            var gridRotation = 0;
            row = $(".net-rot-box");
            $("<span>").text(`Net\xa0Rotation:`).appendTo(row);
            $("<div>").addClass("net-rotation thenumber").text("0").appendTo(row);
            $("<div>").addClass("net-rotation").text("deg").appendTo(row);
            $("<div>").css("width", "5px").appendTo(row);
            $("<button>").addClass("bg-ccw").appendTo(row).click(function() {
                rotateNet(true);
            });
            $("<button>").addClass("bg-cw").appendTo(row).click(function() {
                rotateNet(false);
            });

            function rotateNet(ccw) {
                gridRotation = gridRotation + (ccw ? 1 : -1);
                $(".wc-table").css("transform", `scaleX(-1) rotate(${gridRotation * 90}deg)`);
                $(".wc-table th").css("transform", `scaleX(-1) rotate(${gridRotation * 90}deg)`);
                $(".net-rotation.thenumber").text(`${UMod(-gridRotation, 4) * 90}`);
            }

            row = $("<div>").addClass("symbol-row letters").appendTo(symbolboard);
            for (var i = 0; i < squares; i++) {
                $("<div>").addClass("square").text(String.fromCharCode(65 + i)).appendTo(row);
            }
            for (let y = 1; y <= rows; y++) {
                row = $("<div>").addClass("symbol-row").appendTo(symbolboard);
                $("<div>").addClass("square numbers").text(y).appendTo(row);
                for (let x = 0; x < squares; x++) {
                    let square = $("<div>").addClass("netsq square white").appendTo(row).each(function(_, e) {
                        rotations[`${squares*y + x}`] = 0;
                        var element = $(e);

                        element.mousedown(function(event) {
                            start = [x, y];
                            event.preventDefault();
                            event.stopPropagation();
                        });

                        element.mouseup(function(event) {
                            if (start) { // Just in case.
                                var changed = [];
                                var i, dist, dirx, diryi;
                                if (start[0] == x) {
                                    dist = Math.abs(start[1] - y);
                                    diry = (start[1] < y) ? 1 : -1;
                                    for (i = 0; i <= dist; i++) {
                                        changed.push([x, start[1] + i * diry]);
                                    }
                                } else if (start[1] == y) {
                                    dist = Math.abs(start[0] - x);
                                    dirx = (start[0] < x) ? 1 : -1;
                                    for (i = 0; i <= dist; i++) {
                                        changed.push([start[0] + i * dirx, y]);
                                    }
                                } else if (Math.abs(start[0] - x) == Math.abs(start[1] - y)) {
                                    dist = Math.abs(start[0] - x);
                                    dirx = (start[0] < x) ? 1 : -1;
                                    diry = (start[1] < y) ? 1 : -1;

                                    for (i = 0; i <= dist; i++) {
                                        changed.push([start[0] + i * dirx, start[1] + i * diry]);
                                    }
                                }

                                if (changed.length > 0) {
                                    let from = symbolboard.children().eq(start[1]).children().eq(start[0] + 1);
                                    let firstnet = from.hasClass("net");
                                    let firstcol = from.hasClass(selected);
                                    let toMove = hasWhichSymbolClass(from);
                                    let whichColor = hasWhichColor(from);
                                    changed.forEach(function(pos) {
                                        let elm = symbolboard.children().eq(pos[1]).children().eq(pos[0] + 1);
                                        if (event.ctrlKey || event.metaKey) {
                                            if (changed.length == 1) {
                                                var r = squares * y + x;
                                                elm.addClass("animate");
                                                rotate90(elm, r, false);
                                                setTimeout(function(){ elm.removeClass("animate"); }, 500);
                                            }
                                        } else if (event.shiftKey || selected == "rotating") {
                                            if (changed.length == 1) {
                                                var r = squares * y + x;
                                                elm.addClass("animate");
                                                rotate90(elm, r, true);
                                                setTimeout(function(){ elm.removeClass("animate"); }, 500);
                                            }
                                        } else if (selected == "netting") {
                                            let shouldChange = (elm.hasClass("net") != !firstnet);
                                            if (changed.length == 1) {
                                                elm.toggleClass("net");
                                            } else {
                                                if (shouldChange) {
                                                    elm.toggleClass("net");
                                                }
                                            }
                                            if (shouldChange && elm.hasClass("net")) {
                                                elm.find(".netnum").text(nextPathN());
                                            } else if (shouldChange) {
                                                let n = parseInt(elm.find(".netnum").text());
                                                pathN.splice(pathN.indexOf(n), 1);
                                                elm.find(".netnum").text("");
                                            }
                                        } else if (faceColors.includes(selected)) {
                                            if (whichColor >= 0) {
                                                removeColorClass(elm);
                                                let col = (faceColors[whichColor] != selected ? selected : "white");
                                                elm.addClass(col);
                                                if (!elm.hasClass(col)) { elm.addClass("white"); }
                                            }
                                        } else if (selectedCol && changed.length == 1) {
                                            let ns = elm.find(".netsquare");
                                            let whichSymbol = hasWhichSymbolClass(ns);
                                            if (whichSymbol >= 0) {
                                                ns.removeClass(stamps[whichSymbol]);
                                                elm.css("transform", "rotate(0)");
                                                elm.find(".netnumHolder").css("transform", "rotate(0)");
                                                rotations[squares * y + x] = 0;
                                                if (stamps[whichSymbol] != selected) {
                                                    ns.addClass(selected);
                                                    ns.css("background-position", selectedBgPos);
                                                    offBGPosition(ns, smallOff2[0], smallOff2[1], smallOff2[2], smallOff2[3]);
                                                    removeColorClass(elm);
                                                    elm.addClass(selectedCol);
                                                } else {
                                                    ns.addClass("symbol-150").css("background-position", nosym);
                                                    removeColorClass(elm);
                                                    elm.addClass("white");
                                                }
                                            } else {
                                                ns.removeClass("symbol-150");
                                                ns.addClass(selected);
                                                ns.css("background-position", selectedBgPos);
                                                offBGPosition(ns, smallOff2[0], smallOff2[1], smallOff2[2], smallOff2[3]);
                                                removeColorClass(elm);
                                                elm.addClass(selectedCol);
                                            }
                                        }
                                    });
                                }

                                start = null;
                            }
                            event.preventDefault();
                            event.stopPropagation();
                        });
                    });
                    let nnh = $("<div>").addClass("netnumHolder").appendTo(square);
                    $("<div>").addClass("netnum").appendTo(nnh);
                    $("<div>").addClass("netsquare symbol-150").appendTo(square);
                }
            }

            function removeSymbolClass(elem) {
                stamps.forEach(function(val) {
                    elem.removeClass(val);
                });
            }

            function hasWhichSymbolClass(elem) {
                for (let i = 0; i < stamps.length; i++) {
                    if (elem.hasClass(stamps[i])) {
                        return i;
                    }
                }
                return -1;
            }

            function rotate90(elem, r, cw) {
                rotations[r] = rotations[r] + (cw ? 1 : -1);
                elem.css("transform", `rotate(${rotations[r] * 90}deg)`);
                elem.find(".netnumHolder").css("transform", `rotate(${-rotations[r] * 90}deg)`);
            }

            function selectNet() {
                $(".selected").removeClass("selected");
                $(".netmark").addClass("selected");
                selected = selectedCol = "netting";
            }

            $("<button>").addClass("show-tp").appendTo(tools).click(function() {
                $(this).toggleClass("shown");
                $(".pagenum .page-num, .pagenum .page-let").toggleClass("hidden");
                $(".wc-table").toggleClass("borders");
                $(".wc-table .tp-row").toggleClass("invisible");
            });
            $("<div>").addClass("stamp square netmark symbol-150").text("Net").appendTo(tools).click(function() {
                selectNet();
            }).click();
            $("<div>").addClass("stamp square rotatetool symbol-150").text("Rotate").appendTo(tools).click(function() {
                $(".selected").removeClass("selected");
                $(this).addClass("selected");
                selected = selectedCol = "rotating";
            });

            $(".reset-board").click(function() {
                $(".netsq.square").each(function(_, e) {
                    removeColorClass($(e));
                }).addClass("white").css("transform", "rotate(0)");
                $(".netnumHolder").css("transform", "rotate(0)");

                $(".square .netsquare").each(function(_, e) {
                    removeSymbolClass($(e));
                }).addClass("symbol-150").css("background-position", nosym);

                for (var key in rotations){ rotations[key] = 0; }
            });

            $(".reset-saves").click(function() {
                saveStates.forEach(x => x.remove());
                saveStates = [];
                currentState = 0;
            });
            $(".reset-all").click(function() {
                $(".netsq.square").each(function(_, e) {
                    removeColorClass($(e));
                }).removeClass("net").addClass("white").css("transform", "rotate(0)");
                $(".netnumHolder").css("transform", "rotate(0)");

                $(".square .netsquare").each(function(_, e) {
                    removeSymbolClass($(e));
                }).addClass("symbol-150").css("background-position", nosym);

                $(".netnum").text("");
                pathN.splice(0, pathN.length);

                for (var key in rotations){ rotations[key] = 0; }
                saveStates.forEach(x => x.remove());
                saveStates = [];
                currentState = 0;
                selectNet();
            });
            $(".reset2").click(function() {
                $(".wc-color-table td .chosen").each(function(_, e){
                    e.parentNode.click();
                });
                for (let i = 0; i < netRotation.length; i++) { netRotation[i] = 0; };
                $("svg.centered-img").css("transform", "rotate(0)");
                removeColorClass($(".cube-color-cell"));
                $(".cube-color-cell").addClass("black");
            });

            function removeFutureSaves() {
                if (currentState < saveStates.length - 1) {
                    for (let i = currentState + 1; i < saveStates.length; i++) {
                        saveStates[i].remove();
                    }

                    saveStates.splice(currentState + 1, saveStates.length - currentState);
                }
            }

            $("button.save").click(function() {
                removeFutureSaves();

                let saveStateGrid = Array.from($(".symbolboard .square")).map(x => $(x)).map(x => x.attr("class") || "");
                let saveStateNetsq = Array.from($(".symbolboard .netsquare")).map(x => $(x)).map(x => x.attr("class") || "");
                let saveStateNsBg = Array.from($(".symbolboard .netsquare")).map(x => $(x)).map(x => x.css("background-position") || "");
                let saveStateTran = Array.from($(".square")).map(x => $(x)).map(x => x.css("transform") || "");
                let saveStateNTran = Array.from($(".square .netnumHolder")).map(x => $(x)).map(x => x.css("transform") || "");
                let saveStateN = Array.from($(".square .netnum")).map(x => $(x)).map(x => x.text() || "");
                console.log(saveStates);
                let stateNumber = saveStates.length;
                currentState = stateNumber;
                var rot = {};
                Object.assign(rot, rotations);
                let pathNums = [];
                Object.assign(pathNums, pathN);

                let button = $("<button>").text(stateNumber + 1).click(function() {
                    $(".symbolboard .square").each((i, x) => $(x).attr("class", saveStateGrid[i]));
                    $(".symbolboard .netsquare").each((i, x) => $(x).attr("class", saveStateNetsq[i]));
                    $(".symbolboard .netsquare").each((i, x) => $(x).css("background-position", saveStateNsBg[i]));
                    $(".square").each((i, x) => $(x).css("transform", saveStateTran[i]));
                    $(".square .netnumHolder").each((i, x) => $(x).css("transform", saveStateNTran[i]));
                    $(".square .netnum").each((i, x) => $(x).text(saveStateN[i]));
                    Object.assign(rotations, rot);
                    currentState = stateNumber;
                    Object.assign(pathN, pathNums);
                    pathN.splice(pathNums.length);
                }).addClass("flash").appendTo(".saves");
                setTimeout(() => {
                    button.removeClass("flash");
                }, 100);

                saveStates.push(button);
            });
        }
    </script>
</head>
<body>
    <div class="page page-bg-01">
        <div class="page-header">
            <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
            <span class="page-header-section-title">Walking Cube</span>
        </div>
        <div class="page-content">
            <img src="img/Component/Walking Cube.svg" class="diagram">
            <h2>On the Subject of Walking Cubes</h2>
            <p class="flavour-text">I mean, it’s more of a “roll” if you think about it...</p>

            <ul class="rules-list">
                <li>
                    Present on the module is a cube which is “walking” around the module. The cube has several colored
                    faces. Take note of these faces and their relative orientations.
                </li>
                <li>
                    First, align one of the cube nets below over Table 1 in such a way that the colors covered by the
                    net, when folded back into a cube, would match the colors on the cube on the module. Note that the
                    nets may flipped or rotated in the table.
                </li>
                <li>
                    Once you determine the correct net to use, take note of the symbols (and their orientations) on each
                    face of the net. Aligning this net with the cube on the module will indicate which symbols are on
                    which faces of the cube. <em>Note: when re-folding the net, the symbols should be oriented
                    OUTWARD.</em>
                </li>
                <li>
                    As the cube moves around the 4×4 grid, use the symbol selectors to fill the grid squares that the
                    cube touches such that the placed symbols match (including orientation) the symbol on the cube face
                    which touched the grid square. In other words, answer the question of “if the cube left symbol
                    impressions on the grid below as it moved around, what would the grid look like?”
                </li>
                <li>
                    Tap a symbol in the selection bar to select it. Tap the symbol again to rotate it. A green frame
                    indicates which symbol is selected.
                </li>
                <li>
                    To change pages for the symbol selectors, press the page indicator button. For easy reference, Table
                    1 lists the page that each symbol is in.
                </li>
                <li>
                    Tap a square in the grid to place the selected symbol. Do not tap a square in the net when no symbol
                    is selected.
                </li>
                <li>
                    To disarm the module, all grid squares corresponding to spaces which the walking cube touches must
                    be
                    filled in with the proper symbol in the correct orientation
                </li>
                <li>
                    Attempting to place a symbol in an incorrect grid square or an incorrect orientation will incur a
                    strike.
                </li>
            </ul>
        </div>
        <div class="page-footer relative-footer">Page 1 of 3</div>
    </div>
    <div class="section">
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Walking Cube</span>
            </div>
            <div class="page-content">
                <div class="hstack wrap">
                    <div class="vstack">
                        <h3>Table 1</h3>
                        <table class="wc-color-table"></table>
                    </div>
                    <div class="vstack leftpad">
                        <div style="height: 7mm"></div>
                        <h3>Cube Face Colors</h3>
                        <table class="tab-cube-colors"></table>
                        <div class="vstack colors">
                            <div class="colorrow hstack r1"></div>
                            <div class="colorrow hstack r2"></div>
                        </div>
                        <div style="height: 2mm"></div>
                        <button class="reset2">Reset Page 2</button>
                    </div>
                </div>
                <div style="height: 5mm"></div>

                <div class="hstack wrap" style="align-items: baseline">
                    <div class="vstack net1" style="width: 62mm">
                        <div class="hstack">
                            <button class="rotatenet bg-ccw"></button>
                            <button class="flipnet"></button>
                            <button class="rotatenet bg-cw"></button>
                        </div>
                        <svg class="centered-img net-img2" viewBox="0 0 111 261">
                            <g transform="translate(5.5 5.5)" fill="#bbb" stroke="#000" stroke-width="1"
                               stroke-miterlimit="4" stroke-opacity="1">
                                <rect class="netshape" width="50" height="50" x="50" y="0"/>
                                <rect class="netshape" width="50" height="50" x="50" y="50"/>
                                <rect class="netshape" width="50" height="50" x="0" y="100"/>
                                <rect class="netshape" width="50" height="50" x="50" y="100"/>
                                <rect class="netshape" width="50" height="50" x="0" y="150"/>
                                <rect class="netshape" width="50" height="50" x="0" y="200"/>
                            </g>
                        </svg>
                    </div>
                    <div class="vstack net2" style="width: 65mm">
                        <div class="hstack">
                            <button class="rotatenet bg-ccw"></button>
                            <button class="flipnet"></button>
                            <button class="rotatenet bg-cw"></button>
                        </div>
                        <svg class="centered-img net-img3" viewBox="0 0 161 211">
                            <g transform="translate(5.5 5.5)" fill="#bbb" stroke="#000" stroke-width="1"
                               stroke-miterlimit="4" stroke-opacity="1">
                                <rect class="netshape" width="50" height="50" x="0" y="0"/>
                                <rect class="netshape" width="50" height="50" x="0" y="50"/>
                                <rect class="netshape" width="50" height="50" x="50" y="50"/>
                                <rect class="netshape" width="50" height="50" x="100" y="50"/>
                                <rect class="netshape" width="50" height="50" x="50" y="100"/>
                                <rect class="netshape" width="50" height="50" x="50" y="150"/>
                            </g>
                        </svg>
                    </div>
                    <div class="vstack net3" style="width: 48mm">
                        <div class="hstack">
                            <button class="rotatenet bg-ccw"></button>
                            <button class="flipnet"></button>
                            <button class="rotatenet bg-cw"></button>
                        </div>
                        <svg class="centered-img net-img3" viewBox="0 0 161 211">
                            <g transform="translate(5.5 5.5)" fill="#bbb" stroke="#000" stroke-width="1"
                               stroke-miterlimit="4" stroke-opacity="1">
                                <rect class="netshape" width="50" height="50" x="100" y="0"/>
                                <rect class="netshape" width="50" height="50" x="50" y="50"/>
                                <rect class="netshape" width="50" height="50" x="100" y="50"/>
                                <rect class="netshape" width="50" height="50" x="0" y="100"/>
                                <rect class="netshape" width="50" height="50" x="50" y="100"/>
                                <rect class="netshape" width="50" height="50" x="50" y="150"/>
                            </g>
                        </svg>
                    </div>
                </div>
                <h3>Interactive Grid</h3>
                <ul class="ul-short">
                    <li>Use one of the <b>color tools</b> to place/remove a color on the <b>face colors
                        grid</b> or on the gray <b>net shapes</b>.</li>
                    <li>Select the <b>symbols</b> to try to form one of the net shapes on the symbol grid.</li>
                    <li><em>Shift-click</em> a <b>net shape</b> or use the buttons to rotate clockwise,
                        <em>Ctrl-click</em> for counter-clockwise.</li>
                    <li><em>Double-click</em> a <b>net shape</b> or use the buttons to flip horizontally.</li>
                    <li><b>Selected symbols</b> will become <b>stamps</b> on the next page.</li>
                </ul>
            </div>
            <div class="page-footer relative-footer">Page 2 of 3</div>
        </div>
        <div class="page page-bg-05">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Walking Cube</span>
            </div>
            <div class="page-content">
                <div class="hstack wrap">
                    <div class="vstack">
                        <div class="net-rot-box hstack"></div>
                        <h3>Stamps</h3>
                        <table class="wc-table"></table>
                        <div style="height: 5mm"></div>
                        <div class="tools hstack"></div>
                        <div style="height: 8mm"></div>
                    </div>
                    <div class="vstack leftpad2 gridstack" style="width: 70mm">
                        <h3 class="lWalkpath leftpad">Walking Path</h3>
                        <div class="gridholder"><div class="symbolboard"></div></div>
                        <div class="vstack colors" style="margin-top: 10px">
                            <div class="colorrow hstack r1"></div>
                            <div class="colorrow hstack r2"></div>
                        </div>
                        <div class="vstack" style="width: 80mm"><div class="saves buttons">
                            <button class="save">Save</button>
                        </div></div>
                        <div class="hstack wrap">
                            <button class="reset-saves">Reset Saves</button>
                            <button class="reset-board">Reset Grid</button>
                            <button class="reset-all">Reset All</button>
                        </div>
                    </div>
                </div>
                <h3>Interactive Net</h3>
                <ul class="ul-short">
                    <li>Note: <b>symbol stamps</b> are horizontally flipped on this page because
                        they are stamped on the <em>module surface</em> in this mirrored orientation compared
                        to how they would look <em>on a cube.</em></li>
                    <li>Select one of the <b>tools</b> or <b>symbol stamps</b>, then
                        click on the walking path net to use that tool or stamp.</li>
                    <li>Use one of the <b>symbol stamps</b> to place/remove a symbol.</li>
                    <li>Use the <b>Net Rotation</b> buttons to rotate the net of symbol stamps.</li>
                    <li>Use one of the <b>color tools</b> to place/remove a color on the
                        <b>walking path</b>.</li>
                    <li><b>Shift-click</b> a walking path square or use the <b>Rotate</b> tool to
                        rotate clockwise, <b>Ctrl-click</b> for counter-clockwise.</li>
                    <li>Use the <b>Net</b> tool to mark/unmark a square as part of the walking path
                        <em>in the order the cube walks</em> onto each.</li>
                    <li>Drag using the <b>Net</b> or <b>color tools</b> to mark/unmark several squares.</li>
                    <li>You can save the current state of the walking path, reset the squares, reset all saves,
                        or reset everything using the buttons below the walking path.</li>
                </ul>
            </div>
            <div class="page-footer relative-footer">Page 3 of 3</div>
        </div>
    </div>
</body>
</html>