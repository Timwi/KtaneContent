<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>The Neutral Button — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        #closed {
            visibility: hidden;
        }

        svg.closed #closed {
            visibility: visible;
        }

        svg.closed #open {
            visibility: hidden;
        }
    </style>
</head>

<body>
    <div class="section">
        <div class="page page-bg-05">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">The Neutral Button</span>
            </div>
            <div class="page-content">
                <svg class="diagram" id="face" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 348 348">
                    <path stroke="#000" stroke-width="2" d="M5.08 5.78h336.91v337.67H5.08z" />
                    <path id="status-light" stroke="#000" stroke-width="2"
                        d="M282.73 40.55c0-8.37 6.97-15.16 15.56-15.16 4.13 0 8.09 1.6 11 4.44a14.97 14.97 0 0 1 4.56 10.72c0 8.38-6.96 15.17-15.56 15.17-8.59 0-15.56-6.8-15.56-15.17z" />
                    <circle cx="173.535" cy="174.615" r="120" fill="#ffcc4d" stroke="#000" stroke-width="4" />
                    <path d="M129.662 220.78h89.076" fill="#664500" stroke="#664500" stroke-width="17.231"
                        stroke-linecap="round" />
                    <g id="open">
                        <ellipse cx="217.143" cy="164.027" rx="15.608" ry="23.412" fill="#664500" />
                        <ellipse cx="130.143" cy="164.027" rx="15.608" ry="23.412" fill="#664500" />
                    </g>
                    <g id="closed">
                        <path d="M110.349 164.027h39.589" fill="#664500" stroke="#664500" stroke-width="11.487"
                            stroke-linecap="round" />
                        <path d="M197.349 164.027h39.589" fill="#664500" stroke="#664500" stroke-width="11.487"
                            stroke-linecap="round" />
                    </g>
                </svg>
                <h2>On the Subject of The Neutral Button</h2>
                <p class="flavour-text" id="flavour-text">Blink and you’ll miss it.</p>
                <p>The neutral face on the button will blink. Press the button within half a second of it blinking to
                    solve the module. Pressing it any other time will incur a strike.</p>

                <p id="count"></p>
            </div>
            <div class="page-footer relative-footer">Page 1 of 1</div>
        </div>
    </div>
    <script>
        let face = document.getElementById("face");
        let sl = document.getElementById("status-light");
        let blinksCount = window.localStorage.getItem("neutralLowScore") ?? 0;
        let hitCount = window.localStorage.getItem("neutralHighScore") ?? 0;
        let correct = false;
        updateVisuals();

        face.onclick = () => {
            if (!correct) {
                sl.style.fill = "#f00";
                blinksCount++;
            }
            else {
                sl.style.fill = "#0f0";
                blinksCount--;
                hitCount++;
            }
            updateVisuals();
            window.setTimeout(() => { sl.style.fill = "#fff" }, 1000);
        };

        function blink() {
            correct = true;
            face.classList.add("closed");
            window.setTimeout(unblink, 150);
            window.setTimeout(() => { correct = false; }, 500);
        }
        function unblink() {
            face.classList.remove("closed");
            window.setTimeout(blink, Math.random() * 10000 + 5000);
            blinksCount++;
            updateVisuals();
        }

        function updateVisuals() {
            if (blinksCount == 0 && hitCount == 0)
                return;

            document.getElementById("flavour-text").innerHTML = `You’ve missed it ${blinksCount} time${blinksCount == 1 ? "" : "s"}.${hitCount == 0 ? "" : ` You’ve gotten it ${hitCount} time${hitCount == 1 ? "" : "s"}.`}`;
            window.localStorage.setItem("neutralHighScore", hitCount)
            window.localStorage.setItem("neutralLowScore", blinksCount);
        }

        window.setTimeout(blink, 20000);
    </script>
</body>

</html>