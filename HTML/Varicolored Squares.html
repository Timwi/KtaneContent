<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Varicolored Squares — Keep Talking and Nobody Explodes Module</title>
    <meta name="viewport" content="initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/highlighter.js"></script>
    <script src="js/ruleseed.js"></script>
    <script>
        var rules = [];

        function setRules(rnd) {
            var candidates = ["B", "R", "Y", "G", "M"];
            var names = ["Red", "Blue", "Green", "Yellow", "Magenta"];
            var positions = [0, 1, 2, 3, 4];

            // Add more random spread
            for (var i = 0; i < 13; i++) {
                rnd.nextInt();
            }

            for (var i = 0; i < 5; i++) {
                var j = 0;
                rnd.shuffleFisherYates(candidates);
                rules[i] = `<svg class="pentagon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 230.4464"><path fill="none" stroke="#000" stroke-dasharray="3.2391 3.2391" stroke-width="1.0797" d="M120.1428 22.4035l97.4535 70.7399-36.959 114.8992H59.594L22.4038 93.1435z" /><path fill="none" stroke="#000" stroke-dasharray="3.2391 3.2391" stroke-width=".5399" d="M120.1434 21.7156l-60.5489 185.639L217.5968 92.4556H22.4043l158.2335 114.8992-60.4944-185.6391" /><g fill="#fff" stroke="#000" stroke-width="1.6196" transform="rotate(-30 -17.8273 -4.7768)"><circle cx="88.0682" cy="87.7471" r="21.5942" /><circle cx="137.0954" cy="197.7363" r="21.5942" /><circle cx="47.6383" cy="278.7625" r="21.5942" /><circle cx="-57.1883" cy="218.2408" r="21.5942" /><circle cx="-31.9463" cy="100.1401" r="21.5942" /></g><g stroke-width=".2857" font-family="sans-serif" font-size="11.4269" font-weight="400" letter-spacing="0" text-anchor="middle" word-spacing="0"><text style="line-height:1.25;text-align:center" x="120.1429" y="41.9267" transform="translate(0 -9.5536)"><tspan x="120.1429" y="41.9267" font-size="27.4246">${candidates[j++]}</tspan></text><text style="line-height:1.25;text-align:center" x="217.5962" y="112.6665" transform="translate(0 -9.5536)"><tspan x="217.5962" y="112.6665" font-size="27.4246">${candidates[j++]}</tspan></text><text style="line-height:1.25;text-align:center" x="180.6372" y="227.5658" transform="translate(0 -9.5536)"><tspan x="180.6372" y="227.5658" font-size="27.4246">${candidates[j++]}</tspan></text><text style="line-height:1.25;text-align:center" x="59.5939" y="227.5658" transform="translate(0 -9.5536)"><tspan x="59.5939" y="227.5658" font-size="27.4246">${candidates[j++]}</tspan></text><text style="line-height:1.25;text-align:center" x="21.8346" y="112.6666" transform="translate(0 -9.5536)"><tspan x="21.8346" y="112.6666" font-size="27.4246">${candidates[j++]}</tspan></text></g></svg>`;
             }

            // Random spread
            rnd.nextInt();
            rnd.nextInt();
            rnd.nextInt();

            var directionRules = document.getElementsByClassName('direction-rule');
            for (var i = 0; i < 2; i++) {
                directionRules[i].innerText = rnd.nextMax(2) == 0 ? "counter-clockwise" : "clockwise";
            }

            var pentagonLabels = document.getElementsByClassName('pentagonLabel');
            var pentagonHolders = document.getElementsByClassName('pentagonHolder');
            rnd.shuffleFisherYates(positions);
            for (var i = 0; i < 5; i++) {
                pentagonLabels[i].innerText = names[positions[i]];
                pentagonHolders[i].innerHTML = rules[positions[i]];
            }
        }

        function setDefaultRules(rnd) {
            setRules(rnd);
        }
    </script>
    <style>
        .note {
            font-style: italic;
            text-align: center;
        }

        .pentagon {
            width: 240px;
            margin: 0 auto;
            display: block;
        }

        table {
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-04">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Varicolored Squares</span>
            </div>
            <div class="page-content">
                <img class="diagram" src="img/Component/Varicolored Squares.svg">
                <h2>On the Subject of Varicolored Squares</h2>
                <p class="flavour-text">Conformity is key. Patterns encourage conformity. Find the pattern, and conformity will naturally arise.</p>

                <ul>
                    <li>Pressing a square will cause it to flash white and may cause other squares to change color. Make all squares have the same color to disarm the module.</li>
                    <li>Pressing any square of the valid color will progress the module by causing all squares connected to the square pressed first which match its color to change to the pressed color. If this does not increase in size after three presses, the color of the pressed square will change.</li>
                    <li>To begin, press a square of the color ocurring 4 times. If the remaining colors aren’t in 4 groups of 3, you are looking at a different module.</li>
                    <li>Then use Table A to determine the next valid color.</li>
                    <li>Pressing an incorrect square will result in a strike and reset the module.</li>
                </ul>

                <h3>Table A</h3>
                <p>Consider the list of distinct colors adjacent to the flashing square and use the table below. Note that “adjacent” squares are the squares immediately above, below, left, and right of a given square.</p>
                <table>
                    <tr>
                        <th>Colors</th>
                        <th>Rule</th>
                    </tr>
                    <tr><th>1</th><td>The next valid color is the color which is <span class="direction-rule">counter-clockwise</span> from the adjacent color in the correct pentagon in Table B.</td></tr>
                    <tr><th rowspan="2">2</th><td>If the two colors are adjacent in the correct pentagon in Table B, the next valid color is the color which is opposite those two colors.</td></tr>
                    <tr><td>Otherwise, the next valid color is the color which is between those two colors.</td></tr>
                    <tr><th rowspan="2">3</th><td>If the three colors are adjacent in the correct pentagon in Table B, the next valid color is the color which is opposite the two colors not present.</td></tr>
                    <tr><td>Otherwise, the next valid color is the color which is between the two colors not present.</td></tr>
                    <tr><th>4</th><td>The next valid color is the color which is not present.</td></tr>
                    <tr><td class="note" colspan="2">Note: if, at any point, the valid color is the same as the color pressed previously or no squares are present of the valid color, the valid color changes to the color <span class="direction-rule">clockwise</span> from the valid color in the correct pentagon in Table B.</td></tr>
                </table>

            </div>
            <div class="page-footer relative-footer">Page 1 of 2</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Varicolored Squares</span>
            </div>
            <div class="page-content">
                <h3>Table B</h3>
                <p>Consider the color of the flashing square and use the table below. Each letter refers to the color starting with that letter.</p>
                <table>
                    <tr>
                        <th class="pentagonLabel">Red</th>
                        <th class="pentagonLabel">Blue</th>
                    </tr>
                    <tr>
                        <td class="pentagonHolder"></td>
                        <td class="pentagonHolder"></td>
                    </tr>
                    <tr>
                        <th class="pentagonLabel">Green</th>
                        <th class="pentagonLabel">Yellow</th>
                    </tr>
                    <tr>
                        <td class="pentagonHolder"></td>
                        <td class="pentagonHolder"></td>
                    </tr>
                    <tr>
                        <th class="pentagonLabel" colspan="2">Magenta</th>
                    </tr>
                    <tr>
                        <td class="pentagonHolder" colspan="2"></td>
                    </tr>
                </table>

            </div>
            <div class="page-footer relative-footer">Page 2 of 2</div>
        </div>
    </div>
</body>
</html>