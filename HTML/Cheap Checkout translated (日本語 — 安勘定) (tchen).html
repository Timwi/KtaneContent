<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>安勘定 — Keep Talking and Nobody Explodes Mod</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/Modules/Cheap Checkout.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/ruleseed.js"></script>
    <script>
        let Prices = [
            // Original 34 items
            "Candy Canes,3.51,菓子類",
            "Socks,6.97,その他",
            "Lotion,7.97,日用品",
            "Cheese,4.49,乳製品",
            "Mints,6.39,菓子類",
            "Grape Jelly,2.98,菓子類",
            "Honey,8.25,菓子類",
            "Sugar,2.08,菓子類",
            "Soda,2.05,菓子類",
            "Tissues,3.94,日用品",
            "White Bread,2.43,主食",
            "Canola Oil,2.28,オイル",
            "Mustard,2.36,その他",
            "Deodorant,3.97,日用品",
            "White Milk,3.62,乳製品",
            "Pasta Sauce,2.30,野菜",
            "Lollipops,2.61,菓子類",
            "Cookies,2.00,菓子類",
            "Paper Towels,9.46,日用品",
            "Tea,2.35,飲み物",
            "Coffee Beans,7.85,その他",
            "Mayonnaise,3.99,オイル",
            "Chocolate Milk,5.68,乳製品",
            "Fruit Punch,2.08,菓子類",
            "Potato Chips,3.25,オイル",
            "Shampoo,4.98,日用品",
            "Toothpaste,2.50,日用品",
            "Peanut Butter,5.00,肉・豆類",
            "Gum,1.12,菓子類",
            "Water Bottles,9.37,飲み物",
            "Spaghetti,2.92,主食",
            "Chocolate Bar,2.10,菓子類",
            "Ketchup,3.59,その他",
            "Cereal,4.19,主食",

            // New rule seed items
            "Eggs,2.67,肉・豆類",
            "Baked Beans,1.14,肉・豆類",
            "Peanuts,5.98,肉・豆類",
            "Yogurt,2.72,乳製品",
            "Greek Yogurt,3.47,乳製品",
            "Butter,5.86,乳製品",
            "Toothbrush,2.24,日用品",
            "Medicine,3.73,日用品",
            "Soup,1.99,その他",
            "Soap,3.97,日用品",
            "Pretzels,2.98,主食",
            "Popcorn,2.50,主食",
            "Oatmeal,7.98,主食",
            "Rice,2.02,主食",
            "Flour,3.49,主食",
            "Licorice,1.98,菓子類",
            "Pie,3.98,菓子類",
            "Cake,9.98,菓子類",
            "Gummy Bears,7.98,菓子類",
            "Relish,2.74,野菜",
            "Napkins,1.09,日用品",
            "Band-Aids,1.11,日用品",
            "Playing Cards,2.13,その他",
            "Beef Jerky,1.23,その他",
            "Ice Cream,4.99,乳製品",
            "Salad Mix,2.47,野菜",
            "Bagel,4.20,主食",
            "野菜 オイル,2.89,オイル",
            "Batteries,4.49,その他",
            "Taco Shells,5.01,主食",
            "Bleach,6.90,その他",
            "Baking Soda,0.33,その他",
            "Paper Bags,1.07,その他",
            "Printer Paper,4.49,その他",
            "Diapers,6.96,日用品",
            "Shower Gel,1.63,日用品",
            "Makeup Remover,1.02,日用品",
            "Blank DVDs,9.00,その他",
            "Nail Polish,3.13,日用品",
            "Fusilli,2.92,主食",
            "Tagliatelle,2.92,主食",
            "Spirelli,2.92,主食",
            "Penne,2.92,主食",
            "Car Engine オイル,3.36,オイル",
            "Parsley,0.69,調味料",
            "Sage,1.75,調味料",
            "Rosemary,3.19,調味料",
            "Thyme,2.89,調味料",
            "White Pepper,2.49,調味料",
            "Coriander,0.99,調味料",
            "Oregano,1.59,調味料",
            "Cumin,3.45,調味料",
            "Masala,4.99,調味料",
            "Saffron,12.79,調味料",
            "Cinnamon,2.40,調味料",
            "Cayenne Pepper,11.27,調味料",
            "Ginger Root,1.00,調味料",
            "Salt,3.98,調味料",
            "Sesame,3.19,調味料",
            "Vanilla Extract,11.82,調味料",
            "Red Wine,20.90,飲み物",
            "White Wine,18.60,飲み物",
            "12-pack Beer,10.49,飲み物",
            "6-pack Beer,5.79,飲み物",
            "Vinegar,2.50,その他",
        ];

        let PricesLB = [
            // Original 12 weight based items
            "Turkey,2.98,肉・豆類",
            "Chicken,1.99,肉・豆類",
            "Steak,4.97,肉・豆類",
            "Pork,4.14,肉・豆類",
            "Lettuce,1.10,野菜",
            "Potatoes,0.68,野菜",
            "Tomatoes,1.80,果物",
            "Broccoli,1.39,野菜",
            "Oranges,0.80,果物",
            "Lemons,1.74,果物",
            "Bananas,0.87,果物",
            "Grapefruit,1.08,果物",

            // New rule seed weight based items
            "Onions,1.82,野菜",
            "Bacon,5.52,肉・豆類",
            "Apples,1.32,果物",
            "Grapes,2.98,果物",
            "Fish,9.99,肉・豆類",
            "飲み物melons,0.32,果物",
            "Carrots,0.77,野菜",
            "Cherries,3.21,果物",
            "Plums,1.99,果物",
            "Pumpkins,1.38,果物",
            "Avocados,2.23,果物",
            "Ham,2.88,肉・豆類",
            "Sausages,3.88,肉・豆類",
            "Corn,1.14,野菜",
            "Pears,1.74,果物",
            "Leek,3.17,野菜",
            "Bologna,1.69,肉・豆類",
            "Minced Beef,2.36,肉・豆類",
            "Garlic,0.97,野菜",
            "Tofu,3.11,肉・豆類",
            "Salmon,21.55,肉・豆類",
        ];

        let SundayValue = 215;
        let MondayPercent = 85;
        let TuesdayExcludedDigit = -1;
        let WednesdayLargeOrSmall = true;
        let WednesdayViceVersa = true;
        let ThursdayOddItems = true;
        let ThursdayPercent = 50;
        let FridayPercent = 125;
        let SaturdayPercent = 65;

        function toDollars(intDollars) {
            const stringDollars = intDollars.toString();
            if (intDollars < 100) return "0." + intDollars;
            else return stringDollars.substring(0, stringDollars.length - 2) + "." + stringDollars.substring(stringDollars.length - 2);
        }

        function toRelativePercent(absolutePercent) {
            if (absolutePercent > 100) return `${absolutePercent - 100}%増加する`;
            else if (absolutePercent == 50) return "半額になる";
            else return `${100 - absolutePercent}%オフになる`;
        }

        function setDefaultRules(rng) {
            setRules(rng);
        }

        function setRules(rng) {
            var prices, pricesLB;
            if (rng.seed == 1)
            {
                prices = Prices.slice(0, 34);
                pricesLB = PricesLB.slice(0, 12);
            }
            else
            {
                prices = rng.shuffleFisherYates(Prices.slice(0)).slice(0, 34);
                pricesLB = rng.shuffleFisherYates(PricesLB.slice(0)).slice(0, 12);

                for (var [index, item] of prices.entries()) {
                    var split = item.split(",");
                    var intDollars = parseInt(split[1].replace(".", ""));
                    intDollars += rng.next(-10, 11);
                    split[1] = toDollars(intDollars);
                    prices[index] = split.join(",");
                }

                for (var [index, item] of pricesLB.entries()) {
                    var split = item.split(",");
                    var intDollars = parseInt(split[1].replace(".", ""));
                    intDollars += rng.next(-10, 11);
                    split[1] = toDollars(intDollars);
                    pricesLB[index] = split.join(",");
                }

                SundayValue = rng.next(50, 301);
                MondayPercent = rng.next(10, 100);
                TuesdayExcludedDigit = rng.next(-1, 3);
                WednesdayLargeOrSmall = rng.next(0, 2) == 1;
                WednesdayViceVersa = rng.next(0, 2) == 1;
                ThursdayOddItems = rng.next(0, 2) == 1;
                ThursdayPercent = rng.next(25, 76);
                FridayPercent = rng.next(50, 201);
                SaturdayPercent = rng.next(50, 201);
            }

            const seededStrings = [
                toDollars(SundayValue),
                toRelativePercent(MondayPercent),
                TuesdayExcludedDigit == -1 ? "" : `${["一", "十", "百"][TuesdayExcludedDigit]}の位の数字を取り除き、`,
                WednesdayLargeOrSmall ? "最大" : "最小",
                WednesdayLargeOrSmall ? "最小" : "最大",
                WednesdayViceVersa ? "と交換する" : "で置き換える",
                ThursdayOddItems ? "奇数" : "偶数",
                toRelativePercent(ThursdayPercent),
                toRelativePercent(FridayPercent),
                toRelativePercent(SaturdayPercent)
            ];

            const seededSpans = document.querySelectorAll("span.rule-seeded");
            for (const [index, seededSpan] of seededSpans.entries()) {
                seededSpan.textContent = seededStrings[index];
            }

            const rows = Array.from(document.querySelectorAll(".page-bg-02 tr:nth-child(n+2), .page-bg-03 tr"));
            for (const [index, itemString] of prices.concat(pricesLB).sort().entries()) {
                const children = rows[index % rows.length].children;
                const item = itemString.split(",");

                children[0].textContent = item[0];
                children[1].textContent = `${pricesLB.includes(itemString) ? "1lbあたり " : "" }$${item[1]}`;
                children[2].textContent = item[2];
            }
        }
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">安勘定</span>
            </div>
            <div class="page-content">
                <img class="diagram" src="img/Component/Cheap Checkout.svg">
                <h2>モジュール詳細：安勘定</h2>
                <p class="flavour-text">こんなもの買うやつがどこにいるんだ？</p>
                <ul>
                    <li>客の買い物リストが表示される。これは矢印ボタンを押して確認することができる。</li>
                    <li>その上に客の支払い金額が表示される。</li>
                    <li>商品の金額を合計して、全て購入するために必要な金額を計算する。ただし、曜日ごとに異なるセールを適用した金額を利用する。</li>
                    <li>量り売りしている商品については、量によって決定した金額を計算し、セールを適用する。</li>
                    <li>客が十分な支払いを行なっている場合、モジュールのボタンを利用して正しいお釣りの値を入力し、「Submit」を押す。</li>
                    <li>客が十分な支払いを行なっていない場合、お釣りの金額を入力せずに「Submit」を押して金額が不足していることを伝える。新しく支払われる金額が表示されるまで待ち、その金額に対するお釣りを計算する。</li>
                    <li>「Submit」を押すとそれまでの入力は消去される。</li>
                </ul>
                <h3>用語集</h3>
                <ul>
                    <li>商品価格は、セールが適用される前の金額を示す。</li>
                    <li>価格が固定されている商品とは、重さによって金額が変化しない商品を示す。</li>
                    <li>数字根とは、全ての桁の数字を合計する計算を、結果が一桁になるまで繰り返すことを示す。</li>
                    <li>四捨五入とは、指定された桁の次の桁の値が5以上である場合繰り上げをし、そうでない場合繰り下げを行う端数処理を示す。</li>
                </ul>

                <h3>セール:</h3>
                <div style="font-style: italic; font-size: 13px">曜日は、モジュールが起動した時の処理担当者のPCに設定された時間によって決定する。</div>

                <em>日曜特別セール</em>
                <div class="sale">価格が固定されていて、商品名にSが含まれる商品の価格は、$<span class="rule-seeded">2.15</span>増加する。</div>

                <em>月曜感謝セール</em>
                <div class="sale">1つ目、3つ目、6つ目の商品価格は<span class="rule-seeded">15%オフになる</span>。</div>

                <em>火曜お祭りセール</em>
                <div class="sale"><span class="rule-seeded"></span>価格から小数点を取り除いたの数字の数字根を計算し、xとする。商品価格にxドル追加する。これは価格が固定されている商品のみに適用する。</div>

                <em>水曜怪奇セール</em>
                <div class="sale"><span class="rule-seeded">最大</span>の数字の桁を<span class="rule-seeded">最小</span>の数字の桁<span class="rule-seeded">と交換する</span>。</div>

                <em>木曜わくわくセール</em>
                <div class="sale">買い物リストにおいて<span class="rule-seeded">奇数</span>番目の商品全ては<span class="rule-seeded">半額になる</span>。</div>

                <em>金曜フルーツセール</em>
                <div class="sale">全ての果物の商品は、1ポンドあたりの価格が<span class="rule-seeded">25%増加する</span>。</div>

                <em>土曜スイーツセール</em>
                <div class="sale">全ての菓子類の商品は、価格が<span class="rule-seeded">35%オフになる</span>。</div>
            </div>
            <div class="page-footer relative-footer">ページ 1/3</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">安勘定</span>
            </div>
            <div class="page-content">
                <h3>商品価格:</h3>
                <div style="font-style: italic; font-size: 14px">価格は全てドルの単位で計算する。例えば、$0.68は68セントとして扱わない。全ての価格は四捨五入して小数第二位まで求める。商品価格の決定、及びセールの適用を行うごとに四捨五入を行わなければならない。</div>
                <div class="hstack">
                    <table>
                        <tr><th>商品</th><th>価格</th><th>カテゴリ</th></tr>
                        <tr><td>Bananas</td><td>1lbあたり $0.87</td><td>果物</td></tr>
                        <tr><td>Broccoli</td><td>1lbあたり $1.39</td><td>野菜</td></tr>
                        <tr><td>Candy Canes</td><td>$3.51</td><td>菓子類</td></tr>
                        <tr><td>Canola オイル</td><td>$2.28</td><td>オイル</td></tr>
                        <tr><td>Cereal</td><td>$4.19</td><td>主食</td></tr>
                        <tr><td>Cheese</td><td>$4.49</td><td>乳製品</td></tr>
                        <tr><td>Chicken</td><td>1lbあたり $1.99</td><td>肉・豆類</td></tr>
                        <tr><td>Chocolate Bar</td><td>$2.10</td><td>菓子類</td></tr>
                        <tr><td>Chocolate Milk</td><td>$5.68</td><td>乳製品</td></tr>
                        <tr><td>Coffee Beans</td><td>$7.85</td><td>その他</td></tr>
                        <tr><td>Cookies</td><td>$2.00</td><td>菓子類</td></tr>
                        <tr><td>Deodorant</td><td>$3.97</td><td>日用品</td></tr>
                        <tr><td>Fruit Punch</td><td>$2.08</td><td>菓子類</td></tr>
                        <tr><td>Grape Jelly</td><td>$2.98</td><td>菓子類</td></tr>
                        <tr><td>Grapefruit</td><td>1lbあたり $1.08</td><td>果物</td></tr>
                        <tr><td>Gum</td><td>$1.12</td><td>菓子類</td></tr>
                        <tr><td>Honey</td><td>$8.25</td><td>菓子類</td></tr>
                    </table>
                    <table>
                        <tr><th>商品</th><th>価格</th><th>カテゴリ</th></tr>
                        <tr><td>Mints</td><td>$6.39</td><td>菓子類</td></tr>
                        <tr><td>Mustard</td><td>$2.36</td><td>その他</td></tr>
                        <tr><td>Oranges</td><td>1lbあたり $0.80</td><td>果物</td></tr>
                        <tr><td>Paper Towels</td><td>$9.46</td><td>日用品</td></tr>
                        <tr><td>Pasta Sauce</td><td>$2.30</td><td>野菜</td></tr>
                        <tr><td>Peanut Butter</td><td>$5.00</td><td>肉・豆類</td></tr>
                        <tr><td>Pork</td><td>1lbあたり $4.14</td><td>肉・豆類</td></tr>
                        <tr><td>Potato Chips</td><td>$3.25</td><td>オイル</td></tr>
                        <tr><td>Potatoes</td><td>1lbあたり $0.68</td><td>野菜</td></tr>
                        <tr><td>Shampoo</td><td>$4.98</td><td>日用品</td></tr>
                        <tr><td>Socks</td><td>$6.97</td><td>その他</td></tr>
                        <tr><td>Soda</td><td>$2.05</td><td>菓子類</td></tr>
                        <tr><td>Spaghetti</td><td>$2.92</td><td>主食</td></tr>
                        <tr><td>Steak</td><td>1lbあたり $4.97</td><td>肉・豆類</td></tr>
                        <tr><td>Sugar</td><td>$2.08</td><td>菓子類</td></tr>
                        <tr><td>Tea</td><td>$2.35</td><td>飲み物</td></tr>
                        <tr><td>Tissues</td><td>$3.94</td><td>日用品</td></tr>
                    </table>
                </div>
            </div>
            <div class="page-footer relative-footer">ページ 2/3</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">安勘定</span>
            </div>
            <div class="page-content">
                <div class="hstack">
                    <table>
                        <tr><td>Ketchup</td><td>$3.59</td><td>その他</td></tr>
                        <tr><td>Lemons</td><td>1lbあたり $1.74</td><td>果物</td></tr>
                        <tr><td>Lettuce</td><td>1lbあたり $1.10</td><td>野菜</td></tr>
                        <tr><td>Lollipops</td><td>$2.61</td><td>菓子類</td></tr>
                        <tr><td>Lotion</td><td>$7.97</td><td>日用品</td></tr>
                        <tr><td>Mayonnaise</td><td>$3.99</td><td>オイル</td></tr>
                    </table>
                    <table>
                        <tr><td>Tomatoes</td><td>1lbあたり $1.80</td><td>果物</td></tr>
                        <tr><td>Toothpaste</td><td>$2.50</td><td>日用品</td></tr>
                        <tr><td>Turkey</td><td>1lbあたり $2.98</td><td>肉・豆類</td></tr>
                        <tr><td>飲み物 Bottles</td><td>$9.37</td><td>飲み物</td></tr>
                        <tr><td>White Bread</td><td>$2.43</td><td>主食</td></tr>
                        <tr><td>White Milk</td><td>$3.62</td><td>乳製品</td></tr>
                    </table>
                </div>
            </div>
            <div class="page-footer relative-footer">ページ 3/3</div>
        </div>
    </div>
</body>
</html>
