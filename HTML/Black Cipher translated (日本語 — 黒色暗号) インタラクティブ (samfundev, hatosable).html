<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>黒色暗号 — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/font-japanese.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        .dark table, table {
            margin: 1em auto;
            border: none;
        }
        .strip-change-one td,
        .strip-change-one th {
            padding: .3em .5em .2em;
        }
        .alpha {
            font-size: 13px;
        }
        .beta {
            font-size: 11px;
        }
        .tablea {
            font-size: 14px;
        }
        .tableb {
            font-size: 20px;
            width: 100%;
        }
        .rotor {
            font-size: 13px;
            width: 100%;        
        }
        .reflector {
            font-size: 13px;
            width: 100%;
        }
    </style>
    <style>
        /* Interactive */
        #interactive {
            font-size: 12.5px;
            font-family: 'Special Elite';
        }

        #interactive td.borderless:first-child {
            padding: .3em;
        }

        button {
            background-color: white;
            color: black;
            padding: 1px 3px;
            border-radius: 5px;
            border: black 2px solid;
            transition: 0.3s;
        }

        button:hover {
            background-color: black;
            color: white;
        }
    </style>
    <script src="js/jquery.3.7.0.min.js"></script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Ultimate Cipher.svg" class="diagram">
                <h2>モジュール詳細：黒色暗号</h2>
                <p class="flavour-text">世界が生まれた暗黒のように、この暗号はあなたを終わらせるだろう。</p>
                <p>モジュールは、3つのディスプレー、キーボード、英字が書かれた2つのボタン、及び現在のページを表示するボタン(送信ボタン)で構成されている。</p>
                <p>右の英字を押すと、次のページに移動できる。左の英字を押すと前のページに移動できる。ページは全部で2ページある。</p>
                <p>1ページ目には、上のディスプレーに6文字の暗号化された単語、真ん中のディスプレーにある単語が表示される。</p>
            <p>2ページ目には、上のディスプレーには3つのローマ数字、真ん中のディスプレーには3つの英字、下のディスプレーには英字のペアが表示される。</p>

        <h3>ステップ1：ディグラフィド暗号(亜種)</h3>
        <p>ここでは、上の暗号化された単語と1ページ目の真ん中と下のディスプレーに表示された単語、2つのボタンにある英字が必要となる。</p>
        <p>真ん中と下のディスプレーは、2つのキーを作るために使用される。</p>
        <p>真ん中のディスプレーの単語を使用して、重複する英字の2文字目以降を削除する。それから、アルファベット全体の文字列を取得し、この単語に表示された英字を削除する。</p>
        <p>シリアルナンバーの最初の英字についてアルファベットにおける位置(A = 1,B = 2...Z = 26)が奇数の場合、単語の末尾にアルファベットを配置する。<br>そうでない場合、単語の先頭にアルファベットを配置する。</p>
        <p>これが、キーAである。</p>
        <p>下のディスプレーの単語を使用して、重複する英字の2文字目以降を削除する。それから、アルファベット全体の文字列を取得し、キーワードに表示された英字を削除する。</p>
        <p>シリアルナンバーの最後の英字についてアルファベットにおける位置(A = 1,B = 2...Z = 26)が偶数の場合、単語の末尾にアルファベットを配置する。<br>そうでない場合、単語の先頭にアルファベットを配置する。</p>
        <p>これが、キーBである。</p>
        <p>ページ番号/送信ボタンの上にある左のボタンに書かれた文字は、「#」に置き換えられ、その英字はキーAの末尾に追加される。これを右のボタンとキーBに対しても行う。</p>
        <p>キーAとキーBを、左から右、上から下に9文字ごとに3つの段に分ける。</p>
    </div>
            <div class="page-footer relative-footer">ページ 1/6</div>
        </div>

        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
             <p>最後に、1~9の数字文字列の真上にキーAを配置し、その横に読み順で1~9の順番になるように3×3の正方形型の数字文字列を配置する。それから、キーAがある数字文字列の真下にキーBを配置し、その横に上から下、左から右に1~9の順番になるように3×3の正方形型の数字文字列を配置する。</p>
             <h4 class="centered">例</h4>
             <p class="centered">
              真ん中のディスプレー：COMBO<br>
              下のディスプレー：REFUND<br>
              シリアルナンバー：S73BW0<br>
              左のボタン：S<br>
              右のボタン：A<br>
             キーA：COMBADEFGHIJKLNPQR#TUVWXYZS<br>
             キーB：#BCGHIJKLMOPQSTVWXYZREFUNDA
             </p>
        <table>
        <tbody>
        <tr><th>C</th><th>O</th><th>M</th><th>B</th><th>A</th><th>D</th><th>E</th><th>F</th><th>G</th><th>1</th><th>2</th><th>3</th></tr>
        <tr><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th><th>N</th><th>P</th><th>Q</th><th>R</th><th>4</th><th>5</th><th>6</th></tr>
        <tr><th>#</th><th>T</th><th>U</th><th>V</th><th>W</th><th>X</th><th>Y</th><th>Z</th><th>S</th><th>7</th><th>8</th><th>9</th></tr>
        <tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>-</th><th>-</th><th>-</th></tr>
        <tr><th>#</th><th>B</th><th>C</th><th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th><th>1</th><th>4</th><th>7</th></tr>
    <tr><th>M</th><th>O</th><th>P</th><th>Q</th><th>S</th><th>T</th><th>V</th><th>W</th><th>X</th><th>2</th><th>5</th><th>8</th></tr>
    <tr><th>Y</th><th>Z</th><th>R</th><th>E</th><th>F</th><th>U</th><th>N</th><th>D</th><th>A</th><th>3</th><th>6</th><th>9</th></tr>
    </tbody>
        </table>
        <p>暗号化された単語を3組の英字のペアに分割する。各ペアに対して以下の指示に従う。</p>
        <ul>
        <li>1：キーAから一つ目の英字を見つける。</li>
        <li>2：キーBから二つ目の英字を見つける。</li>
        <li>3：一つ目の英字の列から、一つ目の数字を取得する。</li>
        <li>4：二つ目の英字の列から、三つ目の数字を取得する。</li>
        <li>5：両方の英字がある段を探し、その段の3×3のグリッドを参照する。両方に含まれている数字が一つだけあり、それが二つ目の数字である。</li>
        <li>6：数字を上から下に、今まで書いた数字の右に記していく。</li>
        </ul>
        <p>これを読み順で読み、新たな3つの数字を取得する。3つの数字の組み合わせに対して以下の指示に従う。</p>
        <ul>
         <li>1：一つ目の数字を列、二つ目の数字を上の段に使用して一つ目の英字を取得する。</li>
         <li>2: 三つ目の数字を列、二つ目の数字を下の段に使用して二つ目の英字を取得する。</li>
         <li><b>注意：</b>上のグリッドは一つ目の英字に対して使用し、下のグリッドは二つ目の英字に対して使用することになる。</li>
         </ul>
    </div>
            <div class="page-footer relative-footer">ページ 2/6</div>
        </div>

        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
             <p>すべて完了したら、新しい暗号化された単語を取得できる。</p>
        <h4 style="text-align:center">例</h4>
        <p style="text-align:center">
         暗号化された単語：LTVDPL<br>
         キー：上記の復号プロセスで使用した表を使用
         </p>
        <p style="text-align:center">
        LT -> 556<br>
        VD -> 498<br>
        PL -> 749<br>
        </p>
        <p style="text-align:center">
        数字を上から下、左から右に並べると、<br>
            547<br>
            594<br>
            689<br>
        これを左から右、上から下に読む。
        </p>
        <p style="text-align:center">
        547 -> LJ<br>
        594 -> WE<br>
        689 -> XX<br>
        新たな暗号化された単語：LJWEXX
        </p>
        <h3>ステップ2：スキュタレー転置</h3>
        <p>ここでは、ステップ1で取得した暗号化された単語が必要となる。</p>
        <p>まず、シリアルナンバーの二番目の文字(A = 10, B = 11, ... Z = 35)を4で割った余りに2を足した数を取得し、必要な段数を求める。それから、上から下、左から右の順に6つのアスタリスクを配置する。</p>
        <h4 style="text-align:center">例</h4>
        <p style="text-align:center">
        段：(7 % 4) + 2 = 5 <br>
        **<br>
        *&nbsp;&nbsp;<br>
        *&nbsp;&nbsp;<br>
        *&nbsp;&nbsp;<br>
        *&nbsp;&nbsp;
        </p>
        <p>暗号化された各文字について、各アスタリスクを読み順でその文字に置き換える。</p>
        <p>最後に、英字を上から下、左から右に読む。</p>
    </div>
            <div class="page-footer relative-footer">ページ 3/6</div>
        </div>

        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
             <p>これで新たな暗号化された単語が得られる。</p>
             <h4 style="text-align:center">例</h4>
             <p style="text-align:center">
              暗号化された単語：LJWEXX<br>
             LJ<br>
             W&nbsp;&nbsp;<br>
             E&nbsp;&nbsp;<br>
             X&nbsp;&nbsp;<br>
             X&nbsp;&nbsp;<br>
             新たな暗号化された単語：LWEXXJ
             </p>
             <h3>ステップ3：エニグマ暗号</h3>
             <p>ここでは、ステップ2で取得した暗号化された単語と、2ページ目の3つすべてのディスプレーが必要となる。</p>
             <p>2ページ目には、ローター/リフレクターの設定、その下にローターの初期設定、一番下にプラグボードの初期設定が表示される。</p>
             <h3>ステップ3A：ローター/リフレクター/プラグボードの設定</h3>
             <p>上のディスプレーは、使用するローター、使用する順番、使用するリフレクターを示している。正しいローター表と正しいリフレクター表を使用しエニグマ復号機を作成する。</p>
             <p>これらは「リフレクター-下部ローター-中央ローター-上部ローター」の順で読む。上部ローターの真上にAからZの文字列を配置し、プラグボードとして使用する。</p>
             <p>下のディスプレーの回路図を用いて、エニグマ復号機を作成する。</p>
             <p>ローターの真下にあるディスプレーには各ローターの英字がどこにあるかを示している。左下の英字がその英字と同じになるようにローターを回転させる。</p>
             <p>プラグボードの初期設定にある各英字のペアごとに、プラグボード上の2つの英字を入れ替える。</p>

        <table id="interactive" class="borderless"></table>
    </div>
            <div class="page-footer relative-footer">ページ 4/6</div>
        </div>

        <div class="page page-bg-05">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
    <h2>Enigma Schematic</h2>
    <p style='text-align: center'><img src="img/Ultimate Cipher/EnigmaScheme.png" style="width: 16cm"></p>
    <p>すべての設定が完了すると、使用準備が整う。はじめにステップ3Bを行い、暗号化された英字の一文字目を復号する。その後、ステップ3Cの通りにローターを回転させる。</p>
    <h3>ステップ3B：エニグマ復号機の使用方法</h3>
        <ul>
        <li>1：単語内の英字を取得し、復号機のプラグボードの段からそれを探す。</li>
        <li>2：真下に上部ローターの上段へ進み、新しい英字を取得する。</li>
        <li>3：上部ローターの下段から、新しい英字を探す。</li>
        <li>4：真下に中央ローターの上段へ進み、新しい英字を取得する。</li>
        <li>5：中央ローターの下段から、新しい英字を探す。</li>
        <li>6：真下に下部ローターの上段へ進み、新しい英字を取得する。</li>
        <li>7：下部ローターの下段から、新しい英字を探す。</li>
        <li>8：真下にリフレクターの上段へ進み、新しい英字を取得する。</li>
        <li>9：リフレクターの下段から、新しい英字を探す。</li>
        <li>10：真上に下部ローターの下段へ進み、新しい英字を取得する。</li>
        <li>11：下部ローターの上段から、新しい英字を探す。</li>
        <li>12：真上に中央ローターの下段へ進み、新しい英字を取得する。</li>
        <li>13：中央ローターの上段から、新しい英字を探す。</li>
        <li>14：真上に上部ローターの下段へ進み、新しい英字を取得する。</li>
        <li>15：上部ローターの上段から、新しい英字を探す。</li>
        <li>16：真上にプラグボードの段へ進み、復号された英字を取得する。</li>
        </ul>
    </div>
            <div class="page-footer relative-footer">ページ 5/6</div>
        </div>

        <div class="page page-bg-06">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">黒色暗号</span>
            </div>
            <div class="page-content">
    <p style='text-align: center'>以下の例はIを使用し、復号後の英字Fを取得している。</p>

        <p style='text-align: center'><img src="img/Ultimate Cipher/DecryptSteps.png" style="width: 16cm"></p>

       <h3>ステップ3C：ローターの回転機構</h3>
        <p>次のセクションではローターの回転がどのように作動するかについて述べている。</p>

        <p>ローターの下段には横にアスタリスクがついている英字が二つあることにお気づきだろうか。ローターの状態によって、以下のように異なる影響がある。</p>
        <ul>
        <li>アスタリスクが中央ローターの左端にある場合、3つすべてのローターを回転させる。</li>
        <li>そうでなければ、アスタリスクが上部ローターの左端にある場合、中央と上部の両方のローターが回転する。</li>
        <li>そうでない場合、上部ローターのみが回転する。</li>
        <li>各回転は1段階だけ左に動かす。(例：A -> B, G -> H, Z -> Aなど)</li>
        </ul>

        <p>ステップ3Bと3Cを単語の各英字に対して繰り返し、復号された単語を取得する。</p>

            <p>復号された単語を取得したら、それを送信する。入力を開始すると、全てのディスプレーが暗転し下のディスプレーに入力された文字が表示される。</p>

        <p>入力を消去するには、いずれかの英字をクリックする。ページが移動し、入力した文字列が消去される。6文字を超える入力はできないようになっている。</p>

        <p>入力に問題がなければ、「SUB」と書かれたボタンを押して、回答を送信する。ミスが記録された場合、モジュールの最初のページに戻るが、暗号の再生成はされない。</p>
          </div>
            <div class="page-footer relative-footer">ページ 6/6</div>
        </div>

        <script>
            const cyclers = {
                "ローターI": [
                    ["E", "K", "M", "F", "L", "G", "D", "Q", "V", "Z", "N", "T", "O", "W", "Y", "H", "X", "U", "S", "P", "A", "I", "B", "R", "C", "J"],
                    ["A", "B", "C", "D*", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q*", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                ],
                "ローターII": [
                    ["A", "J", "D", "K", "S", "I", "R", "U", "X", "B", "L", "H", "W", "T", "M", "C", "Q", "G", "Z", "N", "P", "Y", "F", "V", "O", "E"],
                    ["A", "B", "C", "D", "E*", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R*", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                ],
                "ローターIII": [
                    ["B", "D", "F", "H", "J", "L", "C", "P", "R", "T", "X", "V", "Z", "N", "Y", "E", "I", "W", "G", "A", "K", "M", "U", "S", "Q", "O"],
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I*", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V*", "W", "X", "Y", "Z"],

                ],
                "ローターIV": [
                    ["E", "S", "O", "V", "P", "Z", "J", "A", "Y", "Q", "U", "I", "R", "H", "X", "L", "N", "F", "T", "G", "K", "D", "C", "M", "W", "B"],
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J*", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W*", "X", "Y", "Z"],

                ],
                "ローターV": [
                    ["V", "Z", "B", "R", "G", "I", "T", "Y", "U", "P", "S", "D", "N", "H", "L", "X", "A", "W", "M", "J", "Q", "O", "F", "E", "C", "K"],
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M*", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z*"],

                ],
                "ローターVI": [
                    ["J", "P", "G", "V", "O", "U", "M", "F", "Y", "Q", "B", "E", "N", "H", "Z", "R", "D", "K", "A", "S", "X", "L", "I", "C", "T", "W"],
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L*", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y*", "Z"],

                ],
                "ローターVII": [
                    ["N", "Z", "J", "H", "G", "R", "C", "X", "M", "Y", "S", "W", "B", "O", "U", "F", "A", "I", "V", "L", "P", "E", "K", "Q", "D", "T"],
                    ["A", "B", "C", "D", "E", "F", "G", "H*", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U*", "V", "W", "X", "Y", "Z"],

                ],
                "ローターVIII": [
                    ["F", "K", "Q", "H", "T", "L", "X", "O", "C", "B", "J", "S", "P", "D", "Z", "R", "A", "M", "E", "W", "N", "I", "U", "Y", "G", "V"],
                    ["A", "B", "C*", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P*", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],

                ],
                "リフレクターA": [
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                    ["L", "U", "S", "N", "P", "Q", "O", "M", "J", "I", "Y", "A", "H", "D", "G", "E", "F", "X", "C", "V", "B", "T", "Z", "R", "K", "W"],

                ],
                "リフレクターB": [
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                    ["X", "Q", "U", "M", "F", "E", "P", "O", "W", "L", "T", "J", "D", "Z", "H", "G", "B", "V", "Y", "K", "C", "R", "I", "A", "S", "N"],

                ],
                "リフレクターC": [
                    ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
                    ["E", "S", "K", "O", "A", "Q", "M", "J", "Y", "H", "C", "P", "G", "T", "D", "L", "F", "U", "B", "N", "R", "X", "Z", "V", "I", "W"],
                ],
            };

            function mod26(n) {
                return ((n % 26) + 26) % 26;
            }

            const interactive = $("#interactive");

            // Make the keyboard
            const keyboard = $("<tr>").appendTo(interactive);

            $("<td>").addClass("borderless").appendTo(keyboard);
            // The top row of any reflector is just A–Z.
            for (let i = 0; i < 26; i++) {
                $("<td>").text(cyclers["リフレクターA"][0][i]).appendTo(keyboard);
            }

            // Make the cyclers
            function makeCycler(names, controls = true) {
                let position = 0;
                let name = names[0];

                const update = () => {
                    for (let i = 0; i < 26; i++) {
                        topRow.children().eq(i + 1).text(cyclers[name][0][mod26(i + position)]);
                        bottomRow.children().eq(i).text(cyclers[name][1][mod26(i + position)]);
                    }
                };

                const selector = $("<select>");
                for (const name of names) {
                    $("<option>").attr("value", name).text(name).appendTo(selector);
                }

                selector.change(() => { name = selector.val(); update(); });

                const selectorRow = $("<tr>").appendTo(interactive);
                $("<td>").addClass("borderless").appendTo(selectorRow);
                $("<td colspan=26>").append(selector).appendTo(selectorRow);

                const topRow = $("<tr>").appendTo(interactive);
                if (controls) {
                    const shiftLeft = $("<button>").text("←").click(() => { position++; update(); });
                    $("<td rowspan=2>").addClass("borderless").append(shiftLeft).appendTo(topRow);
                } else {
                    $("<td rowspan=2>").addClass("borderless").appendTo(topRow);
                }

                const bottomRow = $("<tr>").appendTo(interactive);

                for (let i = 0; i < 26; i++) {
                    $("<td>").appendTo(topRow);
                    $("<td>").appendTo(bottomRow);
                }

                if (controls) {
                    const shiftRight = $("<button>").text("→").click(() => { position--; update(); });
                    $("<td rowspan=2>").addClass("borderless").append(shiftRight).appendTo(topRow);
                }

                update();
            }

            // Make the rotors
            const rotorNames = Object.keys(cyclers).filter(name => name.includes("ローター"));
            for (let i = 0; i < 3; i++) {
                makeCycler(rotorNames);
            }

            // Make the reflector
            makeCycler(Object.keys(cyclers).filter(name => name.includes("リフレクター")), false);
        </script>
    </div>
</body>
</html>