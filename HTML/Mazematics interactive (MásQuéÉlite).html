<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Mazematics â€” Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <style>
        @namespace svg "http://www.w3.org/2000/svg";
        @keyframes glow-in-the-dark {
            8%{color:orange;}
            16%{color:yellow;}
            25%{color:chartreuse;}
            33%{color:green;}
            41%{color:springgreen;}
            50%{color:cyan;}
            58%{color:dodgerblue;}
            66%{color:blue;}
            75%{color:purple;}
            83%{color:violet;}
            91%{color:magenta;}
            100%{color:red;}
        }
        td>svg {
            padding: 0;
            text-align: center;
            font-size: 3em;
            user-select: none;
            width: 60px;
            height: 55px;
            fill: transparent;
            stroke: black;
            stroke-width: 3.5;
            margin-top: 5px;
        }
        #inputs {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            row-gap: 10px;
            margin-left: -20px;
            padding-top: 20px;
        }
            #input-row {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
            }
        input {
            width: 25%;
            text-align: center;
            -moz-appearance: textfield;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
          -webkit-appearance: none;
        }
        .pair {
            display: inline-flex;
            justify-content: space-evenly;
        }
            .small {
                transform: scale(0.4);
                stroke-width: 5px;
            }
            .small-star {
                transform: scale(0.45);
                stroke-width: 4px;
            }
            .small-triangle {
                transform: scale(0.4);
                stroke-width: 5px;
            }
            .small-diamond {
                stroke-width: 5px;
            }
        button {
            background-color: #c0c0c0;
            font-family: "Special Elite";
            font-size: 20px;
            font-weight: bold;
            padding: 10px 10px 0px 10px;
            border: none;
            border-bottom: 3px black dashed;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .pair svg {
            fill: transparent;
            stroke: black;
            stroke-width: 3.5;
            width: 24px;
            height: 24px;
        }
        path { stroke-width: 2.5; }
        .star polygon { stroke-width: 3; }
        svg text {
            stroke-width: 0;
            fill: black;
            text-anchor: middle;
            transform: translate(0, 45px);
        }
        .dark svg path, .dark svg rect, .dark svg polygon, .dark svg circle {
            stroke: #DDD;
        }
        .dark svg text { fill: #DDD; }
        .dark input {
            background-color: #444;
            color: #DDD;
            border: none;
        }
        .dark a { animation: glow-in-the-dark 8s linear 0s infinite; }
    </style>
</head>
<body onload="resetAll(true)">
    <div class="section">
        <div class="page page-bg-05">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Mazematics</span>
            </div>
                <div class="page-content">
                <img src="img/Component/Mazematics.svg" class="diagram">
                <h2>On the Subject of Mazematics</h2>
                <p class="flavour-text">Which number was star again? Bruh.</p>
                <p style="margin-top:15px">See the <a href='/Mazematics.html'>original manual</a> for instructions.</p>
                <div id="inputs">
                    <div id="button-row"><button onclick="buttonHandler()">Reset</button></div>
                    <div id="input-row">
                        <div class="pair"><svg><polygon class="small" points="30 5,50 17,50 43,30 53,10 43,10 17"/></svg><input type="number" /></div>
                        <div class="pair"><svg><polygon class="small-star" points="30 5,35 20,50 20,38 30,44 45,30 35,16 45,22 30,10 20,25 20"/></svg><input type="number" /></div>
                        <div class="pair"><svg><polygon class="small-triangle" points="30,54 5,10 55,10" transform="rotate(180)"/></svg><input type="number" /></div>
                        <div class="pair"><svg><rect class="small" x="6" y="6" width="48" height="47"/></svg><input type="number" /></div>
                        <div class="pair"><svg><circle class="small" cx="30" cy="28" r="25" /></svg><input type="number" /></div>
                        <div class="pair"><svg><rect class="small-diamond" x="11" y="11" width="35" height="35" transform="rotate(45,12,12) scale(0.4)"/></svg><input type="number" /></div>
                        <div class="pair"><svg><polygon class="small" points="30 6,5 50,55 50"/></svg><input type="number" /></div>
                        <div class="pair"><svg><path d="M0 20 v-20 h20 a10,10 0 0,1 0,20 a10,10 0 0,1 -20,0 z" transform="rotate(225,12,12) translate(5,5) scale(0.6)"/></svg><input type="number" /></div>
                    </div>
                </div>
                <h3>The Maze</h3>
                <table>
                    <tr>
                        <td><svg class="hexagon"><polygon points="30 5,50 17,50 43,30 53,10 43,10 17"/><text>+</text></svg></td>
                        <td><svg class="star"><polygon points="30 5,35 20,50 20,38 30,44 45,30 35,16 45,22 30,10 20,25 20" transform="scale(1.2) translate(-5,-1)"/><text>+</text></svg></td>
                        <td><svg class="triangle"><polygon points="30 6,5 50,55 50" transform="rotate(180, 30, 29)"/><text>-</text></svg></td>
                        <td><svg class="square"><rect x="6" y="6" width="48" height="47"/><text>-</text></svg></td>
                        <td><svg class="circle"><circle cx="30" cy="28" r="25" /><text>+</text></svg></td>
                        <td><svg class="diamond"><rect x="11" y="11" width="35" height="35" transform="rotate(45, 30, 30)"/><text>+</text></svg></td>
                        <td><svg class="mountain"><polygon points="30,6 5,50 55,50"/><text>-</text></svg></td>
                        <td><svg class="heart"><path d="M0 20 v-20 h20 a10,10 0 0,1 0,20 a10,10 0 0,1 -20,0 z" transform="rotate(225,30,30) translate(16,16) scale(1.5)"/><text>-</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="mountain"><text>-</text></svg></td>
                        <td><svg class="heart"><text>+</text></svg></td>
                        <td><svg class="diamond"><text>-</text></svg></td>
                        <td><svg class="circle"><text>-</text></svg></td>
                        <td><svg class="triangle"><text>+</text></svg></td>
                        <td><svg class="square"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>-</text></svg></td>
                        <td><svg class="star"><text>+</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="star"><text>+</text></svg></td>
                        <td><svg class="mountain"><text>-</text></svg></td>
                        <td><svg class="square"><text>+</text></svg></td>
                        <td><svg class="triangle"><text>+</text></svg></td>
                        <td><svg class="diamond"><text>-</text></svg></td>
                        <td><svg class="circle"><text>-</text></svg></td>
                        <td><svg class="heart"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>-</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="heart"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>-</text></svg></td>
                        <td><svg class="circle"><text>-</text></svg></td>
                        <td><svg class="diamond"><text>+</text></svg></td>
                        <td><svg class="star"><text>-</text></svg></td>
                        <td><svg class="triangle"><text>+</text></svg></td>
                        <td><svg class="square"><text>+</text></svg></td>
                        <td><svg class="mountain"><text>-</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="triangle"><text>-</text></svg></td>
                        <td><svg class="square"><text>+</text></svg></td>
                        <td><svg class="star"><text>+</text></svg></td>
                        <td><svg class="heart"><text>-</text></svg></td>
                        <td><svg class="mountain"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>-</text></svg></td>
                        <td><svg class="diamond"><text>-</text></svg></td>
                        <td><svg class="circle"><text>+</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="diamond"><text>-</text></svg></td>
                        <td><svg class="circle"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>-</text></svg></td>
                        <td><svg class="mountain"><text>+</text></svg></td>
                        <td><svg class="heart"><text>-</text></svg></td>
                        <td><svg class="str star"><text>-</text></svg></td>
                        <td><svg class="triangle"><text>+</text></svg></td>
                        <td><svg class="square"><text>+</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="circle"><text>+</text></svg></td>
                        <td><svg class="diamond"><text>-</text></svg></td>
                        <td><svg class="heart"><text>+</text></svg></td>
                        <td><svg class="hexagon"><text>+</text></svg></td>
                        <td><svg class="square"><text>-</text></svg></td>
                        <td><svg class="mountain"><text>+</text></svg></td>
                        <td><svg class="star"><text>-</text></svg></td>
                        <td><svg class="triangle"><text>-</text></svg></td>
                    </tr>
                    <tr>
                        <td><svg class="square"><text>-</text></svg></td>
                        <td><svg class="triangle"><text>-</text></svg></td>
                        <td><svg class="mountain"><text>+</text></svg></td>
                        <td><svg class="star"><text>-</text></svg></td>
                        <td><svg class="hexagon"><text>+</text></svg></td>
                        <td><svg class="heart"><text>-</text></svg></td>
                        <td><svg class="circle"><text>+</text></svg></td>
                        <td><svg class="diamond"><text>+</text></svg></td>
            </table>
            <h3 style="margin-top:30px">Recall:</h3>
            1st screen &rArr; initial <strong>::</strong> screen on 0 &rArr; goal <strong>::</strong> screen on &ne; 0 &rArr; current
            <hr>
            <strong>Avoid:</strong><br>
            - Initial shape is square or diamond &rArr; Triangular numbers<br>
            - 3 | initial value &rArr; Multiples of 7<br>
            - Initial shape has a + sign &rArr; Prime numbers<br>
            - Otherwise &rArr; Fibonacci numbers
        </div>
        <div class="page-footer relative-footer">Page 1 of 1</div>
    </div>
</div>
    <script>
        function makeNumber(value) {
            number = shapeRefs[0].cloneNode();
            number.setAttribute('x', '45');
            number.innerHTML = value;
            return number;
        }

        function fillEmpty() {
            inputArr = inputValues();
            for (let i = 0; i < 8; i++)
                if (!inputArr[i])
                    Array.from(document.getElementsByClassName(shapes[i]))
                        .forEach(cell => { putNumber(cell, '?', inputArr[i]); });
        }

        function resetShapes(firstLoad) {
            for (let i = 0; i < 8; i++)
                Array.from(document.getElementsByClassName(shapes[i])).forEach(cell => {
                    if (!firstLoad) cell.childNodes[1].remove();
                    cell.childNodes[0].setAttribute('x','30');
                    cell.insertBefore(chooseShape(i), cell.childNodes[0]);
                });
        }

        function resetAll(loaded) {
            resetShapes(loaded);
            Array.from(inputs, input => input.value = "");
            shapeMode = true;
        }

        function putNumber(where, number, condition) {
            where.childNodes[condition ? 1 : 0].remove();
            where.childNodes[0].setAttribute('x','15');
            where.appendChild(makeNumber(number));
        }

        function alterSVG(index) {
            shapesArr = Array.from(document.getElementsByClassName(shapes[index]));
            if (event.data)
                for (let i = 0; i < 8; i++)
                    putNumber(shapesArr[i], event.data, !shapeMode);
            else
                for (let i = 0; i < 8; i++)
                    shapesArr[i].childNodes[1].innerHTML = '?';
        }

        buttonHandler = () => { if (!shapeMode) resetAll(false) };
        differentNumbers = (inputted) => !inputValues().filter(n => n >= '1' && n <= '9').some(number => number == inputted);
        forbiddenKeys = (key) => [38, 40, 48, 69, 89, 96, 107, 109, 110, 187, 188, 189, 190].find(x => x == key);
        inputValues = () => Array.from(inputs, i => i.value);
        chooseShape = (index) => shapeRefs[index+1].cloneNode();
        numberMode = () => inputValues().filter(x => x).length > 0;

        const shapes = ["hexagon", "star", "triangle", "square", "circle", "diamond", "mountain", "heart"];
        shapeMode = true;

        let inputs = document.getElementsByTagName("input");
        let shapeRefs = [document.getElementsByTagName("svg")[8].childNodes[1]];
        shapes.forEach(shape => shapeRefs.push(document.getElementsByClassName(shape)[0].childNodes[0]) );
        shapes.forEach(shape => document.getElementsByClassName(shape)[0].childNodes[0].remove() );

        Array.from(inputs).forEach((input, i) => {
            input.addEventListener('keydown', e => {
                if ((forbiddenKeys(e.which)) || !differentNumbers(e.key))
                    e.preventDefault();
            });
            input.addEventListener("input", e => {
                input.value = e.data;
                alterSVG(i);

                if (shapeMode == numberMode()) {
                    shapeMode = !numberMode();
                    if (!shapeMode) fillEmpty();
                    else resetShapes(false);
                }
            });
        });
    </script>
</body>
</html>