<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1">
    <title>Rainbow Arrows — Keep Talking and Nobody Explodes Module</title>
    <link rel="stylesheet" type="text/css" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="js/ktane-utils.js"></script>
    <script src="js/jquery.3.7.0.min.js"></script>
    <script src="js/Utilities/svg-utils.js"></script>
    <script>
    $(function() {
        let svg = $("svg.maze");
        let w = 10;
        let h = 8;
        for (let y = 0; y < h; y++) {
            for (let x = 0; x < w; x++) {
                if (y < 2 && (x < 2 || x >= h) || y > 5 && (x < 2 || x >= h)) continue;
                let cell = MakeSvgElem("rect", {
                    x:(x*w), y:(y*w), width:w, height:w, class:"highlightable", fill:"transparent"
                });
                svg.append(cell);
            }
        }
    });
    </script>
    <style>
        table {
            margin-top: 1em;
            margin-bottom: 1em;
            font-size: 0.875em;
        }

        table .inner-table {
            float: right;
            margin: 1em;
            font-size: 0.9em;
        }

        .maze {
            float: right;
            width: 190px;
        }
        .dark svg path { stroke: #DDD; }
        .dark svg text { fill: #DDD; }

        div.space { height: 5mm; }

        th.sideways {
            width: 8px;
        }
        th.sideways div.cardinal {
            position: absolute;
            transform-origin: 8px 12px;
            transform: rotate(270deg);
        }
        th.sideways div.diagonal {
            position: absolute;
            transform-origin: 18px 22px;
            transform: rotate(270deg);
        }

        .continued {
            text-align: right;
            font-style: italic;
            font-size: 10pt;
        }
    </style>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Rainbow Arrows</span>
            </div>
            <div class="page-content">
                <img src="img/Component/Rainbow Arrows.svg" class="diagram">
                <h2>On the Subject of Rainbow Arrows</h2>
                <p class="flavour-text">Pointedly pointless pointing.</p>

                <p class="appendix-reference" id="appendix-reference">
                    See Appendix A for indicator identification reference.
                    <br>
                    See Appendix B for battery identification reference.
                    <br>
                    See Appendix C for port identification reference.
                </p>

                <ul>
                    <li>This module has eight arrow buttons in a rainbow color arrangement, and a display screen in the center showing a two-digit number.</li>
                    <li>Use the location of the white arrow button to determine your starting rule in the table below.</li>
                    <li>Follow the directions for each rule to determine what arrow to press.</li>
                    <li>If the rainbow pattern proceeds clockwise, move down one rule after each press; otherwise, move up one rule instead.  The table wraps around.</li>
                    <li>All arrow presses must be unique.  If a rule says to press an arrow that has already been pressed, then instead press the closest arrow that hasn’t been pressed yet, in either direction.  In case of a tie for distance, use the arrow reached by following the same direction as the rainbow pattern.</li>
                    <li>Pressing an incorrect arrow button will result in a strike, and a reset of all inputs up to that point. The number on the display and the colors of the arrows will not change, however.</li>
                    <li>The module will be disarmed after each arrow button has been correctly pressed once.</li>
                </ul>
            </div>
            <div class="page-footer relative-footer">Page 1 of 3</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Rainbow Arrows</span>
            </div>
            <div class="page-content">
                <table>
                    <tr>
                        <th class="sideways"><div class="cardinal">Start</div></th>
                        <th style="line-height: 50px">Rule</th>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="cardinal">North</div></th>
                        <td class="nohighlight">
                            <svg class="maze" xmlns="http://www.w3.org/2000/svg" viewBox="-1 -1 102 82">
                                <g stroke="#000" fill="none">
                                    <path d="M0 20h20v-20h60v20h20v40h-20v20h-60v-20h-20z"/>
                                    <path d="M20 10h20v10h10v10M50 0v10M70 0v30h10v10h10"/>
                                    <path d="M60 10v30h10v10h10v10h-20v10h-20"/>
                                    <path d="M20 20v10h10v-10M0 50h30"/>
                                    <path d="M10 30v10h30v-10v20"/>
                                    <path d="M30 60h20v-20v10h10"/>
                                    <path d="M30 70v10M70 70v10"/>
                                </g>
                                <g font-size="7" font-style="italic" text-anchor="middle">
                                    <text x="24.5" y= "7.5">1</text>
                                    <text x="74.5" y= "7.5">2</text>
                                    <text x= "4.5" y="27.5">3</text>
                                    <text x="24.5" y="27.5">4</text>
                                    <text x="94.5" y="27.5">5</text>
                                    <text x= "4.5" y="57.5">6</text>
                                    <text x="74.5" y="57.5">7</text>
                                    <text x="94.5" y="57.5">8</text>
                                    <text x="24.5" y="77.5">9</text>
                                    <text x="74.5" y="77.5">0</text>
                                </g>
                            </svg>
                            Use the right digit of the display as the starting square in the maze to the right, and navigate to the square that contains the last digit of the serial number in the fewest number of moves required.
                            <div class="space"></div>
                            If those two digits are the same, press the diagonal arrow that corresponds to the relative location of the starting square, and ignore the rest of this section. Otherwise:
                            <ul>
                                <li>If the first two moves were along the same axis, start from the arrow in the direction of the first move.</li>
                                <li>If the first two moves were along different axes, start from the diagonal arrow formed by combining the first two moves.</li>
                            </ul>
                            From the starting arrow, move clockwise a number of steps equal to half the number of moves required, rounded down, and press the arrow in that position.
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="diagonal">Northeast</div></th>
                        <td>
                            Multiply the displayed number by four, then modulo 360.
                            <div class="space"></div>
                            Starting from the exact center of the white arrow, rotate clockwise by that number of degrees, then press the arrow that’s closest to that position. <strong>However</strong>, if this is the fourth or eighth rule used, press the arrow directly opposite that position instead.
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="cardinal">East</div></th>
                        <td>
                            Assemble a four-bit binary (base 2) number as follows, from least to most significant.
                            <ul>
                                <li>Bit 1 is 1 if any diagonal direction has been pressed before this point.</li>
                                <li>Bit 2 is 1 if either a parallel port or serial port is present.</li>
                                <li>Bit 3 is 1 if the displayed number is a multiple of (number of batteries + 1).</li>
                                <li>Bit 4 is 1 if there are as least as many battery holders as there are port plates.</li>
                            </ul>
                            Rotate the resulting binary number right by the number of indicators, then convert it into a decimal number. Move clockwise that many steps starting from North, and press the arrow in that position.
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="diagonal">Southeast</div></th>
                        <td>
                            If this is the starting rule, press the white arrow.
                            <div class="space"></div>
                            Otherwise, starting from the last arrow that was pressed, move counter-clockwise until an arrow that has not been pressed yet is reached. Then, move clockwise a number of steps equal to the number of arrows pressed thus far, and press the arrow in that position.
                        </td>
                    </tr>
                </table>
                <p class="continued">continued on next page…</p>
            </div>
            <div class="page-footer relative-footer">Page 2 of 3</div>
        </div>
        <div class="page page-bg-03">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title">Rainbow Arrows</span>
            </div>
            <div class="page-content">
                <table>
                    <tr>
                        <th class="sideways"><div class="cardinal">Start</div></th>
                        <th style="line-height: 50px">Rule</th>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="cardinal">South</div></th>
                        <td>
                            Assign every arrow a letter from A–H, starting from the white arrow and moving clockwise. Then, start with a string of “ABCDEFGH” and modify it in the following ways:
                            <ul>
                                <li>Move any letters present in the serial number to the front of the string, in the order they first appear in the serial number.</li>
                                <li>If the last digit of the serial number is even, cycle the string to the right by the first digit of the serial number.</li>
                                <li>If the number of batteries is odd, move all letters in odd positions to the front of the string, keeping the order they appeared.</li>
                                <li>If North or South has been assigned a vowel, reverse the string.</li>
                            </ul>
                            Afterwards, press the arrow that the <i>n</i>th letter in the string was assigned to, where <i>n</i> is the digital root of the displayed number, minus one. (If <i>n</i> is 0 or less, use 1.)
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="diagonal">Southwest</div></th>
                        <td class="nohighlight">
                            <table style="float:right;border-top:none;border-bottom:none;">
                                <tr>
                                    <th>Word</th>
                                    <th>#</th>
                                    <th style="border:none"></th>
                                    <th>Word</th>
                                    <th>#</th>
                                </tr>
                                <tr>
                                    <td>RED</td>
                                    <td>1</td>
                                    <td style="border:none"></td>
                                    <td>BLUE</td>
                                    <td>5</td>
                                </tr>
                                <tr>
                                    <td>ORANGE</td>
                                    <td>2</td>
                                    <td style="border:none"></td>
                                    <td>INDIGO</td>
                                    <td>6</td>
                                </tr>
                                <tr>
                                    <td>YELLOW</td>
                                    <td>3</td>
                                    <td style="border:none"></td>
                                    <td>PURPLE</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td>GREEN</td>
                                    <td>4</td>
                                    <td style="border:none"></td>
                                    <td>DOUBLE</td>
                                    <td>8</td>
                                </tr>
                            </table>
                            For each word in the table to the right, determine a value equal to the count of letters in the word that are present in the serial number, plus the number of modules on the bomb named “&lt;WORD&gt; Arrows”. Take the word with the highest value and look up the number next to that word in the table; if there’s a tie, use the word with the lowest number.
                            <div class="space"></div>
                            Starting from the white arrow, move that number of steps in the same direction as the rainbow pattern; then, press the arrow in that position.
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="cardinal">West</div></th>
                        <td class="nohighlight">
                            <table class="inner-table">
                                <tr><td>yoked</td><td>white</td><td>poets</td><td>xysti</td></tr>
                                <tr><td>lower</td><td>tango</td><td>magic</td><td>joust</td></tr>
                                <tr><td>farce</td><td>along</td><td>quirk</td><td>hotel</td></tr>
                                <tr><td>zeros</td><td>royal</td><td>bravo</td><td>vault</td></tr>
                            </table>
                            Using the table to the right, find the word that shares the most unique letters in common with the serial number. If there are multiple, use the first in reading order. Then, take the <i>n</i>th letter of the English alphabet, where <i>n</i> is the displayed number modulo 26, plus one.
                            <div class="space"></div>
                            If one of the words adjacent to the given word (orthogonally or diagonally) starts with that letter, press the arrow in the direction that would take you to that word. Otherwise, use the next letter of the English alphabet, wrapping around from Z to A if necessary, and repeat until such a word is found. The table does <i>not</i> wrap around.
                        </td>
                    </tr>
                    <tr>
                        <th class="sideways"><div class="diagonal">Northwest</div></th>
                        <td>
                            Take the two digits on the screen individually, and compare them to the bomb’s serial number.
                            <div class="space"></div>
                            If both digits on the module are present, press North.
                            <br>
                            If only the left digit is present, press West.
                            <br>
                            If only the right digit is present, press East.
                            <br>
                            If neither are present, press South.
                        </td>
                    </tr>
                </table>
            </div>
            <div class="page-footer relative-footer">Page 3 of 3</div>
        </div>
    </div>
</body>
</html>
